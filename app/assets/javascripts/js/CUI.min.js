this.CUI=this.CUI||{},this.CUI.Templates=this.CUI.Templates||{},this.CUI.Templates.alert=Handlebars.template(function(t,e,i,s,n){this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var o,a="",l="function";return a+='<button class="close" data-dismiss="alert">&times;</button>\n<strong>',(o=i.heading)?o=o.call(e,{hash:{},data:n}):(o=e.heading,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+="</strong><div>",(o=i.content)?o=o.call(e,{hash:{},data:n}):(o=e.content,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+="</div>"}),this.CUI.Templates.badge=Handlebars.template(function(t,e,i,s,n){function o(){return" empty"}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var a,l="",r=this,d="function",h=this.escapeExpression;return l+='<div class="badge',a=i.unless.call(e,e.value,{hash:{},inverse:r.noop,fn:r.program(1,o,n),data:n}),(a||0===a)&&(l+=a),l+='">',(a=i.value)?a=a.call(e,{hash:{},data:n}):(a=e.value,a=typeof a===d?a.apply(e):a),l+=h(a)+"</div>"}),this.CUI.Templates.header=Handlebars.template(function(t,e,i,s,n){function o(t,e){var s,n="";return n+='<div class="logo">',(s=i.logo)?s=s.call(t,{hash:{},data:e}):(s=t.logo,s=typeof s===h?s.apply(t):s),(s||0===s)&&(n+=s),n+="</div>"}function a(t,e){var n;return n=c.invokePartial(s.header_navItem,"header_navItem",t,i,s,e),n||0===n?n:""}function l(t,e){var n,o="";return o+='<div class="drawer">',n=c.invokePartial(s.header_drawer,"header_drawer",t.drawer,i,s,e),(n||0===n)&&(o+=n),o+="</div>"}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,s=s||t.partials,n=n||{};var r,d="",h="function",c=this;return r=i["if"].call(e,e.logo,{hash:{},inverse:c.noop,fn:c.program(1,o,n),data:n}),(r||0===r)&&(d+=r),d+='\n<nav role="tablist">',r=i.each.call(e,e.navItems,{hash:{},inverse:c.noop,fn:c.program(3,a,n),data:n}),(r||0===r)&&(d+=r),d+="</nav>\n",r=i["if"].call(e,e.drawer,{hash:{},inverse:c.noop,fn:c.program(5,l,n),data:n}),(r||0===r)&&(d+=r),d}),this.CUI.Templates.header_drawer=Handlebars.template(function(t,e,i,s,n){function o(t,e){var n;return n=l.invokePartial(s.badge,"badge",t.badge,i,s,e),n||0===n?n:""}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,s=s||t.partials,n=n||{};var a,l=this;return a=i["if"].call(e,e.badge,{hash:{},inverse:l.noop,fn:l.program(1,o,n),data:n}),a||0===a?a:""}),this.CUI.Templates.header_navItem=Handlebars.template(function(t,e,i,s,n){function o(t,e){var s,n="";return n+=' id="',(s=i.id)?s=s.call(t,{hash:{},data:e}):(s=t.id,s=typeof s===c?s.apply(t):s),n+=p(s)+'"'}function a(t,e){var s,n="";return n+=' aria-owns="',(s=i.owns)?s=s.call(t,{hash:{},data:e}):(s=t.owns,s=typeof s===c?s.apply(t):s),n+=p(s)+'"'}function l(){return'aria-selected="true" class="selected"'}function r(){return'aria-selected="false"'}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var d,h="",c="function",p=this.escapeExpression,u=this;return h+='<a href="',(d=i.url)?d=d.call(e,{hash:{},data:n}):(d=e.url,d=typeof d===c?d.apply(e):d),h+=p(d)+'" role="tab"',d=i["if"].call(e,e.id,{hash:{},inverse:u.noop,fn:u.program(1,o,n),data:n}),(d||0===d)&&(h+=d),d=i["if"].call(e,e.owns,{hash:{},inverse:u.noop,fn:u.program(3,a,n),data:n}),(d||0===d)&&(h+=d),h+=" ",d=i["if"].call(e,e.selected,{hash:{},inverse:u.program(7,r,n),fn:u.program(5,l,n),data:n}),(d||0===d)&&(h+=d),h+='">',(d=i.label)?d=d.call(e,{hash:{},data:n}):(d=e.label,d=typeof d===c?d.apply(e):d),h+=p(d)+"</a>"}),this.CUI.Templates.modal=Handlebars.template(function(t,e,i,s,n){this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var o,a="",l="function";return a+='<div class="modal-header">\n  <h2>',(o=i.heading)?o=o.call(e,{hash:{},data:n}):(o=e.heading,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+='</h2>\n  <button type="button" class="close" data-dismiss="modal">&times;</button>\n</div>\n<div class="modal-body">',(o=i.content)?o=o.call(e,{hash:{},data:n}):(o=e.content,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+='</div>\n<div class="modal-footer">',(o=i.buttons)?o=o.call(e,{hash:{},data:n}):(o=e.buttons,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+="</div>"}),this.CUI.Templates.rail=Handlebars.template(function(t,e,i,s,n){this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var o,a="",l="function",r=this.escapeExpression;return a+='<div class="rail">\n	<div class="pull-to-refresh">\n        <div class="icon"></div>\n        <div class="message">\n          <i class="arrow"></i>\n          <i class="spinner large"></i>\n          <span class="pull">',(o=i.message_ptr_pull)?o=o.call(e,{hash:{},data:n}):(o=e.message_ptr_pull,o=typeof o===l?o.apply(e):o),a+=r(o)+'</span>\n          <span class="release">',(o=i.message_ptr_release)?o=o.call(e,{hash:{},data:n}):(o=e.message_ptr_release,o=typeof o===l?o.apply(e):o),a+=r(o)+'</span>\n          <span class="loading">',(o=i.message_ptr_loading)?o=o.call(e,{hash:{},data:n}):(o=e.message_ptr_loading,o=typeof o===l?o.apply(e):o),a+=r(o)+'</span>\n        </div>\n      </div>\n      <div class="wrap">\n      	',(o=i.content)?o=o.call(e,{hash:{},data:n}):(o=e.content,o=typeof o===l?o.apply(e):o),(o||0===o)&&(a+=o),a+="\n      </div>\n</div>"}),this.CUI.Templates.tabs=Handlebars.template(function(t,e,i,s,n){function o(t,e){var n,o="";return o+="\n    ",n=d.invokePartial(s.tabs_tab,"tabs_tab",t,i,s,e),(n||0===n)&&(o+=n),o+="\n  "}function a(t,e){var n,o="";return o+="\n",n=d.invokePartial(s.tabs_panel,"tabs_panel",t,i,s,e),(n||0===n)&&(o+=n),o+="\n"}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,s=s||t.partials,n=n||{};var l,r="",d=this;return r+='<nav role="tablist">\n  ',l=i.each.call(e,e.tabs,{hash:{},inverse:d.noop,fn:d.program(1,o,n),data:n}),(l||0===l)&&(r+=l),r+="\n</nav>\n",l=i.each.call(e,e.tabs,{hash:{},inverse:d.noop,fn:d.program(3,a,n),data:n}),(l||0===l)&&(r+=l),r}),this.CUI.Templates.tabs_panel=Handlebars.template(function(t,e,i,s,n){function o(t,e){var s,n="";return n+='id="',(s=i.id)?s=s.call(t,{hash:{},data:e}):(s=t.id,s=typeof s===h?s.apply(t):s),n+=c(s)+'" aria-labelledby="',(s=i.id)?s=s.call(t,{hash:{},data:e}):(s=t.id,s=typeof s===h?s.apply(t):s),n+=c(s)+'"'}function a(){return'class="active"'}function l(){return'aria-disabled="true"'}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var r,d="",h="function",c=this.escapeExpression,p=this;return d+="<section ",r=i["if"].call(e,e.id,{hash:{},inverse:p.noop,fn:p.program(1,o,n),data:n}),(r||0===r)&&(d+=r),d+=' role="tabpanel" ',r=i["if"].call(e,e.active,{hash:{},inverse:p.noop,fn:p.program(3,a,n),data:n}),(r||0===r)&&(d+=r),d+=" ",r=i["if"].call(e,e.disabled,{hash:{},inverse:p.noop,fn:p.program(5,l,n),data:n}),(r||0===r)&&(d+=r),d+=">",(r=i.content)?r=r.call(e,{hash:{},data:n}):(r=e.content,r=typeof r===h?r.apply(e):r),d+=c(r)+"</section>"}),this.CUI.Templates.tabs_tab=Handlebars.template(function(t,e,i,s,n){function o(t,e){var s;return(s=i.remote)?s=s.call(t,{hash:{},data:e}):(s=t.remote,s=typeof s===f?s.apply(t):s),g(s)}function a(t,e){var s,n="";return n+="#",s=i["if"].call(t,t.id,{hash:{},inverse:v.noop,fn:v.program(4,l,e),data:e}),(s||0===s)&&(n+=s),n}function l(t,e){var s;return(s=i.id)?s=s.call(t,{hash:{},data:e}):(s=t.id,s=typeof s===f?s.apply(t):s),g(s)}function r(t,e){var s;return s=i["if"].call(t,t.remote,{hash:{},inverse:v.noop,fn:v.program(7,d,e),data:e}),s||0===s?s:""}function d(t,e){var s,n="";return n+='data-target="#',(s=i.id)?s=s.call(t,{hash:{},data:e}):(s=t.id,s=typeof s===f?s.apply(t):s),n+=g(s)+'"'}function h(){return'class="active" aria-selected="true"'}function c(){return'aria-selected="false"'}function p(){return'class="disabled" aria-disabled="true"'}this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var u,m="",f="function",g=this.escapeExpression,v=this;return m+='<a href="',u=i["if"].call(e,e.remote,{hash:{},inverse:v.program(3,a,n),fn:v.program(1,o,n),data:n}),(u||0===u)&&(m+=u),m+='" ',u=i["if"].call(e,e.id,{hash:{},inverse:v.noop,fn:v.program(6,r,n),data:n}),(u||0===u)&&(m+=u),m+=' data-toggle="tab" role="tab" ',u=i["if"].call(e,e.active,{hash:{},inverse:v.program(11,c,n),fn:v.program(9,h,n),data:n}),(u||0===u)&&(m+=u),m+=" ",u=i["if"].call(e,e.disabled,{hash:{},inverse:v.noop,fn:v.program(13,p,n),data:n}),(u||0===u)&&(m+=u),m+=">",(u=i.label)?u=u.call(e,{hash:{},data:n}):(u=e.label,u=typeof u===f?u.apply(e):u),m+=g(u)+"</a>"}),this.CUI.Templates.toolbar=Handlebars.template(function(t,e,i,s,n){this.compilerInfo=[2,">= 1.0.0-rc.3"],i=i||t.helpers,n=n||{};var o,a="",l="function",r=this.escapeExpression;return a+='<nav class="toolbar">\n  <div class="left">\n    <a href="#" class="icon-',(o=i.actionName)?o=o.call(e,{hash:{},data:n}):(o=e.actionName,o=typeof o===l?o.apply(e):o),a+=r(o)+">",(o=i.actionTitle)?o=o.call(e,{hash:{},data:n}):(o=e.actionTitle,o=typeof o===l?o.apply(e):o),a+=r(o)+'</a>\n    <span class="divider"></span>\n    <a href="#" class="icon-',(o=i.actionName)?o=o.call(e,{hash:{},data:n}):(o=e.actionName,o=typeof o===l?o.apply(e):o),a+=r(o)+">",(o=i.actionTitle)?o=o.call(e,{hash:{},data:n}):(o=e.actionTitle,o=typeof o===l?o.apply(e):o),a+=r(o)+'</a>\n  </div>\n  <div class="center">\n    <h1>',(o=i.heading)?o=o.call(e,{hash:{},data:n}):(o=e.heading,o=typeof o===l?o.apply(e):o),a+=r(o)+'</h1>\n  </div>\n  <div class="right">\n    <a href="#" class="icon-',(o=i.actionName)?o=o.call(e,{hash:{},data:n}):(o=e.actionName,o=typeof o===l?o.apply(e):o),a+=r(o)+">",(o=i.actionTitle)?o=o.call(e,{hash:{},data:n}):(o=e.actionTitle,o=typeof o===l?o.apply(e):o),a+=r(o)+'</a>\n    <a href="#" class="icon-',(o=i.actionName)?o=o.call(e,{hash:{},data:n}):(o=e.actionName,o=typeof o===l?o.apply(e):o),a+=r(o)+">",(o=i.actionTitle)?o=o.call(e,{hash:{},data:n}):(o=e.actionTitle,o=typeof o===l?o.apply(e):o),a+=r(o)+"</a>\n  </div>\n</nav>"});var Class,Exception;(function(){var t=function(t){var e=t.bind(this);return e._methodName=t._methodName,this[e._methodName]=e,e},e=function(t){return t.extend=this,new Class(t)};Class=function(i){if(i=i||{},i.hasOwnProperty("extend")&&!i.extend)throw new Class.NonTruthyExtendError("function"===i.toString?""+i:i.toString);var s=i.extend||Object,n=i.construct,o=i.destruct;if(delete i.bind,delete i.extend,delete i.destruct,delete i.construct,i.hasOwnProperty("toString")&&"function"!=typeof i.toString){var a=i.toString;i.toString=function(){return""+a}}else!i.hasOwnProperty("toString")&&s.prototype.hasOwnProperty("toString")&&(i.toString=s.prototype.toString);var l=i,r=Object.create(s&&s.prototype);if(r.superClass=s.prototype,l)for(var d in l)l.hasOwnProperty(d)&&(r[d]=l[d],"function"==typeof l[d]&&(r[d]._methodName=d,r[d]._parentProto=r));r.inherited=function(t){var e=t.callee,i=e._methodName;if(!i)throw new Class.MissingCalleeError(""+this);for(var s=e._parentProto,n=null;s.superClass&&(s=s.superClass,n=s[i],"function"!=typeof n););if("function"==typeof n){var o=this.inherited;this.inherited=s.inherited;var a=n.apply(this,t);return this.inherited=o,a}throw new Class.InheritedMethodNotFoundError(""+this,i)},r.bind=t,r.destruct=function(){"function"==typeof o&&o.apply(this),s&&s.prototype&&"function"==typeof s.prototype.destruct&&s.prototype.destruct.apply(this)},r.construct=function(){var t=arguments;void 0===t[0]&&(t.length=1,t[0]={}),s&&s.prototype&&"function"==typeof s.prototype.construct&&s.prototype.construct.apply(this,arguments),"function"==typeof n&&n.apply(this,arguments)};var h=function(){var t=Object.create(r);return r.construct.apply(t,arguments),t};return h.toString=r.toString,h.prototype=r,h.extend=e,r.constructor=h,h},Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,s=function(){},n=function(){return i.apply(this instanceof s?this:t,e.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,n.prototype=new s,n}),Exception=new Class({extend:Error,construct:function(){this.name="Error",this.message="General exception"},toString:function(){return this.name+": "+this.message}});var i=Exception.extend({name:"Class Exception"});Class.NonTruthyExtendError=i.extend({construct:function(t){this.message=t+" attempted to extend a non-truthy object"}}),Class.InheritedMethodNotFoundError=i.extend({construct:function(t,e){this.message=t+" can't call method '"+e+"', no method defined in parent classes"}}),Class.MissingCalleeError=i.extend({construct:function(t){this.message=t+" can't call inherited method: calling method did not have _methodName"}})})();var CUI=CUI||{};CUI.options=$.extend({debug:!1,dataAPI:!0},CUI.options),function(){for(var t in CUI.Templates)Handlebars.registerPartial(t,CUI.Templates[t]);$(function(){$(document).trigger("cui-contentloaded")})}(),CUI.util={},CUI.util.getDataTarget=function(t){var e=t.attr("href"),i=$(t.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,""));return i},CUI.util.decapitalize=function(t){return t.slice(0,1).toLowerCase()+t.slice(1)},CUI.util.capitalize=function(t){return t.slice(0,1).toUpperCase()+t.slice(1)},function(t){function e(e,s){var n,o,a,l=e.nodeName.toLowerCase();return"area"===l?(n=e.parentNode,o=n.name,e.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap=#"+o+"]")[0],!!a&&i(a)):!1):(/input|select|textarea|button|object/.test(l)?!e.disabled:"a"===l?e.href||s:s)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}CUI.util.plugClass=function(e,i,s){i=i||CUI.util.decapitalize(""+e),t.fn[i]=function(n){return this.each(function(){var o=t(this),a=t.extend({},o.data(),"object"==typeof n&&n,{element:this}),l=o.data(i)||new e(a);"string"==typeof n?l[n].apply(l,Array.prototype.slice.call(arguments,1)):t.isPlainObject(n)&&l.set(n),"function"==typeof s&&s.call(this,l)})},t.fn[i].Constructor=e},CUI.util.buildFunction=function(t,e){if(e=e||[],"string"==typeof e&&(e=[e]),t)try{var i=Function;return new i(e,"return "+t+"("+e.join(", ")+");")}catch(s){return null}},CUI.util.selectText=function(e,i,s){var n=e.val();if(n.length>0){i=i||0,s=s||n.length;var o=t(e)[0];if(o.setSelectionRange)o.blur(),o.setSelectionRange(i,s),o.focus();else if(o.createTextRange){var a=o.createTextRange();a.collapse(!0),a.moveEnd("character",s-n.length),a.moveStart("character",i),a.select()}}},t.fn.loadWithSpinner=function(e,i,s){var n=t(this);if(e&&(i||n.data("loaded-remote")!==e)){var o=setTimeout(function(){n.html('<div class="spinner large"></div>')},50);n.load(e,function(t,e,i){clearTimeout(o),"error"===e&&(n.html('<div class="alert error"><strong>ERROR</strong> Failed to load content: '+i.statusText+" ("+i.status+")</div>"),n.data("loaded-remote","")),"function"==typeof s&&s.call(this,t,e,i)}),n.data("loaded-remote",e)}},t.fn.positionedParent=function(){var e;return t(this).parents().each(function(){var i=t(this),s=i.css("position");return"absolute"===s||"relative"===s?(e=i,!1):void 0}),e||t("body")},t.extend({getNested:function(t,e){if(!e)return t;for(var i="string"==typeof e?e.split("."):e,s=t;s&&i.length>0;)s=s[i.shift()];return s}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var s=t.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&e(i,!n)}})}(window.jQuery),function(t){var e="cui-state",i="cui-state-restore",s={},n=!1,o=t(document);CUI.util.state={config:{serverpersistence:!0},save:function(i,n,o,a){var l=t(i),r=function(t,e){s.global[i]=s.global[i]||{},s.global[i][e]=s.global[i][e]||{},s.global[i][e].val=l.attr(e),s.global[i][e].autorestore=o||!1,s.global[i][e].customEvent=a||null};n&&(t.isArray(n)?t.each(n,r):r(0,n)),localStorage.setItem(e,JSON.stringify(s)),CUI.util.state.config.serverpersistence&&t.cookie(e,JSON.stringify(s),{expires:7,path:"/"})},restore:function(e,a){var l,r,d=a||function(){return!0},h=function(e){l=e,r=t(l),s.global[l]&&t.each(s.global[l],c)},c=function(t,e){d(l,t,e)&&(r.attr(t,e.val),e.customEvent&&o.trigger(e.customEvent,[r,e]),o.trigger(i,[r,e]))};n||(n=CUI.util.state.load()),e?h(e):t.each(s.global,h)},load:function(){var t=localStorage.getItem(e);return s=t?JSON.parse(t):{global:{}},!0},setSessionItem:function(t,e,i){var s=t;i&&(s=t+":"+i),sessionStorage.setItem(s,JSON.stringify(e))},getSessionItem:function(t,e){var i=t;e&&(i=t+":"+e);var s=sessionStorage.getItem(i);return s&&(s=JSON.parse(s)),s},removeSessionItem:function(t,e){var i=t;e&&(i=t+":"+e),sessionStorage.removeItem(i)},clearSessionItems:function(t){if(t){t=":"+t;for(var e=sessionStorage.length,i=[],s=0;e>s;s++){var n=sessionStorage.key(s),o=n.length;o>t.length&&n.substring(o-t.length)===t&&i.push(n)}for(var a=i.length,l=0;a>l;l++)sessionStorage.removeItem(i[l])}}},o.ready(function(){CUI.util.state.restore(null,function(t,e,i){return i.autorestore?!0:!1})})}(jQuery,this),CUI.util.isTouch=!!("ontouchstart"in window),CUI.Widget=new Class({toString:"Widget",construct:function(t){this.options=$.extend({},"object"==typeof this.defaults&&this.defaults,t),this.$element=$(t.element),this.$element.data(CUI.util.decapitalize(""+this),this),this.bind(this.hide),this.bind(this.show),this.bind(this.toggleVisibility),this.on("change:visible",function(t){this[t.value?"_show":"_hide"]()}.bind(this)),this.options.visible&&(this.options.visible=!1,this.show())},set:function(t,e){if($.isPlainObject(t))for(var i in t)this._set(i,t[i]);else this._set(t,e);return this},_set:function(t,e){var i=$.Event("beforeChange:"+t,{widget:this,option:t,currentValue:this.options[t],value:e});return this.$element.trigger(i),i.isDefaultPrevented()?this:(this.options[t]=e,i=$.Event("change:"+t,{widget:this,option:t,value:e}),this.$element.trigger(i),void 0)},get:function(t){return this.options[t]},on:function(){return this.$element.on.apply(this.$element,arguments),this},off:function(){return this.$element.off.apply(this.$element,arguments),this},show:function(t){if(t=t||{},this.options.visible)return this;if(!t.silent){var e=$.Event("show");if(this.$element.trigger(e),e.isDefaultPrevented())return this}return this.options.visible=!0,this._show(t),this},_show:function(){this.$element.show()},hide:function(t){if(t=t||{},!this.options.visible)return this;if(!t.silent){var e=$.Event("hide");if(this.$element.trigger(e),e.isDefaultPrevented())return this}return this.options.visible=!1,this._hide(t),this},_hide:function(){this.$element.hide()},toggleVisibility:function(){return this[this.options.visible?"hide":"show"]()},setName:function(t){return this.toString=function(){return t},this}}),function(t){CUI.Modal=new Class({toString:"Modal",extend:CUI.Widget,construct:function(){this.$element.delegate('[data-dismiss="modal"]',"click.dismiss.modal",this.hide),this.$element.find(".modal-body").loadWithSpinner(this.options.remote),this.$element.addClass("modal"),this.$element.attr("tabIndex",-1),this.$element.attr("role","dialog"),this.$element.attr("aria-hidden",!0),this.$element.on("change:buttons",this._setButtons.bind(this)),this.$element.on("change:heading",this._setHeading.bind(this)),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:fullscreen",this._setFullscreen.bind(this)),0===this.$element.children().length?(this.$element.html(CUI.Templates.modal(t.extend({},this.options,{buttons:""}))),this.applyOptions(!0)):this.applyOptions()},defaults:{backdrop:"static",keyboard:!0,visible:!0,type:"default",fullscreen:!1},_types:["default","error","notice","success","help","info"],applyOptions:function(t){t||(this._setContent(),this._setHeading()),this._setButtons(),this._setType(),this._setFullscreen()},_setType:function(){"string"==typeof this.options.type&&-1!==this._types.indexOf(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type),this.center())},_setContent:function(){"string"==typeof this.options.content&&(this.$element.find(".modal-body").html(this.options.content),this.center())},_setHeading:function(){"string"==typeof this.options.heading&&(this.$element.find(".modal-header h2").html(this.options.heading),this.center())},_setFullscreen:function(){this.options.fullscreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")},_show:function(){if(t("body").addClass("modal-open"),this.$element.trigger(t.Event("beforeshow")),this._toggleBackdrop(!0),this._setEscapeHandler(!0),this.$element.parent("body").length||this.$element.appendTo(document.body),this.options.fullscreen){var e=this.$element.find(".modal-body"),i=this.$element.find(".modal-footer");e.css({bottom:i.outerHeight()})}else this.$element.css("visibility","hidden").css("left","0").show(),this.center(),this.$element.css("visibility","visible").css("left","50%").hide();this.$element.addClass("in").attr("aria-hidden",!1).fadeIn().focus(),this.options.fullscreen||this.$element.css("width",this.$element.innerWidth())},_hide:function(){return t("body").removeClass("modal-open"),this.$element.removeClass("in").attr("aria-hidden",!0),this.$element.fadeOut().trigger("hidden"),this._toggleBackdrop(!1),this._setEscapeHandler(!1),this},_setEscapeHandler:function(e){e&&this.options.keyboard?t("body").pointer("keyup",function(t){27===t.which&&this.hide()}.bind(this)):e||this.$element.off("keyup")},_removeBackdrop:function(){this.$backdrop&&!this.get("visible")&&(this.$backdrop.remove(),this.$backdrop=null)},_toggleBackdrop:function(e){e&&this.options.backdrop?this.$backdrop?this.$backdrop.fadeIn():(this.$backdrop=t('<div class="modal-backdrop" style="display: none;" />').appendTo(document.body).fadeIn(),"static"!==this.options.backdrop&&this.$backdrop.click(this.hide)):!e&&this.$backdrop&&this.$backdrop.fadeOut(function(){this._removeBackdrop()}.bind(this))},center:function(){if(this.options.fullscreen)return this;var t=this.$element.outerWidth(),e=this.$element.outerHeight();return this.$element.css("marginLeft",-t/2),this.$element.css("marginTop",-e/2),this},_setButtons:function(){if(t.isArray(this.options.buttons)){var e=this.$element.find(".modal-footer");e.children().remove(),t.each(this.options.buttons,function(i,s){var n=t(s.href?'<a class="button" />':'<button type="button" />');n.html(s.label),s.click&&("hide"===s.click?n.attr("data-dismiss","modal"):"function"==typeof s.click&&n.fipo("tap","click",s.click.bind(this,{dialog:this}))),s.href&&n.attr("href",s.href),s.className&&n.addClass(s.className),e.append(n)}.bind(this))}}}),CUI.util.plugClass(CUI.Modal),CUI.options.dataAPI&&t(function(){t("body").fipo("tap.modal.data-api","click.modal.data-api",'[data-toggle="modal"]',function(e){var i=t(this),s=CUI.util.getDataTarget(i),n=i.attr("href"),o=t.extend({remote:!/#/.test(n)&&n},s.data(),i.data());"string"==typeof o.buttons&&(o.buttons=JSON.parse(o.buttons));var a=s.data("modal"),l=!0;a&&a.get("visible")&&(l=!1),s.modal(o).one("hide",function(){i.focus()}),a&&s.data("modal").set({visible:l}),e.preventDefault()})})}(window.jQuery),function(t){CUI.Tabs=new Class({toString:"Tabs",extend:CUI.Widget,construct:function(){var i=this;this.$element.addClass("tabs"),this.options=t.extend({},this.defaults,this.options),this._setType(),this.options.tabs.length>0&&(void 0===this.options.active||null===this.options.active)&&(this.options.tabs.forEach(function(t,e){return t.active?(i.options.active=e,!1):void 0}),"number"!=typeof this.options.active&&(this.options.active=0,this.options.tabs[0].active=!0)),this.options.tabs.length>0&&this._render(),e(this.$element),setTimeout(this._setActive.bind(this),0),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:tabs",this._render.bind(this)),this.$element.on("change:active",this._setActive.bind(this))},defaults:{tabs:[]},_types:["white","nav","stacked"],_setType:function(){"string"==typeof this.options.type&&-1!==this._types.indexOf(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type))},_render:function(){t.isArray(this.options.tabs)&&this.$element.html(CUI.Templates.tabs(this.options))},_setActive:function(){var t,e=this.options.active;"number"==typeof e&&this.options.tabs.length>e&&e>=0?t=this.$element.find('nav > a[data-toggle="tab"]:eq('+e+")"):"string"==typeof e&&e.length>0&&(t=this.$element.find('nav > a[data-toggle="tab"]').filter('[data-target="#'+e+'"], [href="#'+e+'"]')),t&&i(t,!0)}});var e=function(e){e.children("nav").attr("role","tablist").each(function(){var i=t(this),s=i.attr("id");s||(i.data("init","tablist"),s="tablist-"+t.expando+"-"+this[t.expando],i.attr("id",s)),i.children('a[data-toggle="tab"]').attr("role","tab").attr("tabindex",-1).each(function(i){var n=t(this),o=n.attr("id");o||(o=s+"-tab-"+i,n.attr("id",o));var a=e.children("section:eq("+i+")").attr("role","tabpanel"),l=a.attr("id");l||(l=s+"-tabpanel-"+i,a.attr("id",l)),n.attr("aria-controls",l).attr("data-target","#"+l),"#"===n.attr("href")&&n.attr("href","#"+l),a.attr("aria-describedby",o),n.hasClass("active")&&(n.attr("tabindex",0).attr("aria-selected",!0),a.addClass("active").removeAttr("hidden")),n.hasClass("disabled")&&n.attr("aria-disabled",!0)})})},i=function(t,e){var i=CUI.util.getDataTarget(t);if(t&&i){if(t.hasClass("active"))return!1;if(t.hasClass("disabled"))return t.blur(),!1;"#"===i.selector&&(i=t.parents(".tabs").first().children("section:eq("+t.index()+")"));var s=t.attr("href"),n=!/#/.test(s)&&s;i.loadWithSpinner(n),t.addClass("active").attr("aria-selected",!0).attr("tabindex",0),t.siblings('a[data-toggle="tab"]').removeClass("active").removeClass("focus").attr("aria-selected",!1).attr("tabindex",-1),i.addClass("active").removeAttr("hidden"),i.siblings("section").removeClass("active").removeClass("focus").attr("hidden","hidden"),e||t.focus()}},s=function(){t(".tabs").each(function(){var s,n=t(this);0===(s=n.find("nav > a.active").first()).length&&(s=n.find("nav > a").first()),e(n),i(s,!0)})};CUI.util.plugClass(CUI.Tabs),CUI.options.dataAPI&&t(function(){s(),t("body").on("cui-onload.data-api",s),t("body").fipo("tap.tabs.data-api","click.tabs.data-api",'.tabs > nav > a[data-toggle="tab"]',function(e){var s=t(this),n=t("#"+s.attr("aria-controls"));return s.removeClass("focus"),n.removeClass("focus"),i(s,this===document.activeElement),"click"===e.type?(e.preventDefault(),!1):void 0}),t("body").on("focus.tabs.data-api",'.tabs > nav > a[data-toggle="tab"]',function(){var e=t(this),s=t("#"+e.attr("aria-controls"));CUI.util.isTouch||e.data("mousedown")||(e.addClass("focus").siblings('a[data-toggle="tab"]').removeClass("focus"),s.addClass("focus").siblings("section").removeClass("focus")),t(this).parents(".tabs").pointer("keydown.tabs.data-api",'nav > a[data-toggle="tab"]',function(e){var s=t(this),n=e.which;if(s.data("mousedown"),37===n||38===n){var o=s.prevAll().not(".disabled").first();0===o.length&&(o=s.siblings().not(".disabled").last()),s.data("mousedown")&&(o.data("mousedown",!0),s.removeData("mousedown")),i(o),e.preventDefault()}else if(39===n||40===n){var a=s.nextAll().not(".disabled").first();0===a.length&&(a=s.siblings().not(".disabled").first()),s.data("mousedown")&&(a.data("mousedown",!0),s.removeData("mousedown")),i(a),e.preventDefault()}})}).on("blur.tabs.data-api",'.tabs > nav > a[data-toggle="tab"]',function(){var e=t(this),i=t("#"+e.attr("aria-controls"));e.removeClass("focus").removeData("mousedown"),i.removeClass("focus")}).on("mousedown.tabs.data-api",'.tabs > nav > a[data-toggle="tab"]',function(){t(this).data("mousedown",!0)})})}(window.jQuery),function(t){CUI.Alert=new Class({toString:"Alert",extend:CUI.Widget,construct:function(){this.$element.delegate('[data-dismiss="alert"]',"click.dismiss.alert",this.hide),this.$element.addClass("alert"),this.$element.on("change:heading",this._setHeading.bind(this)),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:closable",this._setClosable.bind(this)),this.$element.on("change:size",this._setSize.bind(this)),t.each(this._types,function(t,e){return this.$element.hasClass(e)?(this.options.type=e,!1):void 0}.bind(this)),t.each(this._sizes,function(t,e){return this.$element.hasClass(e)?(this.options.size=e,!1):void 0}.bind(this)),0===this.$element.children().length?(this.options.heading=void 0===this.options.heading?this.options.type.toUpperCase():this.options.heading,this.$element.html(CUI.Templates.alert(this.options)),this.applyOptions()):this.applyOptions(!0)},defaults:{type:"error",size:"small",heading:void 0,visible:!0,closable:!0},_types:["error","notice","success","help","info"],_sizes:["small","large"],applyOptions:function(t){t||(this._setHeading(),this._setContent()),this._setClosable(),this._setType(),this._setSize()},_setContent:function(){"string"==typeof this.options.content&&this.$element.find("div").html(this.options.content)},_setHeading:function(){"string"==typeof this.options.content&&this.$element.find("strong").html(this.options.heading)},_setType:function(){"string"==typeof this.options.type&&-1!==this._types.indexOf(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type))},_setSize:function(){"string"==typeof this.options.size&&-1!==this._sizes.indexOf(this.options.size)&&("small"===this.options.size?this.$element.removeClass("large"):this.$element.addClass("large"))},_setClosable:function(){var t=this.$element.find(".close");t.length?t[this.options.closable?"show":"hide"]():this.$element.prepend('<button class="close" data-dismiss="alert">&times;</button>')}}),CUI.util.plugClass(CUI.Alert),CUI.options.dataAPI&&t(function(){t("body").fipo("tap.alert.data-api","click.alert.data-api",'[data-dismiss="alert"]',function(e){t(e.target).parent().hide(),e.preventDefault()})})}(window.jQuery),function(t){CUI.Rail=new Class({toString:"Rail",extend:CUI.Widget,construct:function(i){var s=this.$element,n=t.extend(!0,{},this.defaults,i),o='<div class="pull-to-refresh"><div class="icon"></div><div class="message"><i class="arrow"></i><i class="spinner large"></i><span class="pull">'+n.message.pull+"</span>"+'<span class="release">'+n.message.release+"</span>"+'<span class="loading">'+n.message.loading+"</span>"+"</div>"+"</div>",a={rail:s,content:s.find(".wrap"),ptr:s.find(".pull-to-refresh")},l=a.content.find("section.foldable"),r=a.content.find(".rail-switch");a.content.find(".quickform"),e(s),l.each(function(e,i){var s=t(i),n=s.find(".heading"),o=s.find(".fold");n.fipo("tap","click",function(t){var e=s.toggleClass("open").hasClass("open"),i=!1;o.attr({"aria-hidden":!e,"aria-expanded":e}),e&&"click"===t.type&&!n.is("a")&&(i=n.hasClass("focus"),o.attr("tabindex","-1").focus(),i&&n.addClass("focus"),setTimeout(function(){o.removeAttr("tabindex"),n.focus()},100))})}),t(document).finger("swipe",function(t){var e=30,i=a.rail.width(),s=t.touches.start[0].pageX,n=t.direction;"left"===n?i>s&&a.rail.addClass("closed"):"right"===n&&e>s&&a.rail.removeClass("closed")}),r.length>0&&this._initRailSwitcher(a.content,r),a.content.hasClass("accordion")&&this._initAccordion(a.content),i.refreshCallback&&(a.ptr.get(0)||(a.rail.prepend(o),a.ptr=s.find(".pull-to-refresh")),a=t.extend(a,{arrow:a.ptr.find(".arrow"),spinner:a.ptr.find(".spinner"),pull:a.ptr.find(".pull"),release:a.ptr.find(".release"),loading:a.ptr.find(".loading"),h:a.ptr.height(),active:!1,waiting:!1}),this._=a,this.callback=i.refreshCallback,a.rail.addClass("pullable"),a.content.finger("touchstart",t.proxy(this._handleTouchstart,this)).finger("touchmove",t.proxy(this._handleTouchmove,this)).finger("touchend",t.proxy(this._handleTouchend,this)))},defaults:{message:{pull:"Pull to refresh",release:"Release to refresh",loading:"Loading"}},_handleTouchstart:function(){var t=this._;
return t.waiting?!0:(t.rail.addClass("scroll touch"),0===t.rail.scrollTop()&&t.rail.scrollTop(1),void 0)},_handleTouchmove:function(){var t=this._,e=2*(t.h/3),i=t.rail.scrollTop(),s=180-(-t.h>i?180:-e>i?Math.round(180/(t.h-e)*(-i-e)):0);return t.waiting?!0:(t.arrow.show(),t.arrow.css("transform","rotate("+s+"deg)"),t.spinner.hide(),-i>t.h?(t.pull.css("opacity",0),t.loading.css("opacity",0),t.release.css("opacity",1),t.active=!0):i>-t.h&&(t.release.css("opacity",0),t.loading.css("opacity",0),t.pull.css("opacity",1),t.active=!1),void 0)},_handleTouchend:function(t){var e=this._,i=e.rail.scrollTop();e.active?(t.preventDefault(),e.waiting=!0,e.release.css("opacity",0),e.pull.css("opacity",0),e.loading.css("opacity",1),e.arrow.hide(),e.spinner.show(),e.rail.scrollTop(i-e.h),e.ptr.css("position","static"),e.active=!1,this.callback().done(function(){e.ptr.animate({height:0},"fast","linear",function(){e.ptr.css("position","absolute"),e.ptr.height(e.h),e.waiting=!1,e.rail.removeClass("touch")})})):e.rail.removeClass("touch")},_initAccordion:function(e){var i="active-accordion",s=e.find("section"),n=s.outerHeight(!0);s.each(function(o,a){var l=t(a),r=e.outerHeight(),d=r-s.length*n,h=l.find(".heading"),c=l.find(".fold");h.fipo("tap","click",function(){var t=(c.height(),e.data(i));t&&t.removeClass("open").find(".fold").height(0).attr({"aria-hidden":!0,"aria-expanded":!1}),c.height(d).attr({"aria-hidden":!1,"aria-expanded":!0}),e.data(i,l.addClass("open"))})})},_initRailSwitcher:function(e,i){var s,n=i.find("nav"),o=n.find("a"),a=e.find(".rail-view"),l=(e.find(".rail-view.active"),i.find("input"),"active");s=n.attr({role:"tablist"}).attr("id"),s||(n.data("rail-switch-tablist","rail-switch-tablist"),s="cui-rail-switch-tablist-"+t.expando+"-"+n[0][t.expando],n.attr("id",s)),o.each(function(i,n){var r=t(n),d=r.attr("id"),h=r.hasClass("active"),c=r.data("view"),p=e.find('.rail-view[data-view="'+c+'"]'),u=p.attr("id");d||(d=s+"-tab-"+c,r.attr("id",d)),u||(u=s+"-tabpanel-"+c,p.attr("id",u)),r.attr({role:"tab","aria-selected":h,tabindex:h?0:-1,"aria-controls":u}).filter('[href="#"]').attr("href","#"+u),p.attr({role:"tabpanel","aria-hidden":!h,"aria-expanded":h,"aria-labelledby":d}),r.fipo("tap","click",function(e){e.preventDefault(),a.removeClass(l).attr({"aria-hidden":!0,"aria-expanded":!1}),o.removeClass(l).attr({"aria-selected":!1,tabindex:-1}),t(this).addClass(l).attr({"aria-selected":!0,tabindex:0}),p.addClass("active").attr({"aria-hidden":!1,"aria-expanded":!0})}).focus(function(){CUI.util.isTouch||t(this).data("mousedown")||t(this).addClass("focus").parent().addClass("focus")}).blur(function(){t(this).removeClass("focus").removeData("mousedown").parent().removeClass("focus")}).mousedown(function(){t(this).data("mousedown",!0)}).keydown(function(e){switch(e.which){case 33:(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t(this).prev(":focusable").data("mousedown",!!t(this).data("mousedown")).focus().click());break;case 34:(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t(this).next(":focusable").data("mousedown",!!t(this).data("mousedown")).focus().click());break;case 35:o.last(":focusable").data("mousedown",!!t(this).data("mousedown")).not(this).focus().click();break;case 36:o.first(":focusable").data("mousedown",!!t(this).data("mousedown")).not(this).focus().click();break;case 37:case 38:e.preventDefault(),t(this).prev(":focusable").data("mousedown",!!t(this).data("mousedown")).focus().click();break;case 39:case 40:e.preventDefault(),t(this).next(":focusable").data("mousedown",!!t(this).data("mousedown")).focus().click()}})})}});var e=function(e){e.attr("role","complementary");var s,n=e.find(".wrap"),o=(n.find(".rail-switch"),n.hasClass("accordion")),a=n.find("section"),l=o?a:a.filter(".foldable"),r=l.find("h4, .heading"),d=l.find(".fold"),h=(a.not(".foldable"),null),c=null,p=e.find(".quickform"),u=p.find(".action"),m=p.find(">.control .trigger");if(l.not("[role]").attr("role","presentation"),o&&(l.each(function(){var e=t(this);e.parent().is(h)?e.siblings('[role="tablist"]').append(e):(h=e.parent(),c=t('<div role="tablist" class="tablist" aria-multiselectable="true"></div>'),e.wrap(c))}),d.is("ul")?(d.wrap('<div role="tabpanel" class="fold"></div>'),d=n.find('[role="tabpanel"]')):d.attr({role:"tabpanel"})),r.attr({tabindex:0}),o?r.attr({role:"tab"}):r.not("[role]").filter('span, a[href="#"]').attr({role:"button"}),s=o?e.find('[role="tablist"]'):n,s.each(function(){var e=t(this),i=e.attr("id");i||(e.data("rail-tablist","rail-tablist"),i="cui-rail-tablist-"+t.expando+"-"+this[t.expando],e.attr("id",i))}),d.each(function(e){var i=t(this),s=i.attr("id"),n=i.closest('[id|="cui-rail-tablist"]').attr("id"),o=i.closest("section"),a=o.find("h4, .heading"),l=a.attr("id"),r=o.hasClass("open");s||(s=n+"-fold"+e,i.attr("id",s)),l||(l=n+"-foldable"+e,a.attr("id",l)),a.attr("aria-controls",s).filter('[href="#"]').attr("href","#"+s),i.attr({"aria-labelledby":l,"aria-hidden":!r,"aria-expanded":r})}),e.on("focus",":focusable",function(e){var s,n,o=t(e.target);CUI.util.isTouch||o.data("mousedown")||o.addClass("focus"),(o.is("section :focusable")||o.is("input[type=text]"))&&(s=o.closest("section"),n=s.find("[aria-controls]"),r.filter("[aria-selected]").attr({"aria-selected":!1}),n.length>0&&(n.attr({"aria-selected":!0}),n.is('[role="tab"]')&&(n.attr("tabindex",0),r.not(n).not("section.open *").attr("tabindex",-1))),o.keydown(i).blur(function(e){var s=t(e.target),n=s.closest("section"),o=n.find("[aria-controls]");s.unbind("keydown",i).removeClass("focus").filter("[aria-selected]").attr("aria-selected",!1),o.length>0&&o.filter("[aria-selected]").attr("aria-selected",!1),s.is('[role="tab"]')&&(s.not("[aria-selected=true], a[href]").attr("tabindex",-1),0===r.filter("[tabindex=0]").length&&r.eq(0).attr("tabindex",0))}))}).on("blur",":focusable",function(e){var i=t(e.target);i.not('section :focusable, input[type="text"]')&&i.removeClass("focus")}).on("mousedown","label",function(e){var i=t(e.currentTarget),s=t("#"+i.attr("for"));0===s.length&&(s=i.find("input, textarea, select").filter(":focusable")),0===s.length&&i.attr("id")&&(s=t('[aria-labelledby*="'+i.attr("id")+'"]')),1===s.length&&setTimeout(function(){s.get(0).focus()},1)}),p.length>0&&u.length>0){u.attr("role","dialog");var f=u.attr("id");if(f||(u.data("rail-quickform-action","rail-quickform-action"),f="cui-rail-quickform-action-"+t.expando+"-"+u[0][t.expando],u.attr("id",f)),m.length>0){var g=m.attr("id");g||(g=f+"-trigger",m.attr("id",g)),u.attr({"aria-labelledby":g,tabindex:-1}),m.attr({role:"button","aria-pressed":"none"!==u.css("display"),"aria-haspopup":!0,"aria-controls":f}),p.on("click",">.control .trigger",function(){var t="none"!==u.css("display");m.attr({"aria-pressed":t}),t&&(u.attr("tabindex",-1).focus().removeAttr("tabindex"),u.on("keydown",function(t){27===t.which&&(p.removeClass("open"),m.attr({"aria-pressed":!1}).focus())}))})}}},i=function(e){var i,s=t(e.target),n=s.closest(".wrap"),o=(n.find(".rail-switch"),s.is("[data-view]"),n.hasClass("accordion")),a=n.find("section"),l=o?a:a.filter(".foldable"),r=(a.not(".foldable"),l.find("h4, .heading")),d=(l.find(".fold"),e.ctrlKey),h=(e.altKey,e.metaKey),c=e.shiftKey,p=s.is("[aria-controls]"),u=p?s.closest("section"):null,m=p?s:null,f=p?r.index(s):-1,g=n.find(":focusable"),v=g.index(s),b=v-1,$=v+1;switch(p||(u=s.parentsUntil(".wrap","section"),m=u.find("h4, .heading"),f=r.index(m)),e.which){case 9:g.length-1>$&&!c&&(i=g.eq($),i.is('[role="tab"]')&&t("#"+i.attr("aria-controls")).is('[aria-expanded="true"]')&&(g.eq($+1).focus(),e.preventDefault()));break;case 13:p&&!s.is("a[href]")&&m.click();break;case 32:p&&m.click();break;case 33:(d||h)&&(e.preventDefault(),r.eq(Math.max(0,f-1)).not(s).focus());break;case 34:(d||h)&&(e.preventDefault(),p?r.eq(Math.min(r.length-1,f+1)).not(s).focus():m.not(s).focus());break;case 35:r.last().not(s).focus();break;case 36:r.first().not(s).focus();break;case 37:case 38:p?(e.preventDefault(),r.eq(Math.max(0,f-1)).not(s).focus()):(d||h)&&38===e.which?(e.preventDefault(),m.not(s).focus()):u.length&&u.hasClass("links")&&b>0&&(e.preventDefault(),g.eq(b).not(s).focus());break;case 39:case 40:p?(e.preventDefault(),r.eq(Math.min(r.length-1,f+1)).not(s).focus()):u.length&&u.hasClass("links")&&g.length-1>$&&(e.preventDefault(),g.eq($).not(s).focus())}};CUI.util.plugClass(CUI.Rail)}(window.jQuery),function(t){var e=0;CUI.Popover=new Class({toString:"Popover",extend:CUI.Widget,construct:function(){this.$element.addClass("popover"),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:pointAt",this._setPointAt.bind(this)),this.$element.on("change:pointFrom",this._setPointFrom.bind(this)),""===this.$element.html()?this.applyOptions():this.applyOptions(!0),this.hide(),this.uuid=e+=1,this.cachedPointFrom=this.options.pointFrom},defaults:{pointFrom:"bottom",alignFrom:"left",pointAt:t("body"),arrowPos:"",visible:!0},_directions:["top","bottom","right","left"],applyOptions:function(t){t||this._setContent(),this._setPointAt(),this._setPointFrom()},setPosition:function(e){this._doSetPointFrom(this.options.pointFrom),this.$element.parent().get(0)!==t("body").get(0)&&this.$element.detach().appendTo(t("body"));var i=t(window).width(),s=t(window).height(),n=this.options.pointFrom,o=e[1],a=e[0],l=this.$element.outerWidth(),r=this.$element.outerHeight(),d=Math.round((this.$element.outerWidth()-this.$element.width())/1.5);"top"===n&&0>o-r-d&&(n="bottom",this._doSetPointFrom("bottom")),"bottom"===n&&o+r+d>s&&(n="top",this._doSetPointFrom("top")),("bottom"===n||"top"===n)&&(a-=l/2),"bottom"===n?o+=d:"top"===n&&(o-=r+d);var h=0,c=i-(a+l);0>c&&(h=c),0>a&&(h=-a),a+=h,0>h?this.$element.addClass("arrow-pos-right"):h>0?this.$element.addClass("arrow-pos-left"):this.$element.removeClass("arrow-pos-left arrow-pos-right"),this.$element.css({top:o,left:a})},_show:function(){this.$element.show(),this.options.preventAutoHide||t("body").fipo("tap.popover-hide-"+this.uuid,"click.popover-hide-"+this.uuid,function(e){var i=this.$element.get(0);e.target===i||t.contains(i,e.target)||(this.hide(),t("body").off(".popover-hide-"+this.uuid))}.bind(this))},_hide:function(){this.$element.hide(),t("body").off(".popover-hide-"+this.uuid)},_setContent:function(){"string"==typeof this.options.content&&this.$element.html(this.options.content)},_setPointAt:function(){var e=t(this.options.pointAt);if(1===e.length){this.$element.parent().get(0)!==e.parent().get(0)&&this.$element.detach().insertAfter(e);var i,s=6,n=e.position(),o=e.offset(),a=e.outerHeight(),l=e.outerWidth(),r=t(window).width(),d=t(window).height(),h=this.options.pointFrom,c=n.left,p=n.top,u=(o.top-parseInt(e.css("margin-top"))-p,o.left-parseInt(e.css("margin-left"))-c),m=this.$element.outerWidth(!0),f=this.$element.outerHeight(),g=this.$element.positionedParent().width(),v=parseFloat(this.$element.parent().css("padding-right")),b=Math.round((this.$element.outerWidth()-this.$element.innerWidth())/1.45),$=0;"top"===h&&0>o.top-f-a-b&&(h="bottom"),"bottom"===h&&o.top+f+b+a>d&&(h="top"),this._doSetPointFrom(h),("bottom"===h||"top"===h)&&(c-=m/2-l/2,"bottom"===h?p+=a+b:"top"===h&&(p-=f+a-b)),("left"===h||"right"===h)&&(p-=f/2-a/2,"left"===h?c-=m+b:"right"===h&&(c+=l+b)),i=g-c-m+2*v,0>u+c-s?$=-(u+c)+s:u+c+m+s>r&&($=r-(u+c+m)-s),c+=$,i-=$,"right"===this.options.alignFrom?this.$element.css({top:p,left:"auto",right:i}):this.$element.css({top:p,left:c,right:"auto"});var C=!1;("top"===h||"bottom"===h)&&(0>$||"right"===this.options.arrowPos?(this.$element.addClass("arrow-pos-right"),C=!0):($>0||"left"===this.options.arrowPos)&&(this.$element.addClass("arrow-pos-left"),C=!0)),C||this.$element.removeClass("arrow-pos-left arrow-pos-right")}},_doSetPointFrom:function(t){this.$element.removeClass("arrow-top arrow-bottom arrow-right arrow-left"),"bottom"===t?this.$element.addClass("arrow-top"):"top"===t?this.$element.addClass("arrow-bottom"):"left"===t?this.$element.addClass("arrow-right"):"right"===t&&this.$element.addClass("arrow-left")},_setPointFrom:function(){var t=this.options.pointFrom;-1!==this._directions.indexOf(t)&&this.cachedPointFrom!==t&&(this._doSetPointFrom(t),this.cachedPointFrom=t)}}),CUI.util.plugClass(CUI.Popover),t(function(){t("body").fipo("tap.popover.data-api","click.popover.data-api",'[data-toggle="popover"]',function(){var e=t(this),i=CUI.util.getDataTarget(e);i=i&&i.length>0?i:e.next(".popover");var s=i.popover(t.extend({pointAt:e},i.data(),e.data())).data("popover");s.toggleVisibility()}).on("click.popover.data-api",'[data-toggle="popover"]',!1)})}(window.jQuery),function(t){CUI.DropdownList=new Class({toString:"DropdownList",extend:CUI.Widget,construct:function(){var e=t('<div class="dropdown-container">'),i=this.options.positioningElement?this.options.positioningElement:this.$element;i.after(e),i.detach(),e.append(i),this.containerElement=e,this.$element.on("change:options change:optionRenderer",function(t){t.widget===this&&this.update()}.bind(this)),this.$element.on("keydown","",this._keyPressed.bind(this)),this.$element.on("blur","",function(){return this.preventHiding?(this.preventHiding=!1,void 0):(this.hide(),void 0)}.bind(this))},defaults:{positioningElement:null,optionRenderer:null,options:["Apples","Pears","Bananas","Strawberries"],cssClass:null,visible:!1,scrollBuffer:10,loadingIndicator:"<div class='spinner'></div>",noWidth:!1},listElement:null,containerElement:null,currentIndex:-1,preventHiding:!1,show:function(){this._unrender(),this.currentIndex=-1,this.$element.focus(),this._render()},hide:function(t){return t>0?setTimeout(this._unrender.bind(this),t):(this._unrender(),null)},isVisible:function(){return this.options.visible},toggle:function(){this.isVisible()?this.hide():this.show()},update:function(){this.listElement&&(this._unrender(),this._render())},addItems:function(e){var i=this.listElement.find("li").not(".loading-indicator").length;if(this.listElement){var s=this.listElement.find("ul");t.each(e,function(e,n){var o=this.options.optionRenderer?this.options.optionRenderer(e,n):t("<span>"+(""+n)+"</span>"),a=t('<li data-id="'+(i+e)+'">');e===this.currentIndex&&a.addClass("selected"),a.append(o),s.append(a),this.options.options.push(n)}.bind(this))}},getNumberOfItems:function(){var t=this.listElement.find("li").not(".loading-indicator").length;return t},addLoadingIndicator:function(){this.listElement&&this.listElement.find("ul").append(t("<li>"+this.options.loadingIndicator+"</li>").addClass("loading-indicator"))},removeLoadingIndicator:function(){this.listElement&&this.listElement.find(".loading-indicator").remove()},_keyPressed:function(e){var i=e.keyCode;if(this.listElement){var s=this.currentIndex;if(38===i&&(e.preventDefault(),s>0&&s--),40===i&&(e.preventDefault(),this.listElement.find("li").length-1>s&&s++),27===i)return e.preventDefault(),this.hide(),void 0;if((13===i||20===i)&&(e.preventDefault(),s>=0))return this._triggerSelect(s),void 0;this.currentIndex=s;var n=this.listElement.find("li");if(n.removeClass("selected"),s>=0){var o=t(n[s]);o.addClass("selected");var a=o.position().top;this.listElement.animate({scrollTop:a},50)}}},_unrender:function(){this.listElement&&(this.listElement.remove(),this.listElement=null),this.containerElement.removeClass("dropdown-visible"),this.options.visible=!1},_render:function(){var e=this.options.options;if(0!==e.length){var i=t("<ul></ul>");this.options.cssClass&&i.addClass(this.options.cssClass),t.each(e,function(e,s){var n=this.options.optionRenderer?this.options.optionRenderer(e,s):t("<span>"+(""+s)+"</span>"),o=t('<li data-id="'+e+'">');e===this.currentIndex&&o.addClass("selected"),o.append(n),i.append(o)}.bind(this)),i.on("click","li:not(.loading-indicator)",function(e){e.preventDefault(),this._triggerSelect(t(e.target).closest("li").attr("data-id"))}.bind(this));var s=this.options.positioningElement?this.options.positioningElement:this.$element,n=s.position().left+parseFloat(s.css("margin-left")),o=s.position().top+s.outerHeight(!0)-parseFloat(s.css("margin-bottom")),a=s.outerWidth(!1),l=t('<div class="dropdown-list">');l.append(i),i=l;var r={position:"absolute","z-index":"2000",left:n+"px",top:o+"px"};this.options.noWidth||(r.width=a+"px"),i.css(r),this.containerElement.addClass("dropdown-visible"),i.on("scroll","",function(){this._listScrolled()}.bind(this)),i.on("mousedown","",function(t){this.preventHiding=!0,t.preventDefault(),t.stopPropagation()}.bind(this)),s.after(i),this.listElement=i,this.options.visible=!0}},_listScrolled:function(){this._reachedListBottom()&&this._triggerScrolledBottom()},_reachedListBottom:function(){var t=this.listElement,e=this.listElement.find("ul");return e.height()-t.height()<=t.scrollTop()+this.options.scrollBuffer},_triggerSelect:function(e){this.$element.focus();var i=t.Event("dropdown-list:select",{selectedIndex:e,selectedValue:this.options.options[e],source:this});this.$element.trigger(i)},_triggerScrolledBottom:function(){var e=t.Event("dropdown-list:scrolled-bottom");this.$element.trigger(e)}}),CUI.util.plugClass(CUI.DropdownList)}(window.jQuery),function(t){CUI.Dropdown=new Class({toString:"Dropdown",extend:CUI.Widget,construct:function(){this.options.autocompleteCallback&&(this.options.editable=!0),this._render(),this._isMobile()&&!this.options.editable?this._initForMobile():this._initForDesktop();var t=this.$element.find(">div>button");t.length>0&&void 0===t.attr("type")&&t[0].setAttribute("type","button")},defaults:{options:[],multiple:!1,placeholder:"Select",disabled:!1,editable:!1,hasError:!1,noWidth:!1},dropdownList:null,autocompleteList:null,syncSelectElement:null,buttonElement:null,positioningElement:null,inputElement:null,hasFocus:!1,_initForMobile:function(){this.$element.addClass("mobile"),this.buttonElement.on("click",function(){this._openSelectInput()}.bind(this)),this.$element.find("select").on("change",function(){this._update(!0)}.bind(this)),this._placeSelect()},_initForDesktop:function(){this.dropdownList=new CUI.DropdownList({element:this.buttonElement,positioningElement:this.positioningElement,options:this.options.options,optionRenderer:this._optionRenderer.bind(this),noWidth:this.options.noWidth}),this.options.editable&&(this.autocompleteList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.positioningElement,options:this.options.options,optionRenderer:this._optionRendererAutocomplete.bind(this),noWidth:this.options.noWidth,cssClass:"autocomplete-results"})),this.buttonElement.on("dropdown-list:select",this._processSelect.bind(this)),this.buttonElement.on("mousedown","",function(t){t.preventDefault(),this.dropdownList.preventHiding=!1,null!==this.autocompleteList?this._adjustAutocompleter():this.dropdownList.toggle()}.bind(this)),this.buttonElement.on("mouseup","",function(t){t.preventDefault(),this.dropdownList.preventHiding=!0}.bind(this)),this.inputElement.on("click","",function(){null!==this.autocompleteList&&this._adjustAutocompleter()}.bind(this)),this.inputElement.on("input","",function(){null!==this.autocompleteList&&this._adjustAutocompleter()}.bind(this)),this.inputElement.on("dropdown-list:select","",function(t){this._processSelect(t)}.bind(this)),this.$element.children().on("focus","",function(){this.hasFocus=!0,this._update()}.bind(this)),this.$element.children().on("blur","",function(){this.hasFocus=!1,this._update()}.bind(this)),this.$element.find("select").on("change",function(){this._update(!0)}.bind(this))},_placeSelect:function(){var t=this.$element.find("select").first();t.css({position:"absolute",left:0,top:0,right:0,bottom:0,width:"auto",height:"auto"})},_openSelectInput:function(){var t=this.$element.find("select")[0];if(document.createEvent){var e=document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}else t.fireEvent&&t.fireEvent("onmousedown")},_adjustAutocompleter:function(){var e=this.inputElement.val(),i=function(t){this.autocompleteList.set({options:t}),this.autocompleteList.toggle()}.bind(this);if(this.options.autocompleteCallback)this.options.autocompleteCallback(i,e);else{var s=[];t.each(this.options.options,function(t,i){i.toLowerCase().indexOf(e.toLowerCase(),0)>=0&&s.push(i)}),i(s,e)}},_optionRenderer:function(e,i){var s=t("<span>"+i+"</span>");if(this.options.multiple){var n=t('<div class="checkbox">');this.syncSelectElement&&t(this.syncSelectElement.find("option").get(e)).attr("selected")&&n.addClass("checked"),s.prepend(n)}return s},_optionRendererAutocomplete:function(e,i){var s=this.inputElement.val(),n=i.toLowerCase().indexOf(s.toLowerCase());return n>=0&&(i=i.substr(0,n)+"<em>"+i.substr(n,s.length)+"</em>"+i.substr(n+s.length)),t("<span>"+i+"</span>")},_processSelect:function(e){if(this.syncSelectElement){var i=e.selectedValue,s=null;if(e.source===this.autocompleteList?(this.syncSelectElement.find("option").each(function(){t(this).attr("value")===i&&(s=t(this))}),null===s&&(s=t("<option>"),s.attr("value",i).text(i),this.syncSelectElement.append(s))):(s=t(this.syncSelectElement.find("option").get(e.selectedIndex)),i=s.attr("value")),this.options.multiple){var n=this.syncSelectElement.val();null===n&&(n=[]),n.indexOf(i)>=0?n.splice(n.indexOf(i),1):n.push(i),this.syncSelectElement.val(n),this.dropdownList.update()}else this.syncSelectElement.val(i),this.dropdownList.hide();this.syncSelectElement.change()}this._update(!0)},_render:function(){if(this._readDataFromMarkup(),"DIV"!==this.$element.get(0).tagName){var e=t("<div></div>");this.$element.after(e),this.$element.detach(),e.append(this.$element),this.$element=e}this._createMissingElements(),this.buttonElement=this.$element.find("button"),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.positioningElement=this.options.editable?this.$element:this.buttonElement,this.inputElement.attr("name")||this.inputElement.attr("name",this.syncSelectElement.attr("name")+".edit"),this.syncSelectElement.attr("multiple")&&(this.options.multiple=!0),this.$element.addClass("dropdown"),this.options.editable&&this.$element.addClass("dropdown-editable"),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.$element.find("select option").each(function(e,i){this.options.options.push(t(i).html())}.bind(this))),this.options.multiple?this.syncSelectElement.attr("multiple","multiple"):this.syncSelectElement.removeAttr("multiple","multiple"),this.options.placeholder&&(this.buttonElement.text(this.options.placeholder),this.inputElement.attr("placeholder",this.options.placeholder)),this._update(!0)},_readDataFromMarkup:function(){this.$element.attr("disabled")&&(this.options.disabled=!0),this.$element.attr("data-disabled")&&(this.options.disabled=!0),this.$element.attr("multiple")&&(this.options.multiple=!0),this.$element.attr("data-multiple")&&(this.options.multiple=!0),this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),this.$element.attr("data-editable")&&(this.options.editable=!0),this.$element.attr("data-error")&&(this.options.hasError=!0),this.$element.hasClass("error")&&(this.options.hasError=!0),this.$element.attr("data-nowidth")&&(this.options.noWidth=!0)},_createMissingElements:function(){if(0===this.$element.find("button").length){var e=t("<button>"+this.options.placeholder+"</button>");e.addClass("dropdown"),this.$element.append(e)}if(this.options.editable&&0===this.$element.find("input").length){var i=t('<input type="text">');this.$element.prepend(i)}if(0===this.$element.find("select").length){var s=t("<select>");this.$element.append(s)}},_update:function(t){if(t&&this.syncSelectElement&&!this.options.multiple){var e=this.syncSelectElement.find("option:selected");if(e){e.index();var i=e.text(),s=e.html();this.inputElement.length>0?this.inputElement.val(i).trigger("change"):this.buttonElement.html(s)}}this.options.disabled?(this.buttonElement.attr("disabled","disabled"),this.inputElement.attr("disabled","disabled")):(this.buttonElement.removeAttr("disabled"),this.inputElement.removeAttr("disabled")),this.hasFocus?this.$element.addClass("focus"):this.$element.removeClass("focus"),this.options.hasError?this.$element.addClass("error"):this.$element.removeClass("error")},_isMobile:function(){return"object"==typeof window.ontouchstart}}),CUI.util.plugClass(CUI.Dropdown),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=dropdown]",e.target).dropdown()})}(window.jQuery),function(t){CUI.Filters=new Class({toString:"Filters",extend:CUI.Widget,construct:function(){for(this.selectedIndices=[],this.createdIndices=[],this.options.autocompleteCallback?this.usingExternalData=!0:this.options.autocompleteCallback=this._defaultAutocompleteCallback.bind(this),this.options.optionRenderer||(this.options.optionRenderer=CUI.Filters.defaultOptionRenderer),this._readDataFromMarkup(),this.options.stacking&&(this.options.multiple=!0),this._render(),this.options.optionDisplayStrings.length>this.options.options.length&&(this.options.optionDisplayStrings=this.options.optionDisplayStrings.slice(0,this.options.options.length));this.options.optionDisplayStrings.length<this.options.options.length;)this.options.optionDisplayStrings.push(this.options.options[this.options.optionDisplayStrings.length]);this.dropdownList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.options.stacking?this.$element:this.inputElement,cssClass:"autocomplete-results"}),this._addEventListeners()},defaults:{autocompleteCallback:null,optionRenderer:null,options:[],optionDisplayStrings:[],multiple:!1,delay:200,highlight:!0,stacking:!1,placeholder:null,allowCreate:!1,icons:null,iconSize:"small",infiniteLoad:!1,maxLoadingItems:20,hasError:!1},dropdownList:null,syncSelectElement:null,inputElement:null,typeTimeout:null,selectedIndex:-1,selectedIndices:null,createdIndices:null,triggeredBackspace:!1,usingExternalData:!1,selectedValue:null,isLoadingExternal:!1,loadedEverything:!1,setSelectedIndex:function(t){-1>t||t>=this.options.options.length||(this.inputElement.attr("value",""),this.selectedIndex=t,this.options.multiple&&t>=0&&0>this.selectedIndices.indexOf(1*t)&&this.selectedIndices.push(1*t),this.options.multiple||(this.selectedIndices=t>=0?[t]:[]),this._update())},removeSelectedIndex:function(t){var e=this.selectedIndices.indexOf(1*t);0>e||(this.selectedIndices.splice(e,1),this._update())},getSelectedIndex:function(){return this.selectedIndex},setSelectedIndices:function(t){this.selectedIndices=t.slice(0),this._update()},getSelectedIndices:function(){return this.selectedIndices.slice(0)},_addEventListeners:function(){this.$element.on("change:disabled",this._update.bind(this)),this.$element.on("change:placeholder",this._update.bind(this)),this.$element.on("change:options",this._changeOptions.bind(this)),this.$element.on("input","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=setTimeout(this._inputChanged.bind(this),this.options.delay))}.bind(this)),this.$element.on("click touchend","input",function(){this.options.disabled||(this.inputElement.focus(),this._inputChanged())}.bind(this)),this.$element.on("blur","input",function(){if(!this.options.disabled){this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=null,!this.options.multiple&&this.selectedIndex>=0&&(""===this.inputElement.attr("value")?this.setSelectedIndex(-1):this._update());var t=this.options.hasError||!this.options.multiple&&this.inputElement.val().length>0&&0>this.selectedIndex;this.$element.toggleClass("error",t)}}.bind(this)),this.$element.on("keydown","input",this._keyPressed.bind(this)),this.$element.on("keyup","input",this._keyUp.bind(this)),this.dropdownList.on("dropdown-list:select","",function(e){this.options.infiniteLoad&&(this.loadedEverything=!1),this.dropdownList.hide(200),this.usingExternalData&&(this._createNewOption(""+e.selectedValue,""+e.selectedValue,!0),this._update());var i=t.inArray(""+e.selectedValue,this.options.options);this.setSelectedIndex(1*i)}.bind(this)),this.options.infiniteLoad&&this.dropdownList.on("dropdown-list:scrolled-bottom","",function(){if(!this.isLoadingExternal&&!this.loadedEverything){this.isLoadingExternal=!0,this.dropdownList.addLoadingIndicator();var e=this.dropdownList.getNumberOfItems(),i=this.inputElement.attr("value");this.options.autocompleteCallback(t.proxy(this._appendLoadedData,this),i,e,this.options.maxLoadingItems)}}.bind(this)),this.$element.on("click","[data-dismiss=filter]",function(e){if(!this.options.disabled){var i=t(e.target).closest("[data-id]");return this.removeSelectedIndex(i.attr("data-id")),!1}}.bind(this)),this.$element.on("input","input",function(){this.options.disabled||this._correctInputFieldWidth()}.bind(this)),this.$element.on("focus","input",function(t){this.options.disabled||(this.$element.addClass("focus"),t.preventDefault())}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||this.$element.removeClass("focus")}.bind(this))},_changeOptions:function(t){t.widget===this&&(this.selectedIndex=-1,this.selectedIndices=[],this.createdIndices=[],this._update())},_render:function(){var e;"SELECT"===this.$element.get(0).tagName&&(e=t("<div></div>"),this.$element.after(e),this.$element.detach(),e.append(this.$element),this.$element=e),"INPUT"===this.$element.get(0).tagName&&(e=t("<div></div>"),this.$element.after(e),this.$element.detach(),e.prepend(this.$element),this.$element=e),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.options.optionDisplayStrings=[],this.$element.find("select option").each(function(e,i){this.options.options.push(t(i).val()),this.options.optionDisplayStrings.push(t.trim(t(i).text())),t(i).attr("selected")&&(this.selectedIndices.push(e),this.selectedIndex=e)}.bind(this))),this._createMissingElements(),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.$element.addClass("filters"),this.$element.removeClass("focus"),this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.name&&this.syncSelectElement.attr("name",this.options.name),this.options.stacking?this.$element.addClass("stacking"):this.$element.removeClass("stacking"),this._update()},_createMissingElements:function(){if(0===this.$element.find("select").length&&this.$element.append(t("<select "+(this.options.multiple?"multiple":"")+"></select>")),0===this.$element.find("input").length&&this.$element.prepend(t('<input type="text">')),this.$element.find("select option").length<this.options.options.length)for(var e=this.$element.find("select option").length;this.options.options.length>e;e++){var i=this.options.options[e],s=this.options.optionDisplayStrings[e]||this.options.options[e],n=t("<option></option>");n.text(s),n.attr("value",i),this.$element.find("select").append(n)}},_readDataFromMarkup:function(){this.$element.attr("multiple")&&(this.options.multiple=!0),this.$element.attr("data-multiple")&&(this.options.multiple=!0),this.$element.attr("data-stacking")&&(this.options.stacking=!0),this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),this.$element.attr("disabled")&&(this.options.disabled=!0),this.$element.hasClass("error")&&(this.options.hasError=!0),this.$element.find("input").hasClass("error")&&(this.options.hasError=!0),this.$element.attr("data-disabled")&&(this.options.disabled=!0),"create"===this.$element.attr("data-allow")&&(this.options.allowCreate=!0),this.$element.attr("data-option-renderer")&&(this.options.optionRenderer=CUI.Filters[this.$element.attr("data-option-renderer")+"OptionRenderer"],this.options.optionRenderer||(this.options.optionRenderer=CUI.Filters.defaultOptionRenderer))
},_update:function(){if(this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled")),!this.options.multiple){if(this.syncSelectElement&&this.syncSelectElement.find("option:selected").removeAttr("selected"),this.selectedIndex>=0){this.syncSelectElement&&t(this.syncSelectElement.find("option").get(this.selectedIndex)).attr("selected","selected");var e=this.options.options[this.selectedIndex];this.options.optionDisplayStrings[this.selectedIndex]&&(e=this.options.optionDisplayStrings[this.selectedIndex]),this.inputElement.attr("value",e)}else this.inputElement.attr("value","");return this.$element.find("select").change(),void 0}if(this.syncSelectElement){this.syncSelectElement.find("option:selected").removeAttr("selected");for(var i=0;this.selectedIndices.length>i;i++){var s=this.selectedIndices[i];t(this.syncSelectElement.find("option").get(s)).attr("selected","selected")}}var n=t('<ul class="tags"></ul>');t.each(this.selectedIndices,function(e,i){var s=this.options.options[i],o=this.options.optionRenderer.bind(this)(i,s,!1,!1),a=t('<li data-id="'+i+'"><button data-dismiss="filter">&times;</button></li>');n.append(a),a.append(o)}.bind(this)),this.$element.find("ul").remove(),n.children().length>0&&(this.options.stacking?this.$element.prepend(n):this.$element.append(n)),this._correctInputFieldWidth(),this.$element.find("select").change()},_keyUp:function(t){var e=t.keyCode;8===e&&(this.triggeredBackspace=!1)},_keyPressed:function(t){var e=t.keyCode;if(8===e&&(this.triggeredBackspace===!1&&0===this.inputElement.attr("value").length&&this.options.multiple&&this.selectedIndices.length>0&&(t.preventDefault(),this.removeSelectedIndex(this.selectedIndices[this.selectedIndices.length-1]),this._inputChanged()),this.triggeredBackspace=!0),this.dropdownList.isVisible())13===e&&0>this.dropdownList.currentIndex&&(this.dropdownList.hide(),t.preventDefault());else if(40===e&&(this._inputChanged(),t.preventDefault()),13===e){var i=this.inputElement.val();i.length>0&&(this._createNewOption(i,i,!1),t.preventDefault())}},_createNewOption:function(e,i,s){var n=-1;if(t.each(this.options.options,function(t,i){this.options.optionDisplayStrings[t]===e&&(n=t),i===e&&(n=t)}.bind(this)),n>=0)return this.setSelectedIndex(n),void 0;if(this.options.allowCreate||s){var o=this.options.options.length;if(this.options.options.push(e),this.options.optionDisplayStrings.push(i),this.syncSelectElement){var a=t("<option></option>");a.text(i),a.attr("value",e),s||a.attr("data-new","true"),this.syncSelectElement.append(a)}s||this.createdIndices.push(o),this.setSelectedIndex(o)}},_correctInputFieldWidth:function(){if(this.options.stacking){var e=this.inputElement,i=e.attr("value");0===i.length&&(i=e.attr("placeholder"));var s=["font-family","font-weight","font-style","font-size","letter-spacing","line-height","text-transform"],n=t('<div style="position: absolute; display: none;"></div>');t.each(s,function(t,i){n.css(i,e.css(i))}),n.text(i),t("body").append(n);var o=n.width()+25;n.remove();var a=parseFloat(e.css("margin-left"))+parseFloat(e.css("margin-right")),l=0===this.selectedIndices.length;(l||o>this.$element.width()-a)&&(o=this.$element.width()-a),e.width(o)}},_inputChanged:function(){this.options.infiniteLoad&&(this.loadedEverything=!1);var e=this.inputElement.attr("value");this.options.autocompleteCallback(t.proxy(this._showAutocompleter,this),e,0,this.options.infiniteLoad?this.options.maxLoadingItems:500)},_appendLoadedData:function(t){return this.dropdownList.removeLoadingIndicator(),0===t.length?(this.loadedEverything=!0,this.isLoadingExternal=!1,void 0):(this.dropdownList.addItems(t),this.isLoadingExternal=!1,void 0)},_showAutocompleter:function(e){if(this.dropdownList.hide(),this.options.multiple){var i=[];t.each(e,function(e,s){var n=t.inArray(s,this.options.options);this.selectedIndices.indexOf(n)>=0||i.push(s)}.bind(this)),e=i}if(0!==e.length){var s=function(e,i){return this.options.optionRenderer.bind(this)(e,i,this.options.highlight,!t.isEmptyObject(this.options.icons))};this.dropdownList.set("optionRenderer",s.bind(this)),this.dropdownList.set("options",e),this.dropdownList.show()}},_defaultAutocompleteCallback:function(e,i){var s=[];t.each(this.options.options,function(t,e){var n=e;this.options.optionDisplayStrings[t]&&(n=this.options.optionDisplayStrings[t]),n.toLowerCase().indexOf(i.toLowerCase(),0)>=0&&s.push(e)}.bind(this)),e(s,i)},_buildIcon:function(t,e,i){return"url"===t?'<i class="'+i+' icon-inline-bg-image" style="background-image: url('+e+')">'+"icon"+"</i>":"cuiIcon"===t?'<i class="'+e+" "+i+'">'+e.split("icon-")[1]+"</i>":void 0}}),CUI.util.plugClass(CUI.Filters),t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=filters]",e.target).filters()})}(window.jQuery),CUI.Filters.defaultOptionRenderer=function(t,e,i,s){var n=$.inArray(e,this.options.options),o=e;this.options.optionDisplayStrings[n]&&(o=this.options.optionDisplayStrings[n]);var a=this.inputElement.val();if(i){var l=o.toLowerCase().indexOf(a.toLowerCase());l>=0&&(o=o.substr(0,l)+"<em>"+o.substr(l,a.length)+"</em>"+o.substr(l+a.length))}if(this.createdIndices.indexOf(n)>=0&&(o+="&nbsp;*"),s){var r;if((r=this.options.icons[e])!==void 0){var d=/^icon-/i.test(r)?"cuiIcon":"url";o=this._buildIcon(d,r,this.options.iconSize)+o}}return $("<span>"+o+"</span>")},CUI.Filters.cqTagOptionRenderer=function(t,e,i){function s(t){return $("<div>").text(t).html()}var n=$.inArray(e,this.options.options),o=e;this.options.optionDisplayStrings[n]&&(o=this.options.optionDisplayStrings[n]);var a=this.inputElement.val(),l=o.split(":");2>l.length&&(l[1]="");var r=l[0],d=l[1],h=d.split("/");o=r+": ";for(var c=0;h.length>c;c++){var p=h[c];if(i){var u=p.toLowerCase().indexOf(a.toLowerCase());p=u>=0?s(p.substr(0,u))+"<em>"+s(p.substr(u,a.length))+"</em>"+s(p.substr(u+a.length)):s(p)}else p=s(p);c>0&&(o+=" / "),c===h.length-1&&(p="<b>"+p+"</b>"),o+=p}return this.createdIndices.indexOf(n)>=0&&(o+="&nbsp;*"),$("<span>"+o+"</span>")},function(t){CUI.Slider=new Class({toString:"Slider",extend:CUI.Widget,construct:function(e){var i=this;i.options=t.extend({},this.defaults,e),this.$element.hasClass("vertical")&&(i.options.orientation="vertical",i.isVertical=!0),i.$element.hasClass("tooltips")&&(i.options.tooltips=!0),i.$element.hasClass("ticked")&&(i.options.ticks=!0),this.$element.hasClass("filled")&&(i.options.filled=!0),this.$element.data("slide")&&(i.options.slide=!0),this.$element.hasClass("bound")&&(i.options.bound=!0);var s=this.$element.attr("id");s||(this.$element.data("_tmp",0).attr("id","cui-slider-"+t.expando+"-"+this.$element.get(0)[t.expando]).removeData("_tmp"),s=this.$element.attr("id")),this._renderMissingElements();var n,o=i.$element.find("fieldset");if(o.length){i.$element.append(o.contents(":not(legend)"));var a=t('<div role="group" class="sliderfieldset" />');if(i.$element.wrap(a),n=o.find("legend").first(),n.length){var l=t("<label/>").append(n.contents());t.each(n.prop("attributes"),function(){l.attr(this.name,this.value)}),l.attr("id")||l.attr("id",s+"-legend"),a.attr("aria-labelledby",l.attr("id")),o.replaceWith(l),n=l.insertBefore(i.$element)}}i.$inputs=this.$element.find("input");var r=[];i.$inputs.each(function(e){var o=t(this),a=o.attr("id");a||(o.attr("id",s+"-input"+e),a=o.attr("id")),o.attr("aria-labelledby")||o.attr("aria-labelledby","");var l=i.$element.find("label[for='"+a+"']");n&&-1===o.attr("aria-labelledby").indexOf(n.attr("id"))&&o.attr("aria-labelledby",n.attr("id")+(o.attr("aria-labelledby").length?" ":"")+o.attr("aria-labelledby")),l.length&&(l.not(o.parent()).insertBefore(i.$element),l.each(function(e){t(this).attr("id")||t(this).attr("id",a+"-label"+e),-1===o.attr("aria-labelledby").indexOf(a+"-label"+e)&&o.attr("aria-labelledby",(o.attr("aria-labelledby").length?" ":"")+a+"-label"+e),CUI.util.isTouch||t(this).fipo("touchstart","mousedown",function(){i.$handles.eq(e).focus()}.bind(this))})),o.parent().is("label")&&(l=o.parent(),l.attr("id")||l.attr("id",a+"-label"),l.attr("for")||l.attr("for",a),o.insertAfter(l),n&&l.addClass("hidden-accessible"),l.insertBefore(i.$element)),l.length&&-1===o.attr("aria-labelledby").indexOf(l.attr("id"))&&o.attr("aria-labelledby",o.attr("aria-labelledby")+(o.attr("aria-labelledby").length?" ":"")+l.attr("id")),0===l.length&&o.attr("aria-labelledby").length>0&&(l=t("#"+o.attr("aria-labelledby").split(" ")[0])),0===o.attr("aria-labelledby").length&&o.removeAttr("aria-labelledby"),o.is("[step]")||o.attr("step",i.options.step),o.is("[min]")||o.attr("min",i.options.min),o.is("[max]")||o.attr("max",i.options.max),o.is("[value]")?r.push(o.attr("value")):(o.attr({value:i.options.value,"aria-valuetext":i.options.valuetextFormatter(i.options.value)}),r.push(i.options.value)),0===e&&(o.is(":disabled")?(i.options.disabled=!0,i.$element.addClass("disabled")):i.options.disabled&&(o.attr("disabled","disabled"),i.$element.addClass("disabled"))),CUI.util.isTouch?(o.on("change",function(){i.options.disabled||o.val()!==i.values[e]&&i.setValue(o.val(),e)}.bind(this)),o.on("focus",function(t){i._focus(t)}.bind(this)),o.on("blur",function(t){i._blur(t)}.bind(this))):(o.attr({"aria-hidden":!0,tabindex:-1,hidden:"hidden"}),0===e&&(l&&l.on("click",function(t){i.options.disabled||i._clickLabel(t)}.bind(this)),n&&n.on("click",function(t){i.options.disabled||i._clickLabel(t)}.bind(this))))}),i.values=r,"vertical"===this.options.orientation&&(this.isVertical=!0),this.$element.fipo("touchstart","mousedown",function(t){this._mouseDown(t)}.bind(this)),this.$element.on("change:value",this._processValueChanged.bind(this)),this.$element.on("change:disabled",this._processDisabledChanged.bind(this)),this.$element.on("change:min",this._processMinMaxStepChanged.bind(this)),this.$element.on("change:max",this._processMinMaxStepChanged.bind(this)),this.$element.on("change:step",this._processMinMaxStepChanged.bind(this)),this._render()},defaults:{step:"1",min:"1",max:"100",value:"1",orientation:"horizontal",slide:!1,disabled:!1,tooltips:!1,tooltipFormatter:function(t){return""+t},valuetextFormatter:function(t){return""+t},ticks:!1,filled:!1,bound:!1},values:[],$inputs:null,$ticks:null,$fill:null,$handles:null,$tooltips:null,isVertical:!1,draggingPosition:-1,setValue:function(t,e){e=e||0,this._updateValue(e,t,!0),this._moveHandles(),this.options.filled&&this._updateFill()},_renderMissingElements:function(){if(!this.$element.find("input").length){var e,i=this,s=t.isArray(this.options.value)?this.options.value:[this.options.value];t.each(s,function(s,n){e=t("<input>"),e.attr({type:"range",min:i.options.min,max:i.options.max,step:i.options.step,value:n}).val(n),i.$element.append(e)})}if(!this.$element.find("div.clickarea").length){var n=t('<div class="clickarea">');this.$element.prepend(n)}this.$element.toggleClass("slider",!0),this.$element.toggleClass("vertical","vertical"===this.options.orientation),this.$element.toggleClass("tooltips",this.options.tooltips),this.$element.toggleClass("ticked",this.options.ticks),this.$element.toggleClass("filled",this.options.filled)},_processValueChanged:function(){var e=this,i=t.isArray(this.options.value)?this.options.value:[this.options.value];t.each(i,function(t,i){e._updateValue(t,i,!0)}),this._moveHandles(),this.options.filled&&this._updateFill()},_processMinMaxStepChanged:function(){var e=this;this.$element.find("input").attr("min",this.options.min),this.$element.find("input").attr("max",this.options.max),this.$element.find("input").attr("step",this.options.step),t.each(this.values,function(t,i){e._updateValue(t,i,!0)}),this.options.ticks&&(this.$element.find(".ticks").remove(),this._buildTicks()),this.options.filled&&(this.$element.find(".fill").remove(),this._buildFill()),this._moveHandles(),this.options.filled&&this._updateFill()},_processDisabledChanged:function(){this.options.disabled?(this.$inputs.attr("disabled","disabled"),this.$handles.each(function(){t(this).removeClass("focus"),t(this).parent().removeClass("focus")}),CUI.util.isTouch&&this.$handles.attr("aria-disabled",!0).removeAttr("tabindex")):(this.$inputs.removeAttr("disabled"),CUI.util.isTouch&&this.$handles.removeAttr("aria-disabled").attr("tabindex",0)),this.$element.toggleClass("disabled",this.options.disabled)},_render:function(){var e=this,i=e.$inputs.map(function(){return t(this).attr("max")});e.options.max=Math.max.apply(null,i.toArray());var s=e.$inputs.map(function(){return t(this).attr("min")});e.options.min=Math.min.apply(null,s.toArray());var n=e.$inputs.map(function(){return t(this).attr("step")});e.options.step=Math.min.apply(null,n.toArray()),e.options.ticks&&e._buildTicks(),e.options.filled&&e._buildFill(),e._buildHandles()},_buildTicks:function(){var e=this,i=t("<div></div>").addClass("ticks");this.$element.prepend(i);for(var s=Math.round((e.options.max-e.options.min)/e.options.step)-1,n=e.isVertical?e.$element.height():e.$element.width(),o=0;s>o;o++){var a=(o+1)*(n/(s+1)),l=100*(a/n),r=t("<div></div>").addClass("tick").css(e.isVertical?"bottom":"left",l+"%");i.append(r)}e.$ticks=i.find(".tick"),e.options.filled&&e._coverTicks()},_buildFill:function(){var e=this;if(this.$fill=t("<div></div>").addClass("fill"),0!==e.values.length){var i,s;2>e.values.length?(i=100*((e.values[0]-e.options.min)/(e.options.max-e.options.min)),this.$fill.css(e.isVertical?"height":"width",i+"%")):(i=100*((this._getLowestValue()-e.options.min)/(e.options.max-e.options.min)),s=100*((this._getHighestValue()-this._getLowestValue())/(e.options.max-e.options.min)),this.$fill.css(e.isVertical?"height":"width",s+"%").css(e.isVertical?"bottom":"left",i+"%"))}this.$element.prepend(this.$fill),e.options.filled=!0},_buildHandles:function(){var e=this;e.$inputs.each(function(i){var s=t(this).wrap("<div></div>").parent().addClass("value"),n=100*((e.values[i]-e.options.min)/(e.options.max-e.options.min)),o=t("<div></div>").addClass("handle").css(e.isVertical?"bottom":"left",n+"%").attr({role:"slider",id:t(this).attr("id")+"-handle","aria-valuemin":e.options.min,"aria-valuemax":e.options.max,"aria-valuenow":e.values[i],"aria-valuetext":e.options.valuetextFormatter(e.values[i])});if(t(this).css(e.isVertical?"bottom":"left",n+"%"),t(s).append(o),e.options.tooltips){var a=t("<output>"+t(this).attr("value")+"</output>").addClass("tooltip").addClass(e.isVertical?"arrow-left":"arrow-bottom").attr({id:t(this).attr("id")+"-tooltip","for":t(this).attr("id")});o.append(a)}if(t(this).attr("aria-labelledby")&&o.attr("aria-labelledby",t(this).attr("aria-labelledby")),e.$inputs.length>1&&t(this).attr("aria-labelledby"))for(var l,r=t(this).attr("aria-labelledby").split(" "),d=0;r.length>d;d++)l=t("#"+r[d]),d>0&&(l.removeAttr("for"),o.prepend(l));CUI.util.isTouch?(o.attr("aria-hidden",!0),t(this).attr("tabindex",0).removeAttr("aria-hidden").removeAttr("hidden")):(o.on("focus",function(t){e._focus(t)}.bind(this)),o.on("blur",function(t){e._blur(t)}.bind(this)),o.on("keydown",function(t){e._keyDown(t)}.bind(this)),o.attr("tabindex",0),t(this).attr({"aria-hidden":!0,tabindex:-1,hidden:"hidden"})),e.options.disabled&&o.attr("aria-disabled",!0).removeAttr("tabindex")}),e.$handles=e.$element.find(".handle"),e.$tooltips=e.$element.find(".tooltip")},_handleClick:function(t){if(this.options.disabled)return!1;var e=this,i=t.pageX,s=t.pageY;if("touchstart"===t.type){var n=t.originalEvent.touches.length>0?t.originalEvent.touches:t.originalEvent.changedTouches;i=n[0].pageX,s=n[0].pageY}if(void 0!==i&&void 0!==s){var o=e._findNearestHandle(i,s),a=e._getValueFromCoord(i,s,!0);isNaN(a)||(e._updateValue(o,a),e._moveHandles(),e.options.filled&&e._updateFill()),CUI.util.isTouch||("mousedown"===t.type&&e.$handles.eq(o).data("mousedown",!0),e.$handles.eq(o).focus())}},_findNearestHandle:function(e,i){var s=this,n=999999,o=0;return s.$handles.each(function(a){var l=t(this).offset().left,r=t(this).offset().top,d=t(this).width(),h=t(this).height(),c=Math.abs(e-(l+d/2));"vertical"===s.options.orientation&&(c=Math.abs(i-(r+h/2))),n>c&&(n=c,o=a)}),o},_focus:function(e){if(this.options.disabled)return!1;var i=this,s=t(e.target),n=s.closest(".value"),o=n.find(".handle");o.data("mousedown")||(i.$element.addClass("focus"),n.addClass("focus"),o.addClass("focus"))},_blur:function(e){if(this.options.disabled)return!1;var i=this,s=t(e.target),n=s.closest(".value"),o=n.find(".handle");i.$element.removeClass("focus"),n.removeClass("focus"),o.removeClass("focus").removeData("mousedown")},_keyDown:function(e){if(!this.options.disabled){var i=this,s=t(e.target),n=s.closest(".value").find("input"),o=i.$inputs.index(n),a=Number(n.val()),l=Number(i.options.step),r=Number(i.options.min),d=Number(i.options.max),h=Math.max(l,Math.round((d-r)/10));switch(s.removeData("mousedown"),i._focus(e),e.keyCode){case 40:case 37:a-=l,e.preventDefault();break;case 38:case 39:a+=l,e.preventDefault();break;case 33:a+=h-a%h,e.preventDefault();break;case 34:a-=h-(0===a%h?0:h-a%h),e.preventDefault();break;case 35:a=d,e.preventDefault();break;case 36:a=r,e.preventDefault()}a!==Number(n.val())&&(i.setValue(a,o),n.change())}},_mouseDown:function(e){if(this.options.disabled)return!1;e.preventDefault();var i,s=this;return this.draggingPosition=-1,this.$handles.each(function(t,i){i===e.target&&(s.draggingPosition=t)}.bind(this)),this.$tooltips.each(function(t,i){i===e.target&&(s.draggingPosition=t)}.bind(this)),0>this.draggingPosition?(this._handleClick(e),void 0):(i=this.$handles.eq(this.draggingPosition),i.addClass("dragging"),this.$element.closest("body").addClass("slider-dragging-cursorhack"),t(window).fipo("touchmove.slider","mousemove.slider",this._handleDragging.bind(this)),t(window).fipo("touchend.slider","mouseup.slider",this._mouseUp.bind(this)),i===document.activeElement||CUI.util.isTouch||("mousedown"===e.type&&i.data("mousedown",!0),i.focus()),void 0)},_handleDragging:function(t){var e=t.pageX,i=t.pageY;if(t.originalEvent.targetTouches){var s=t.originalEvent.targetTouches.item(0);e=s.pageX,i=s.pageY}this._updateValue(this.draggingPosition,this._getValueFromCoord(e,i)),this._moveHandles(),this.options.filled&&this._updateFill(),t.preventDefault()},_mouseUp:function(){this.$handles.eq(this.draggingPosition).removeClass("dragging"),this.$element.closest("body").removeClass("slider-dragging-cursorhack"),this.draggingPosition=-1,t(window).unbind("mousemove.slider touchmove.slider"),t(window).unbind("mouseup.slider touchend.slider")},_clickLabel:function(){this.$handles.eq(0)[0].focus()},_updateValue:function(t,e,i){var s=this;(s.$inputs.eq(t).attr("value")!==""+e||s.values[t]!==""+e)&&(e>this.options.max&&(e=this.options.max),this.options.min>e&&(e=this.options.min),(0===t||1===t)&&(2===s.$inputs.length&&this.options.bound&&(0===t?(e=Math.min(e,Number(s.$inputs.eq(1).val())),s.$inputs.eq(1).attr({min:e}),s.$inputs.eq(t).attr({max:s.$inputs.eq(1).val()}),s.$handles.eq(1).attr({"aria-valuemin":e}),s.$handles.eq(t).attr({"aria-valuemax":s.$inputs.eq(1).val()})):(e=Math.max(e,Number(s.$inputs.eq(0).val())),s.$inputs.eq(0).attr({max:e}),s.$inputs.eq(t).attr({min:s.$inputs.eq(0).val()}),s.$handles.eq(0).attr({"aria-valuemax":e}),s.$handles.eq(t).attr({"aria-valuemin":s.$inputs.eq(0).val()}))),s.values[t]=""+e,s.$inputs.eq(t).val(e).attr({value:e,"aria-valuetext":s.options.valuetextFormatter(e)}),s.$handles.eq(t).attr({"aria-valuenow":e,"aria-valuetext":s.options.valuetextFormatter(e)}),i||setTimeout(function(){s.$inputs.eq(t).change()},1)))},_moveHandles:function(){var e=this;this.$handles.each(function(i){var s=100*((e.values[i]-e.options.min)/(e.options.max-e.options.min)),n=e.$inputs.eq(i);"vertical"===e.options.orientation?e.options.slide?(t(this).stop().animate({bottom:s+"%"}),n.stop().animate({bottom:s+"%"})):(t(this).css("bottom",s+"%"),n.css("bottom",s+"%")):e.options.slide?(t(this).stop().animate({left:s+"%"}),n.stop().animate({left:s+"%"})):(t(this).css("left",s+"%"),n.css("left",s+"%")),e.options.tooltips&&e.$tooltips.eq(i).html(e.options.tooltipFormatter(e.values[i]))})},_updateFill:function(){var t,e=this;if(0!==e.values.length)if(2===e.values.length){t=100*((e._getLowestValue()-e.options.min)/(e.options.max-e.options.min));var i=100*((e._getHighestValue()-e.options.min)/(e.options.max-e.options.min)),s=i-t;"vertical"===e.options.orientation?e.options.slide?e.$fill.stop().animate({bottom:t+"%",height:s+"%"}):e.$fill.css("bottom",t+"%").css("height",s+"%"):e.options.slide?e.$fill.stop().animate({left:t+"%",width:s+"%"}):e.$fill.css("left",t+"%").css("width",s+"%")}else t=100*((e.values[0]-e.options.min)/(e.options.max-e.options.min)),"vertical"===e.options.orientation?e.options.slide?e.$fill.stop().animate({height:t+"%"}):e.$fill.css("height",t+"%"):e.options.slide?e.$fill.stop().animate({width:t+"%"}):e.$fill.css("width",t+"%");e.options.ticks&&e._coverTicks()},_coverTicks:function(){var e=this;e.$ticks.each(function(){var i=e._getValueFromCoord(t(this).offset().left,t(this).offset().top);2===e.values.length?i>e._getLowestValue()&&e._getHighestValue()>i?t(this).hasClass("covered")||t(this).addClass("covered"):t(this).removeClass("covered"):e._getHighestValue()>i?t(this).hasClass("covered")||t(this).addClass("covered"):t(this).removeClass("covered")})},_getValueFromCoord:function(t,e,i){var s,n,o,a=this,l=a.$element.offset();if("vertical"===a.options.orientation){var r=a.$element.height();s=(l.top+r-e)/r}else{var d=a.$element.width();s=(t-l.left)/d}if(i&&(0>s||s>1))return 0/0;var h=1*a.options.min+(a.options.max-a.options.min)*s;return h>=a.options.max?a.options.max:a.options.min>=h?a.options.min:(o=(h-a.options.min)%a.options.step,n=2*Math.abs(o)>=a.options.step?h-o+1*a.options.step:h-o)},_getHighestValue:function(){return Math.max.apply(null,this.values)},_getLowestValue:function(){return Math.min.apply(null,this.values)}}),CUI.util.plugClass(CUI.Slider),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t(".slider[data-init~='slider']",e.target).slider()})}(window.jQuery),function(t){CUI.LabeledSlider=new Class({toString:"LabeledSlider",extend:CUI.Slider,alternating:!1,construct:function(){this.$element.addClass("labeled-slider")},_getTickLabel:function(t){var e=this.$element.find("ul.tick-labels li").eq(t);return e.html()},_buildTicks:function(){var e=this;this.$element.hasClass("label-alternating")&&(this.alternating=!0);var i=t("<div></div>").addClass("ticks");this.$element.prepend(i);var s=Math.ceil((e.options.max-e.options.min)/e.options.step)-1,n=e.isVertical?e.$element.height():e.$element.width(),o=n/(s+1);this.alternating&&(o*=2);for(var a=0;s>a;a++){var l=n*(a+1)/(s+1),r=t("<div></div>").addClass("tick").css(e.isVertical?"bottom":"left",l+"px");i.append(r);var d="tick-label-"+a,h=t("<div></div").addClass("tick-label "+d);e.isVertical||(l-=o/2),h.css(e.isVertical?"bottom":"left",l+"px"),e.isVertical||h.css("width",o+"px"),e.alternating&&!e.isVertical&&1===a%2&&(h.addClass("alternate"),r.addClass("alternate")),h.append(e._getTickLabel(a)),i.append(h)}e.$ticks=i.find(".tick"),e.options.filled&&e._coverTicks()}}),CUI.util.plugClass(CUI.LabeledSlider),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t(".slider[data-init~='labeled-slider']",e.target).labeledSlider()})}(window.jQuery),function(t){CUI.Datepicker=new Class({toString:"Datepicker",extend:CUI.Widget,defaults:{monthNames:null,dayNames:null,format:null,type:"date",selectedDateTime:null,startDay:0,disabled:!1,displayedFormat:null,storedFormat:null,headFormat:"MMMM YYYY",forceHTMLMode:!1,required:!1,hasError:!1},displayDateTime:null,pickerShown:!1,useNativeControls:!1,internFormat:"YYYY-MM-DD[T]HH:mmZ",officialDateFormat:"YYYY-MM-DD",officialTimeFormat:"HH:mm",officialDatetimeFormat:"YYYY-MM-DD[T]HH:mmZ",language:"coralui",construct:function(){function e(t){return t?moment([t.year(),t.month(),t.date()]):null}this._readDataFromMarkup(),this._adjustMarkup(),this.options.monthNames=this.options.monthNames||CUI.Datepicker.monthNames,this.options.dayNames=this.options.dayNames||CUI.Datepicker.dayNames,this.language="coralui_"+(new Date).getTime(),moment.lang(this.language,{months:this.options.monthNames,weekdaysMin:this.options.dayNames}),this.options.storedFormat=this.options.storedFormat||("time"===this.options.type?"HH:mm":"YYYY-MM-DD[T]HH:mmZ"),this.options.displayedFormat=this.options.displayedFormat||("time"===this.options.type?"HH:mm":"YYYY-MM-DD HH:mm"),this._isSupportedMobileDevice()&&this._supportsInputType(this.options.type)&&(this.useNativeControls=!0),this._updateState(),this.$openButton=this.$element.find("button"),this.$input=this.$element.find("input").not("[type=hidden]"),this.$hiddenInput=this.$element.find("input[type=hidden]"),this._isTimeEnabled()&&this._renderTime(),this.useNativeControls&&(this.options.displayedFormat="date"===this.options.type?this.officialDateFormat:"time"===this.options.type?this.officialTimeFormat:this.officialDatetimeFormat),this.useNativeControls||this._switchInputTypeToText(this.$input);var i=this.$input;if(this.$openButton,this.$element.find(".popover").first(),this.options.disabled||(t("body").on("click",function(){this.keepShown===!1&&this._hidePicker()}.bind(this)),this.$element.on("click",function(e){t(e.target).is(".icon-calendar")&&(this.pickerShown?this._hidePicker():this._openPicker()),this.keepShown=!0,setTimeout(function(){this.keepShown=!1}.bind(this),200)}.bind(this))),i.on("change"+(this._isSupportedMobileDevice()?" blur":""),function(){if(!this.options.disabled){var t=moment(this.$input.val(),this.options.displayedFormat);this._setDateTime(t,!0)}}.bind(this)),this.$element.find(".calendar").on("swipe",function(t){var i=t.direction;"left"===i?(this.displayDateTime=e(moment([this.displayDateTime.year(),this.displayDateTime.month()+1,1])),this._renderCalendar("left")):"right"===i&&(this.displayDateTime=e(moment([this.displayDateTime.year(),this.displayDateTime.month()-1,1])),this._renderCalendar("right"))}.bind(this)),this.$element.on("mousedown",".next-month",function(t){t.preventDefault(),this.displayDateTime&&(this.displayDateTime=e(moment([this.displayDateTime.year(),this.displayDateTime.month()+1,1])),this._renderCalendar("left"))}.bind(this)),this.$element.on("mousedown",".prev-month",function(t){t.preventDefault(),this.displayDateTime&&(this.displayDateTime=e(moment([this.displayDateTime.year(),this.displayDateTime.month()-1,1])),this._renderCalendar("right"))}.bind(this)),this._isTimeEnabled()){var s=function(){var t=this._getHoursFromDropdown(),e=this._getMinutesFromDropdown();this.options.selectedDateTime||(this.options.selectedDateTime=moment());var i=this.options.selectedDateTime.hours(t).minutes(e);this._setDateTime(i)};this.$element.on("dropdown-list:select",".hour,.minute",s.bind(this)),this.$element.on("change",".hour,.minute",s.bind(this))}this.useNativeControls&&(this.displayDateTime=this.options.selectedDateTime=moment(this.$input.val(),this.options.displayedFormat)),this.options.selectedDateTime||this._readInputVal([this.options.storedFormat,this.options.displayedFormat]),this._setDateTime(this.options.selectedDateTime)},_readDataFromMarkup:function(){this.$element.data("disabled")&&(this.options.disabled=!0),this.$element.hasClass("error")&&(this.options.hasError=!0),this.$element.data("required")&&(this.options.required=!0);var e=t(this.$element.find("input").filter("[type^=date],[type=time]"));0!==e.length&&(this.options.type=e.attr("type"));var i=this.$element;void 0!==i.data("displayed-format")&&(this.options.displayedFormat=i.data("displayed-format")),void 0!==i.data("stored-format")&&(this.options.storedFormat=i.data("stored-format")),void 0!==i.data("force-html-mode")&&(this.options.forceHTMLMode=i.data("force-html-mode")),void 0!==i.data("day-names")&&(this.options.dayNames=i.data("day-names")||this.options.dayNames),void 0!==i.data("month-names")&&(this.options.monthNames=i.data("month-names")||this.options.monthNames),void 0!==i.data("head-format")&&(this.options.headFormat=i.data("head-format")||this.options.headFormat),void 0!==i.data("start-day")&&(this.options.startDay=1*i.data("start-day"))},_readInputVal:function(t){t||(t=this.options.displayedFormat);var e=this.$input.eq(0).val(),i=moment(e,t);i&&i.isValid()||(i=moment(e)),this.displayDateTime=this.options.selectedDateTime=i},_updateState:function(){this.options.disabled?(this.$element.find("input,button").attr("disabled","disabled"),this._hidePicker()):this.$element.find("input,button").removeAttr("disabled"),this.options.hasError||!this.options.selectedDateTime&&this.options.required||this.options.selectedDateTime&&!this.options.selectedDateTime.isValid()?this.$element.addClass("error"):this.$element.removeClass("error")},_switchInputTypeToText:function(t){var e=t.detach().attr("type","text");this.$element.prepend(e)},_openNativeInput:function(){this.$input.trigger("tap")},_keyPress:function(){!this.pickerShown},_openPicker:function(){this.$element.addClass("focus"),this.useNativeControls?this._openNativeInput():(this._readInputVal(),this._showPicker())},_showPicker:function(){this._isDateEnabled()&&this._renderCalendar();var t=this.$openButton.position().left+this.$openButton.width()/2-this.$element.find(".popover").width()/2,e=this.$openButton.position().top+this.$openButton.outerHeight()+16;this.$element.find(".popover").css({position:"absolute",left:t+"px",top:e+"px"}).show(),this.pickerShown=!0},_hidePicker:function(){this.$element.removeClass("focus"),this.$element.find(".popover").hide(),this.pickerShown=!1},_adjustMarkup:function(){if(this.$element.addClass("datepicker"),this.useNativeControls||(0===this.$element.find("input").not("[type=hidden]").length&&this.$element.append('<input type="text">'),0===this.$element.find("button").length&&this.$element.append('<button class="icon-calendar small"><span>Datepicker</span></button>'),0===this.$element.find(".popover").length&&(this.$element.append('<div class="popover arrow-top" style="display:none"><div class="inner"></div></div>'),this._isDateEnabled()&&this.$element.find(".inner").append('<div class="calendar"><div class="calendar-header"></div><div class="calendar-body"></div></div>'))),0===this.$element.find("input[type=hidden]").length&&this.$element.append('<input type="hidden">'),!this.$element.find("input[type=hidden]").attr("name")){var t=this.$element.find("input").not("[type=hidden]").attr("name");this.$element.find("input[type=hidden]").attr("name",t),this.$element.find("input").not("[type=hidden]").removeAttr("name")}var e=this.$element.find(">button");void 0===e.attr("type")&&e[0].setAttribute("type","button")},_renderCalendar:function(e){this.displayDateTime&&this.displayDateTime.isValid()||(this.displayDateTime=moment());var i=this.displayDateTime,s=i.year(),n=i.month()+1,o=this._renderOneCalendar(n,s),a=this.$element.find(".calendar");o.on("mousedown","a",function(e){e.preventDefault();var i=moment(t(e.target).data("date"),this.internFormat);if(this._isTimeEnabled()){var s=this._getHoursFromDropdown(),n=this._getMinutesFromDropdown();i.hours(s).minutes(n)}this._setDateTime(i),this._isTimeEnabled()||this._hidePicker()}.bind(this)),a.find("table").length>0&&e?this._slideCalendar(o,"left"===e):(a.find("table").remove(),a.find(".sliding-container").remove(),a.find(".calendar-body").append(o)),this._updateState()},_getHoursFromDropdown:function(){return parseInt(this.$element.find(".time .hour select").val(),10)},_getMinutesFromDropdown:function(){return parseInt(this.$element.find(".time .minute select").val(),10)},_renderOneCalendar:function(e,i){function s(t,e){return t&&e?t.year()===e.year()&&t.month()===e.month()&&t.date()===e.date():void 0}var n=moment([i,e-1,1]).lang(this.language).format(this.options.headFormat),o=t('<div class="calendar-header"><h2>'+n+"</h2></div>"),a=t('<button class="next-month">›</button>'),l=t('<button class="prev-month">‹</button>');o.append(a).append(l);
var r=this.$element.find(".calendar");r.find(".calendar-header").length>0?r.find(".calendar-header").replaceWith(o):r.prepend(o);var d=null,h=t("<table>");h.data("date",i+"/"+e);for(var c="<tr>",p=0;7>p;p++){d=(p+this.options.startDay)%7;var u=this.options.dayNames[d];c+="<th><span>"+u+"</span></th>"}c+="</tr>",h.append("<thead>"+c+"</thead>");var m=moment([i,e-1,1]),f=(m.day()-this.options.startDay)%7;0>f&&(f+=7),c="";for(var g=moment(),v=0;6>v;v++){c+="<tr>";for(var b=0;7>b;b++){d=7*v+b-f+1;var $=moment([i,e-1,d]),C=$.month()+1===parseFloat(e),y="";s($,g)&&(y+=" today"),s($,this.options.selectedDateTime)&&(y+=" selected"),c+=C?'<td class="'+y+'"><a href="#" data-date="'+$.lang(this.language).format(this.internFormat)+'">'+$.date()+"</a></td>":'<td class="'+y+'"><span>'+$.date()+"</span></td>"}c+="</tr>"}return h.append("<tbody>"+c+"</tbody>"),h},_slideCalendar:function(e,i){this.$element.find(".sliding-container table").stop(!0,!0),this.$element.find(".sliding-container").remove();var s=this.$element.find("table"),n=s.width(),o=s.height(),a=t('<div class="sliding-container">');a.css({display:"block",position:"relative",width:n+"px",height:o+"px",overflow:"hidden"}),this.$element.find(".calendar-body").append(a),a.append(s).append(e),s.css({position:"absolute",left:0,top:0}),s.after(e),e.css({position:"absolute",left:i?n:-n,top:0});var l=400;s.animate({left:i?-n:n},l,function(){s.remove()}),e.animate({left:0},l,function(){0!==a.parents().length&&(e.css({position:"relative",left:0,top:0}),e.detach(),this.$element.find(".calendar-body").append(e),a.remove())}.bind(this))},_setDateTime:function(t,e){this.options.selectedDateTime=this.displayDateTime=t,t?t.isValid()&&this.$input.val(t.lang(this.language).format(this.options.displayedFormat)):this.$input.val("");var i=t&&t.isValid()?t.lang("en").format(this.options.storedFormat):"";this.$hiddenInput.val(i),this._updateState(),this._isDateEnabled()&&this._renderCalendar(),this._isTimeEnabled()&&this._renderTime(),e||this.$input.trigger("change"),this.$hiddenInput.trigger("change")},_getTimeFromInput:function(){if(this._isTimeEnabled()){var t=parseInt(this.$element.find(".time .hour button").text(),10),e=parseInt(this.$element.find(".time .minute button").text(),10),i=[t,e];return i}},_getTimeString:function(t,e){return this._pad(t)+":"+this._pad(e)+":"+this._pad(this.options.selectedDateTime.seconds())},_combineDateTimeStrings:function(t,e){return t+" "+e},_renderTime:function(){for(var e=t("<div class='time'><i class='icon-clock small'></i></div>"),i=t("<select></select>"),s=0;24>s;s++){var n=t("<option>"+this._pad(s)+"</option>");this.options.selectedDateTime&&s===this.options.selectedDateTime.hours()&&n.attr("selected","selected"),i.append(n)}for(var o=t('<div class="dropdown hour"><button></button></input>').append(i),a=t("<select></select>"),l=0;60>l;l++){var r=t("<option>"+this._pad(l)+"</option>");this.options.selectedDateTime&&l===this.options.selectedDateTime.minutes()&&r.attr("selected","selected"),a.append(r)}var d=t('<div class="dropdown minute"><button>Single Select</button></div>').append(a);t(o).css({position:"relative"}),t(d).css({position:"relative"}),t(o).find("select").css({position:"absolute",left:"1.5rem",top:"1rem"}),t(d).find("select").css({position:"absolute",left:"1.5rem",top:"1rem"}),e.append(o,t("<span>:</span>"),d),0===this.$element.find(".time").length?this.$element.find(".inner").append(e):this.$element.find(".time").empty().append(e.children()),t(o).dropdown(),t(d).dropdown()},_isSupportedMobileDevice:function(){return!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/iPhone|iPad|iPod/i)||this.options.forceHTMLMode?!1:!0},_supportsInputType:function(t){var e=document.createElement("input");return e.setAttribute("type",t),"text"!==e.type},_isDateEnabled:function(){return"date"===this.options.type||"datetime"===this.options.type||"datetime-local"===this.options.type},_isTimeEnabled:function(){return"time"===this.options.type||"datetime"===this.options.type||"datetime-local"===this.options.type},_pad:function(t){return 10>t?"0"+t:t}}),CUI.Datepicker.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],CUI.Datepicker.dayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],CUI.util.plugClass(CUI.Datepicker),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=datepicker]",e.target).datepicker()})}(window.jQuery),function(t){CUI.Pulldown=new Class({toString:"Pulldown",extend:CUI.Widget,defaults:{pulldownSize:0},timeout:null,popoverShown:!1,construct:function(){this._readDataFromMarkup();var t=this.$element.find("a").first(),e=this.$element.find(".popover").first();t.on("click",function(t){t.preventDefault(),this.togglePopover(),this._keepFocus()}.bind(this)),e.on("click",function(){this._keepFocus()}.bind(this)),t.on("blur",function(){this.timeout=setTimeout(function(){this.timeout=null,this.hidePopover()}.bind(this),200)}.bind(this)),e.fipo("tap","click","ul > li > a",function(){var t=this;setTimeout(function(){t.hidePopover()},500)}.bind(this))},_readDataFromMarkup:function(){this.$element.data("pulldownSize")&&(this.options.pulldownSize=1*this.$element.data("pulldownSize"))},_keepFocus:function(){var t=this.$element.find("a").first();t.is(".disabled, [disabled]")||(clearTimeout(this.timeout),this.timeout=null,t.focus())},togglePopover:function(){this.popoverShown?this.hidePopover():this.$element.find("a").first().is(".disabled, [disabled]")||this.showPopover()},showPopover:function(){this._placePopover(),this.$element.find(".popover").show(),this.popoverShown=!0},hidePopover:function(){this.$element.find(".popover").hide(),this.popoverShown=!1},setDisabled:function(t){t===!0?(this.$element.find("a").first().addClass("disabled"),this.hidePopover()):this.$element.find("a").first().removeClass("disabled")},_placePopover:function(){var e,i,s,n=this.$element.find("a").first(),o=this.$element.find(".popover"),a=n.position(),l=Math.max(n.width()+22,o.width()),r={width:l,height:n.height()};o.hasClass("alignleft")?(e=a.top+r.height,i=-30,s=30-l):(e=a.top+r.height+15,i=a.left+n.width()-r.width+5,s=r.width-30),o.css({top:e,left:i,width:r.width});var d=o.find("ul").first();if(this.options.pulldownSize>0){var h=0;d.find("li:lt("+this.options.pulldownSize+")").each(function(){h+=t(this).outerHeight()+t(this).find("a").first().outerHeight()}),d.css("max-height",h)}}}),CUI.util.plugClass(CUI.Pulldown),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=pulldown]",e.target).pulldown()})}(window.jQuery),function(t){CUI.Sticky=new Class({toString:"Sticky",extend:CUI.Widget,construct:function(){this.$element.addClass("sticky"),this.wrapper=t("<div>").addClass("sticky-wrapper"),this.$element.wrapAll(this.wrapper),this.wrapper=this.$element.parent(),this.wrapper.height(this.$element.outerHeight(!0)),this.scrollingElement=this.$element.parents(".sticky-container"),0===this.scrollingElement.length&&(this.scrollingElement=t(document),this.pageScroll=!0),this.scrollingElement.on("scroll",this._fixElementPosition.bind(this)),t(window).on("resize",this._fixElementPosition.bind(this))},_fixElementPosition:function(){var t=this.wrapper.offset().top,e=this.pageScroll?this.scrollingElement.scrollTop():this.scrollingElement.offset().top,i=this._getStickPosition(),s=this.wrapper.position().left,n=this.wrapper.width();if(e>t-i){if(!this.pageScroll){var o=this.scrollingElement.position();i+=o.top,s+=o.left,this.$element.detach(),this.scrollingElement.after(this.$element)}this.$element.css({position:this.pageScroll?"fixed":"absolute",top:i+"px",left:s,width:n+"px"})}else this.pageScroll||(this.$element.detach(),this.wrapper.append(this.$element)),this.$element.css({position:"",top:"",left:"",width:n+"px"})},_getStickPosition:function(){var e=this.wrapper.offset().top,i=0;return this.scrollingElement.find(".sticky-wrapper").each(function(s,n){e>t(n).offset().top&&(i+=t(n).outerHeight(!0))}.bind(this)),i},scrollingElement:null,pageScroll:!1,wrapper:null}),CUI.util.plugClass(CUI.Sticky),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t(".sticky,[data-init=sticky]",e.target).sticky()})}(window.jQuery),function(t){var e="grid",i="list",s="single",n="multiple",o={itemSelector:"article",headerSelector:"header",dataContainer:"grid-0",enableImageMultiply:!0,view:{selectedItem:{list:{cls:"selected"},grid:{cls:"selected"}},selectedItems:{list:{selector:"article.selected"},grid:{selector:"article.selected"}}},controller:{selectElement:{list:"article > i.select",grid:"article"},moveHandleElement:{list:"article > i.move"},targetToItem:{list:function(t){return t.closest("article")},grid:function(t){return t.closest("article")},header:function(t){return t.closest("header")}},gridSelect:{cls:"selection-mode"},selectAll:{selector:"header > i.select",cls:"selected"},sort:{columnSelector:".label > *"}}},a=function(t){return t.jquery?t.data("cardView-item"):t},l={equals:function(t,e){return t.length===e.length&&t.length===t.filter(e).length},getWidget:function(e){var i;return e.length>0&&(i=t(e[0]).data("cardView")),i},mixObjects:function(t,e){if(void 0===t)return e;var i={};for(var s in e)if(void 0!==t[s]){var n=t[s];"object"!=typeof t[s]||t[s]instanceof String||(n=this.mixObjects(t[s],e[s])),i[s]=n}else i[s]=e[s];return i},resolve:function(e,i){var s=[];return e.each(function(){s.push.apply(s,i(t(this)).toArray())}),t(s)},multiplyImages:function(e,i){function s(){o>a&&(n(e[a]),a++,setTimeout(s,0))}function n(e){var s=e.naturalWidth,o=e.naturalHeight;if(0===s&&0===o)return window.setTimeout(function(){n(e)},200),void 0;var a=t("<canvas width='"+s+"' height='"+o+"'></canvas>")[0],l=a.getContext("2d");l.drawImage(e,0,0,s,o);for(var r=l.getImageData(0,0,s,o),d=r.data,h=0,c=d.length;c>h;h+=4)d[h]*=i[0],d[h+1]*=i[1],d[h+2]*=i[2];l.putImageData(r,0,0),t("<img class='"+e.className+" multiplied' "+"width='"+s+"' height='"+o+"' "+"src='"+a.toDataURL("image/png")+"'/>").insertBefore(e)}e=e.filter(function(){var e=t(this);return!e.is(".multiplied")&&!e.prev().is(".multiplied")&&e.is(":visible")});var o=e.length,a=0;s()}},r=new Class({$el:null,$containerEl:null,stepSize:0,iid:void 0,autoMoveOffset:0,maxScrollTop:0,construct:function(t,e,i){this.$el=t,this.stepSize=e,this.$containerEl=this._getScrollingContainer(t);var s=this.$containerEl[0];this.maxScrollTop=Math.max(s.scrollHeight-s.clientHeight,0),this.autoMoveFn=i},_getScrollingContainer:function(e){for(;e.length>0&&!e.is("body");){var i=e.css("overflowY"),s=e.css("position");if(("auto"===i||"visible"===i)&&"absolute"===s)return e;e=e.parent()}return t(window)},_execute:function(){var t=this.$containerEl[0],e=t.clientHeight,i=t.scrollTop,s=this.$el.offset().top-this.$containerEl.offset().top,n=s+this.$el.height(),o=!1;return 0>=s?i>0&&(i-=this.stepSize,this.autoMoveOffset=-this.stepSize,0>i&&(i=0),t.scrollTop=i,o=!0):n>=e&&this.maxScrollTop>i&&(i+=this.stepSize,this.autoMoveOffset=this.stepSize,i>this.maxScrollTop&&(i=this.maxScrollTop),t.scrollTop=i,o=!0),o},_autoMove:function(){if(this.autoMoveOffset&&this.autoMoveFn){var t=this.$el.offset(),e=t.top+this.autoMoveOffset;this.autoMoveFn(t.left,e)}},check:function(){var t=this;this.stop();var e=this._execute();e&&(this.iid=window.setTimeout(function(){t.iid=void 0,t._autoMove()},50))},stop:function(){void 0!==this.iid&&(window.clearTimeout(this.iid),this.autoMoveOffset=0,this.iid=void 0)}}),d=new Class({$listEl:null,$itemEl:null,$items:null,$doc:null,$oldBefore:null,dragCls:null,fixHorizontalPosition:!1,autoScroller:null,construct:function(t){var e=this;this.$listEl=t.$listEl,this.$itemEl=t.$itemEl,this.$items=t.$items,this.dragCls=t.dragCls,this.fixHorizontalPosition=t.fixHorizontalPosition!==!1,this.autoScroller=t.autoScrolling?new r(this.$itemEl,8,function(t,i){e._autoMove(t,i)}):void 0},_getEventCoords:function(t){return t.originalEvent.touches?t.originalEvent.touches.length>0?{x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY}:t.originalEvent.changedTouches.length>0?{x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}:{x:t.pageX,y:t.pageY}:{x:t.pageX,y:t.pageY}},_limit:function(t,e){this.listOffset.left>e&&(e=this.listOffset.left),this.listOffset.top>t&&(t=this.listOffset.top);var i=e+this.size.width,s=t+this.size.height,n=this.listOffset.left+this.listSize.width,o=this.listOffset-t+this.listSize.height;return i>n&&(e=n-this.size.width),s>o&&(t=o-this.size.height),this.fixHorizontalPosition&&(e=this.listOffset.left),{top:t,left:e}},_getEventPos:function(t){var e=this._getEventCoords(t);return{x:e.x-this.delta.left,y:e.y-this.delta.top}},_adjustPosition:function(t,e){this.$itemEl.offset(this._limit(e,t)),this.autoScroller&&this.autoScroller.check()},_changeOrderIfRequired:function(){for(var e=this.$itemEl.offset(),i=e.left+this.size.width/2,s=e.top+this.size.height/2,n=null,o=!1,a=0;this.$items.length>a;a++){var r=t(this.$items[a]);if(!l.equals(r,this.$itemEl)){var d=r.offset(),h=r.width(),c=r.height(),p=d.top+c;if(i>=d.left&&d.left+h>i&&s>=d.top&&p>s){o=s-d.top>p-s,n=r;break}}}if(n){var u=this.$itemEl.offset();o?n.before(this.$itemEl):n.after(this.$itemEl),this.$itemEl.offset(u)}},_autoMove:function(t,e){this._adjustPosition(t,e),this._changeOrderIfRequired()},start:function(e){this.$oldPrev=this.$itemEl.prev(),this.$oldNext=this.$itemEl.next();var i=this._getEventCoords(e);this.dragCls&&this.$itemEl.addClass(this.dragCls);var s=this;this.$doc=t(document),this.$doc.fipo("touchmove.listview.drag","mousemove.listview.drag",function(t){s.move(t)}),this.$doc.fipo("touchend.listview.drag","mouseup.listview.drag",function(t){s.end(t)}),this.offset=this.$itemEl.offset(),this.delta={left:i.x-this.offset.left,top:i.y-this.offset.top},this.size={width:this.$itemEl.width(),height:this.$itemEl.height()},this.listOffset=this.$listEl.offset(),this.listSize={width:this.$listEl.width(),height:this.$listEl.height()},e.stopPropagation(),e.preventDefault()},move:function(t){var e=this._getEventPos(t);this._adjustPosition(e.x,e.y),this._changeOrderIfRequired(),t.stopPropagation(),t.preventDefault()},end:function(e){var i=this._getEventPos(e);this._adjustPosition(i.x,i.y),this.dragCls&&this.$itemEl.removeClass(this.dragCls),this.autoScroller&&this.autoScroller.stop(),this.$itemEl.css("position",""),this.$itemEl.css("top",""),this.$itemEl.css("left",""),this.$doc.off("touchmove.listview.drag"),this.$doc.off("mousemove.listview.drag"),this.$doc.off("touchend.listview.drag"),this.$doc.off("mouseup.listview.drag");var s=this.$itemEl.prev(),n=this.$itemEl.next();this.$itemEl.trigger(t.Event("item-moved",{newPrev:s,newNext:n,oldPrev:this.$oldPrev,oldNext:this.$oldNext,hasMoved:!l.equals(s,this.$oldPrev)})),e.stopPropagation(),e.preventDefault()}}),h=new Class({$itemEl:null,construct:function(t){this.$itemEl=t,this.reference()},getItemEl:function(){return this.$itemEl},reference:function(){this.$itemEl.data("cardView-item",this)}}),c=new Class({$headerEl:null,itemRef:null,construct:function(t,e){this.$headerEl=t,this.itemRef=e},getHeaderEl:function(){return this.$headerEl},getItemRef:function(){return this.itemRef},setItemRef:function(t){this.itemRef=t}}),p=new Class({construct:function(t){this.model=t.model,this.comparators=t.comparators,this.selectors=t.selectors,this.columnElement=t.columnElement,this.headerElement=t.columnElement.closest(this.selectors.headerSelector);var e=this.model.getHeaderForEl(this.headerElement);if(this.items=this.model.getItemsForHeader(e),this.isReverse=this.columnElement.hasClass("sort-asc"),this.toNatural=this.columnElement.hasClass("sort-desc"),this.fromNatural=!this.headerElement.hasClass("sort-mode"),this.comparator=null,this.comparators)for(var i in this.comparators)this.columnElement.is(i)&&(this.comparator=this.comparators[i]);this.comparator||(this.comparator=this._readComparatorFromMarkup())},_readComparatorFromMarkup:function(){var t=this.columnElement.data("sort-selector"),e=this.columnElement.data("sort-attribute"),i=this.columnElement.data("sort-type");return t||e?new CUI.CardView.DefaultComparator(t,e,i):null},_adjustMarkup:function(){this.fromNatural&&this.headerElement.addClass("sort-mode"),this.toNatural&&this.headerElement.removeClass("sort-mode"),this.headerElement.find(this.selectors.controller.sort.columnSelector).removeClass("sort-asc sort-desc"),this.columnElement.removeClass("sort-desc sort-asc"),this.toNatural||this.columnElement.addClass(this.isReverse?"sort-desc":"sort-asc");var e=this.toNatural;t.each(this.items,function(){this.getItemEl().find(".move").toggle(e)})},sort:function(){if(this.comparator||this.toNatural){this._adjustMarkup();var e=this.items.slice();if(this.comparator){this.comparator.setReverse(this.isReverse);var i=this.comparator.getCompareFn();this.toNatural||e.sort(i)}var s=this.headerElement;t.each(this.items,function(){this.getItemEl().detach()});for(var n=0;e.length>n;n++){var o=e[n].getItemEl();s.after(o),s=o}}}}),u=new Class({$el:null,items:null,headers:null,selectors:null,construct:function(e,i){this.$el=e,this.items=[],this.selectors=i;for(var s=this.$el.find(i.itemSelector),n=s.length,o=0;n>o;o++)this.items.push(new h(t(s[o])));this.headers=[];for(var a=this.$el.find(i.headerSelector),l=a.length,r=0;l>r;r++){var d=t(a[r]),p=d.nextAll(i.itemSelector),u=p.length>0?this.getItemForEl(t(p[0])):void 0;this.headers.push(new c(d,u))}},initialize:function(){var t=this;this.$el.on("item-moved",this.selectors.itemSelector,function(e){e.hasMoved&&t._reorder(e)})},_reorder:function(e){var i,s=this.getItemForEl(t(e.target)),n=this.getItemForEl(e.newPrev),o=!1;if(!n&&(i=this.getHeaderForEl(e.newPrev))){o=!0;var a=this.getItemIndex(i.getItemRef());a>0&&(n=this.getItemAt(a-1))}var l=this.getItemIndex(s);this.items.splice(l,1);var r=this._getHeaderByItemRef(s);r&&r.setItemRef(this.getItemAt(l));var d=n?this.getItemIndex(n)+1:0;this.items.splice(d,0,s),o&&i.setItemRef(s)},getItemCount:function(){return this.items.length},getItemAt:function(t){return this.items[t]},getItemIndex:function(t){for(var e=0;this.items.length>e;e++)if(t===this.items[e])return e;return-1},getItemForEl:function(t){for(var e=this.items.length,i=0;e>i;i++){var s=this.items[i];if(l.equals(s.getItemEl(),t))return s}return void 0},insertItemAt:function(e,i,s){t.isArray(e)||(e=e.toArray());for(var n=e.length-1;n>=0;n--){var o=e[n];o.jquery||(o=t(o));var a,r=new h(o);void 0===i||null===i?(this.items.push(r),i=this.items.length-1):(a=this.items[i],this.items.splice(i,0,r));for(var d={item:a,mode:"item"},c=this.headers.length,p=0;c>p;p++){var u=this.headers[p];if(u.getItemRef()===a){if(s){d={item:u,mode:"header"};break}u.setItemRef(r)}}this.$el.trigger(t.Event("change:insertitem",{insertPoint:d,followupItem:a,item:r,pos:i,widget:l.getWidget(this.$el),moreItems:n>0}))}},getHeaderCount:function(){return this.headers.length},getHeaderAt:function(t){return this.headers[t]},getHeaders:function(){var t=[];return t.push.apply(t,this.headers),t},getHeaderForEl:function(t){for(var e=this.headers.length,i=0;e>i;i++){var s=this.headers[i];if(l.equals(s.getHeaderEl(),t))return s}return void 0},_getHeaderByItemRef:function(t){for(var e=0;this.headers.length>e;e++)if(this.headers[e].getItemRef()===t)return this.headers[e];return void 0},getItemsForHeader:function(t){for(var e=t.getItemRef(),i=this.headers.length,s=this.items.length,n=[],o=!1,a=0;s>a;a++){var l=this.items[a];if(o){for(var r=0;i>r;r++)if(this.headers[r].getItemRef()===l){o=!1;break}if(!o)break;n.push(l)}else l===e&&(o=!0,n.push(e))}return n},fromItemElements:function(e){var i=[];return e.each(function(){var e=t(this).data("cardView-item");e&&i.push(e)}),i},reference:function(){for(var t=this.items.length,e=0;t>e;e++)this.items[e].reference()},removeAllItemsSilently:function(){this.items.length=0;for(var t=0;this.headers.length>t;t++)this.headers[t].setItemRef(void 0)}}),m=new Class({$el:null,selectors:null,construct:function(t,e){this.$el=t,this.selectors=e},initialize:function(){var t=this;this.$el.on("change:displayMode",function(e){var i=e.oldValue,s=e.value;t.cleanupAfterDisplayMode(i),t.prepareDisplayMode(s)}),this.$el.on("change:insertitem",function(e){t._onItemInserted(e)}),this.$el.reflow({small:function(t,e){return t.width()>40*e.rem()&&t.width()<50*e.rem()},xsmall:function(t,e){return t.width()>30*e.rem()&&t.width()<40*e.rem()},xxsmall:function(t,e){return t.width()<30*e.rem()}})},_onItemInserted:function(t){var s=this.$el;this.selectors.dataContainer&&(s=s.find("."+this.selectors.dataContainer));var n=t.item.getItemEl(),o=t.followupItem;switch(this.getDisplayMode()){case i:if(o){var a=t.insertPoint,r=a.item,d="item"===a.mode?r.getItemEl():r.getHeaderEl();d.before(n)}else s.append(n);break;case e:if(!t.moreItems){var h=l.getWidget(this.$el);h._restore(),h.layout()}}},getDisplayMode:function(){return l.getWidget(this.$el).getDisplayMode()},setSelectionState:function(t,i){var s=this.getDisplayMode(),n=this.selectors.view.selectedItem[s],o=t.getItemEl();n.selector&&(o=o.find(n.selector)),"selected"===i?(o.addClass(n.cls),s===e&&this._drawSelectedGrid(t)):"unselected"===i&&o.removeClass(n.cls)},getSelectionState:function(t){var e=this.selectors.view.selectedItem[this.getDisplayMode()],i=t.getItemEl();e.selector&&(i=i.find(e.selector));for(var s=e.cls.split(" "),n=0;s.length>n;n++)if(!i.hasClass(s[n]))return"unselected";return"selected"},getSelectedItems:function(){var t=this.selectors.view.selectedItems[this.getDisplayMode()],e=this.$el.find(t.selector);return t.resolver&&(e=t.resolver(e)),e},restore:function(e,i){var s=t("<div class='"+this.selectors.dataContainer+"'>");this.$el.empty(),this.$el.append(s);for(var n=e.getItemCount(),o=0;n>o;o++)s.append(e.getItemAt(o).getItemEl());if(i)for(var a=e.getHeaderCount(),l=0;a>l;l++){var r=e.getHeaderAt(l),d=r.getHeaderEl(),h=r.getItemRef();h?h.getItemEl().before(d):s.append(d)}},prepareDisplayMode:function(t){t===e&&this._drawAllSelectedGrid()},cleanupAfterDisplayMode:function(){},_drawImage:function(e){if(0!==e.length){if(void 0===this._colorFloat){var i=e.closest("a").css("background-color");this._colorFloat=t.map(i.match(/(\d+)/g),function(t){return t/255})}l.multiplyImages(e,this._colorFloat)}},_drawAllSelectedGrid:function(){if(this.selectors.enableImageMultiply){var e=this,i=this.selectors.view.selectedItems.grid.selector+" img",s=t(i);this._drawImage(s),s.load(function(){e._drawImage(t(this))})}},_drawSelectedGrid:function(e){if(this.selectors.enableImageMultiply){var i=this,s=e.getItemEl().find("img");this._drawImage(s),s.load(function(){i._drawImage(t(this))})}},removeAllItemsSilently:function(){this.$el.find(this.selectors.itemSelector).remove()}}),f=new Class({$el:null,selectors:null,comparators:null,selectionModeCount:null,_listSelect:!1,construct:function(t,e,i){this.$el=t,this.selectors=e,this.comparators=i,this.selectionModeCount=n},initialize:function(){this.setDisplayMode(this.$el.hasClass("list")?i:e);var s=this;this.$el.fipo("tap.cardview.select","click.cardview.select",this.selectors.controller.selectElement.list,function(t){var e=l.getWidget(s.$el);if(e.getDisplayMode()===i){var n=a(s.getItemElFromEvent(t));e.toggleSelection(n)&&(t.stopPropagation(),t.preventDefault()),"tap"===t.type&&(s._listSelect=!0)}}),this.$el.fipo("tap.cardview.select","click.cardview.select",this.selectors.controller.selectElement.grid,function(t){var i=l.getWidget(s.$el);if(i.getDisplayMode()===e&&i.isGridSelectionMode()){var n=a(s.getItemElFromEvent(t));i.toggleSelection(n)&&(t.stopPropagation(),t.preventDefault())}}),this.$el.fipo("tap.cardview.selectall","click.cardview.selectall",this.selectors.controller.selectAll.selector,function(e){var n=l.getWidget(s.$el);if(n.getDisplayMode()===i){var o=s.selectors.controller.selectAll.cls,a=s.selectors.controller.targetToItem.header(t(e.target)),r=n.getModel().getHeaderForEl(a);a.hasClass(o)?n.deselectAll(r):n.selectAll(r)}}),this.$el.fipo("tap.cardview.sort","click.cardview.sort",this.selectors.headerSelector+" "+this.selectors.controller.sort.columnSelector,function(e){var i=l.getWidget(s.$el),n=i.getModel(),o=t.Event("sortstart");if(t(e.target).trigger(o),!o.isDefaultPrevented()){var a=new p({model:n,columnElement:t(e.target),comparators:s.comparators,selectors:s.selectors});a.sort();var o=t.Event("sortend");t(e.target).trigger(o)}}),this.$el.on("selectstart.cardview",this.selectors.headerSelector+" "+this.selectors.controller.sort.columnSelector,function(t){t.preventDefault()}),this.$el.finger("click.cardview.select",this.selectors.controller.selectElement.grid,function(t){var i=l.getWidget(s.$el),n=i.getDisplayMode();n===e&&i.isGridSelectionMode()&&(t.stopPropagation(),t.preventDefault())});var n=this.selectors.controller.selectElement.listNavElement||this.selectors.controller.selectElement.grid;this.$el.finger("click.cardview.select",n,function(t){var e=l.getWidget(s.$el),n=e.getDisplayMode();n===i&&s._listSelect&&(t.stopPropagation(),t.preventDefault()),s._listSelect=!1}),this.$el.fipo("touchstart.cardview.reorder","mousedown.cardview.reorder",this.selectors.controller.moveHandleElement.list,function(e){var i=s.getItemElFromEvent(e),n=new d({$listEl:s.$el,$itemEl:i,$items:t(s.selectors.itemSelector),dragCls:"dragging",autoScrolling:!0});n.start(e)}),this.$el.on("change:selection",function(t){t.moreSelectionChanges||s._adjustSelectAllState(t.widget)}),this.$el.on("change:insertitem",function(t){t.moreItems||s._adjustSelectAllState(t.widget)})},_adjustSelectAllState:function(t){for(var e=this.selectors.controller.selectAll.cls,i=t.getHeaderSelectionState(),s=i.headers,n=s.length,o=0;n>o;o++){var a=s[o],l=a.header.getHeaderEl();a.hasUnselected?l.removeClass(e):l.addClass(e)}},getItemElFromEvent:function(e){var i=t(e.target),s=this.selectors.controller.targetToItem[this.getDisplayMode()];return t.isFunction(s)?s(i):i.find(s)},isGridSelect:function(){var t=this.selectors.controller.gridSelect,e=this.$el;return t.selector&&(e=e.find(t.selector)),e.hasClass(t.cls)},setGridSelect:function(e){if(this.isGridSelect()!==e){var i=this.selectors.controller.gridSelect,s=this.$el;i.selector&&(s=s.find(i.selector)),e?s.addClass(i.cls):(s.removeClass(i.cls),l.getWidget(s).clearSelection()),this.$el.trigger(t.Event("change:gridSelect",{widget:this.$el.data("cardView"),oldValue:!e,value:e}))}},getDisplayMode:function(){return this.$el.hasClass("list")?i:this.$el.hasClass("grid")?e:null},isColumnSorted:function(){return"list"==this.getDisplayMode()&&this.$el.find(this.selectors.headerSelector).filter(".sort-mode").length>0},setDisplayMode:function(s){var n=this.getDisplayMode();if(n!==s){var o=l.getWidget(this.$el);switch(o._restore(s===i),s){case e:if(this.$el.removeClass("list"),this.$el.addClass("grid"),null!==n){var a=o.getSelection();this.setGridSelect(a.length>0),o.layout()}break;case i:this.$el.cuigridlayout("destroy"),this.$el.removeClass("grid"),this.$el.addClass("list")}this.$el.trigger(t.Event("change:displayMode",{widget:this.$el.data("cardView"),oldValue:n,value:s}))}},getSelectionModeCount:function(){return this.selectionModeCount},setSelectionModeCount:function(t){this.selectionModeCount=t}}),g=new Class({$el:null,selectors:null,comparators:null,model:null,view:null,controller:null,construct:function(t,e){this.selectors=t,this.comparators=e},initialize:function(t){this.$el=t,this.setModel(new u(t,this.selectors)),this.setView(new m(t,this.selectors)),this.setController(new f(t,this.selectors,this.comparators)),this.model.initialize(),this.view.initialize(),this.controller.initialize()},setModel:function(t){this.model=t},getModel:function(){return this.model},setView:function(t){this.view=t},getView:function(){return this.view},setController:function(t){this.controller=t},getController:function(){return this.controller},isSelected:function(t){var e=this.view.getSelectionState(t);return"selected"===e},setSelected:function(t,e){var i=e?"selected":"unselected";this.view.setSelectionState(t,i)},getSelection:function(t){var e=this.view.getSelectedItems();return t===!0&&(e=this.model.fromItemElements(e)),e},getDisplayMode:function(){return this.controller.getDisplayMode()},isColumnSorted:function(){return this.controller.isColumnSorted()},setDisplayMode:function(t){this.controller.setDisplayMode(t)},isGridSelectionMode:function(){return this.controller.isGridSelect()},setGridSelectionMode:function(t){this.controller.setGridSelect(t)},getSelectionModeCount:function(){return this.controller.getSelectionModeCount()},setSelectionModeCount:function(t){this.controller.setSelectionModeCount(t)},_restore:function(t){this.view.restore(this.model,t),this.model.reference()},removeAllItems:function(){var t=l.getWidget(this.$el);t.clearSelection(),this.model.removeAllItemsSilently(),this.view.removeAllItemsSilently()}});CUI.CardView=new Class({toString:"CardView",extend:CUI.Widget,adapter:null,construct:function(t){var e=l.mixObjects(t.selectorConfig,o),i=t.comparators||null;this.adapter=new g(e,i),this.adapter.initialize(this.$element),this.layout(t.gridSettings)},getModel:function(){return this.adapter.getModel()},setModel:function(t){this.adapter.setModel(t)},isSelected:function(t){return this.adapter.isSelected(t)},getDisplayMode:function(){return this.adapter.getDisplayMode()},isColumnSorted:function(){return this.adapter.isColumnSorted()},setColumnSortable:function(){},isColumnSortable:function(){},setDisplayMode:function(t){this.adapter.setDisplayMode(t)},isGridSelectionMode:function(){return this.adapter.isGridSelectionMode()},setGridSelectionMode:function(t){this.adapter.setGridSelectionMode(t)},toggleGridSelectionMode:function(){this.setGridSelectionMode(!this.isGridSelectionMode())},getSelectionModeCount:function(){return this.adapter.getSelectionModeCount()},setSelectionModeCount:function(t){this.adapter.setSelectionModeCount(t)},select:function(e,i){e=a(e);var n=this.adapter.isSelected(e);n||(this.getSelectionModeCount()===s&&this.getSelection().length>0&&this.clearSelection(),this.adapter.setSelected(e,!0),this.$element.trigger(t.Event("change:selection",{widget:this,item:e,isSelected:!0,moreSelectionChanges:i===!0})))},deselect:function(e,i){e=a(e);var s=this.adapter.isSelected(e);s&&(this.adapter.setSelected(e,!1),this.$element.trigger(t.Event("change:selection",{widget:this,item:e,isSelected:!1,moreSelectionChanges:i})))},toggleSelection:function(e,i){e=a(e);var n=t.Event("beforeselect",{selectionCancelled:!1,stopEvent:!1,item:e,cancelSelection:function(t){this.selectionCancelled=!0,this.stopEvent=t===!0}});if(this.$element.trigger(n),n.selectionCancelled)return n.stopEvent;var o=this.isSelected(e);return!o&&this.getSelectionModeCount()===s&&this.getSelection().length>0&&this.clearSelection(),this.adapter.setSelected(e,!o),this.$element.trigger(t.Event("change:selection",{widget:this,item:e,isSelected:!o,moreSelectionChanges:i})),!0},getSelection:function(t){return this.adapter.getSelection(t===!0)},clearSelection:function(){for(var t=this.getSelection(!0),e=t.length,i=e-1,s=0;e>s;s++)this.deselect(t[s],i>s)},_headerSel:function(e,i,s){var n=this.adapter.getModel();null==e&&(e=n.getHeaders()),t.isArray(e)||(e=[e]);for(var o=e.length,a=0;o>a;a++){var l=e[a];l.jquery&&(l=n.getHeaderForEl(l));for(var r=n.getItemsForHeader(l),d=r.length,h=0;d>h;h++)i.call(this,r[h],!s(h,r))}},selectAll:function(t){if(this.getSelectionModeCount()===n){var e=this;this._headerSel(t,this.select,function(t,i){for(++t;i.length>t;t++)if(!e.isSelected(i[t]))return!1;return!0})}},deselectAll:function(t){var e=this;this._headerSel(t,this.deselect,function(t,i){for(++t;i.length>t;t++)if(e.isSelected(i[t]))return!1;return!0})},getHeaderSelectionState:function(){for(var t=this.getModel(),e=null,i={selected:[],hasUnselected:!1,headers:[]},s=t.getHeaderCount(),n=t.getItemCount(),o=0;n>o;o++){for(var a=t.getItemAt(o),l=0;s>l;l++){var r=t.getHeaderAt(l);if(r.getItemRef()===a){e={header:r,selected:[],hasUnselected:!1},i.headers.push(e);
break}}this.isSelected(a)?null!==e?e.selected.push(a):i.selected.push(a):null!==e?e.hasUnselected=!0:i.hasUnselected=!0}return i},layout:function(t){this.getDisplayMode()===e&&(this.$element.data("cuigridlayout")&&this.$element.cuigridlayout("destroy"),this.$element.cuigridlayout(t))},relayout:function(){this.getDisplayMode()===e&&this.$element.cuigridlayout("layout")},_restore:function(t){this.adapter._restore(t)},append:function(t){this.adapter.getModel().insertItemAt(t,null,!1)},prepend:function(t){this.adapter.getModel().insertItemAt(t,0,!1)},removeAllItems:function(){this.adapter.removeAllItems(),this.getDisplayMode()===e&&this.relayout(),this.$element.trigger(t.Event("change:removeAll",{widget:this}))}}),CUI.CardView.DefaultComparator=new Class({construct:function(t,e,i){this.selector=t,this.attribute=e,this.isNumeric="numeric"==i,this.reverseMultiplier=1},setReverse:function(t){this.reverseMultiplier=t?-1:1},compare:function(t,e){var i=t.getItemEl(),s=e.getItemEl(),n=this.selector?i.find(this.selector):i,o=this.selector?s.find(this.selector):s,a="",l="";return this.attribute?"data-"==this.attribute.substr(0,5)?(a=n.data(this.attribute.substr(5)),l=o.data(this.attribute.substr(5))):(a=n.attr(this.attribute),l=o.attr(this.attribute)):(a=n.text(),l=o.text()),this.isNumeric&&(a=1*a,l=1*l,isNaN(a)&&(a=0),isNaN(l)&&(l=0)),a>l?1*this.reverseMultiplier:l>a?-1*this.reverseMultiplier:0},getCompareFn:function(){return this.compare.bind(this)}}),CUI.CardView.DISPLAY_GRID=e,CUI.CardView.DISPLAY_LIST=i,CUI.CardView.SELECTION_MODE_COUNT_SINGLE="single",CUI.CardView.SELECTION_MODE_COUNT_MULTI="multiple",CUI.CardView.get=function(t){var e=l.getWidget(t);return e||(e=l.getWidget(t.cardView())),e},CUI.util.plugClass(CUI.CardView),CUI.options.dataAPI&&t(function(){for(var e=t("body").find('[data-toggle="cardview"]'),i=0;e.length>i;i++){var s=t(e[i]);s.data("cardview")||s.cardView()}})}(window.jQuery),function(t){CUI.PathBrowser=new Class({toString:"PathBrowser",extend:CUI.Widget,construct:function(){for(this.options.autocompleteCallback||(this.options.autocompleteCallback=this._defaultAutocompleteCallback.bind(this)),this.options.optionRenderer||(this.options.optionRenderer=CUI.PathBrowser.defaultOptionRenderer),this._render();this.options.optionDisplayStrings.length<this.options.options.length;)this.options.optionDisplayStrings.push(this.options.options[this.options.optionDisplayStrings.length]);this.dropdownList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.inputElement,cssClass:"autocomplete-results"}),this.$element.on("change:disabled",this._update.bind(this)),this.$element.on("change:placeholder",this._update.bind(this)),this.$element.on("change:options",this._changeOptions.bind(this)),this.$element.on("input","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=setTimeout(this._inputChanged.bind(this),this.options.delay))}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=null,this.selectedIndex>=0&&(""===this.inputElement.attr("value")?this.setSelectedIndex(-1):this._update()))}.bind(this)),this.$element.on("keydown","input",this._keyPressed.bind(this)),this.$element.on("keyup","input",this._keyUp.bind(this)),this.dropdownList.on("dropdown-list:select","",function(t){this.dropdownList.hide(200),this.setSelectedIndex(1*t.selectedValue)}.bind(this)),CUI.util.isTouch||(this.$element.on("focus","input",function(){this.options.disabled||this.$element.addClass("focus")}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||this.$element.removeClass("focus")}.bind(this)),this.$element.on("click touchend","input",function(){this.options.disabled||(this.inputElement.focus(),this._inputChanged())}.bind(this)))},defaults:{autocompleteCallback:null,options:[],optionDisplayStrings:[],optionLoader:null,optionLoaderRoot:null,optionValueReader:null,optionTitleReader:null,showTitles:!0,rootPath:"/content",delay:200,placeholder:null,optionRenderer:null},dropdownList:null,syncSelectElement:null,inputElement:null,typeTimeout:null,selectedIndex:-1,triggeredBackspace:!1,setSelectedIndex:function(t){-1>t||t>=this.options.options.length||(this.selectedIndex=t,this._update())},getSelectedIndex:function(){return this.selectedIndex},_changeOptions:function(t){t.widget===this&&(this.selectedIndex=-1,this._update())},_render:function(){this._readDataFromMarkup();var e;"SELECT"===this.$element.get(0).tagName&&(e=t("<div></div>"),this.$element.after(e),this.$element.detach(),e.append(this.$element),this.$element=e),"INPUT"===this.$element.get(0).tagName&&(e=t("<div></div>"),this.$element.after(e),this.$element.detach(),e.prepend(this.$element),this.$element=e),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.options.optionDisplayStrings=[],this.$element.find("select option").each(function(e,i){this.options.options.push(t(i).val()),this.options.optionDisplayStrings.push(t.trim(t(i).text())),t(i).attr("selected")&&(this.selectedIndex=e)}.bind(this))),this._createMissingElements(),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.$element.addClass("pathbrowser"),this.$element.removeClass("focus"),this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.name&&this.syncSelectElement.attr("name",this.options.name),this._update()},_createMissingElements:function(){0===this.$element.find("select").length&&this.$element.append(t("<select></select>")),0===this.$element.find("input").length&&this.$element.prepend(t("<input/>",{type:"text"}))},_readDataFromMarkup:function(){this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),(this.$element.attr("disabled")||this.$element.attr("data-disabled"))&&(this.options.disabled=!0),this.$element.attr("data-option-renderer")&&(this.options.optionRenderer=CUI.PathBrowser[this.$element.attr("data-option-renderer")+"OptionRenderer"]),this.$element.attr("data-root-path")&&(this.options.rootPath=this.$element.attr("data-root-path"));var t=CUI.util.buildFunction(this.$element.attr("data-option-loader"),["path","callback"]);t&&(this.options.optionLoader=t.bind(this)),this.$element.attr("data-option-loader-root")&&(this.options.optionLoaderRoot=this.$element.attr("data-option-loader-root"));var e=CUI.util.buildFunction(this.$element.attr("data-option-value-reader"),["object"]);e&&(this.options.optionValueReader=e.bind(this));var i=CUI.util.buildFunction(this.$element.attr("data-option-title-reader"),["object"]);i&&(this.options.optionTitleReader=i.bind(this))},_update:function(){if(this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled")),this.syncSelectElement&&this.syncSelectElement.find("option:selected").removeAttr("selected"),this.selectedIndex>=0){this.syncSelectElement&&t(this.syncSelectElement.find("option").get(this.selectedIndex)).attr("selected","selected");var e=this.options.options[this.selectedIndex];if(e&&0!==e.indexOf("/")){var i="",s=this.inputElement.attr("value").lastIndexOf("/");s>=0&&(i=this.inputElement.attr("value").substring(0,s+1)),e=i+e}this._setInputValue(e,!0)}else this._setInputValue("")},_setInputValue:function(t,e){t&&(this.inputElement.attr("value",t),e&&this.inputElement.is(":focus")&&CUI.util.selectText(this.inputElement,t.length))},_keyUp:function(t){var e=t.keyCode;8===e&&(this.triggeredBackspace=!1)},_keyPressed:function(t){var e=t.keyCode;this.dropdownList.isVisible()||40===e&&(this._inputChanged(),t.preventDefault())},_inputChanged:function(){var t=this,e=this.inputElement.attr("value");e.length>0?this.options.autocompleteCallback(e).done(function(e){t._showAutocompleter(e)}).fail(function(){console.log("Failed to read options")}):this.dropdownList.hide()},_showAutocompleter:function(t){if(this.dropdownList.hide(),0!==t.length){var e=function(t,e){return this.options.optionRenderer.bind(this)(t,e)};this.dropdownList.set("optionRenderer",e.bind(this)),this.dropdownList.set("options",t),this.dropdownList.show()}},_defaultAutocompleteCallback:function(e){var i=this,s=t.Deferred();if(/^\//.test(e)&&/\/$/.test(e)&&i.options.optionLoader){var n=!1;"/"===e?i.options.rootPath&&(e=i.options.rootPath.replace(/\/$/,""),""!==e?n=!0:e="/"):e=e.replace(/\/$/,""),n&&i._setInputValue(e+"/");var o={loadOptions:i.options.optionLoader},a=t.Deferred();a.promise(o),o.done(function(n){t.isFunction(n.promise)?n.done(function(t){i._rebuildOptions(s,e,t)}):i._rebuildOptions(s,e,n)});var l=o.loadOptions(e,function(t){a.resolve(t)});l&&a.resolve(l)}else s.resolve(i._filterOptions(e));return s.promise()},_rebuildOptions:function(e,i,s){var n=this,o=t.getNested(s,n.options.optionLoaderRoot);if(o){var a=[],l=[];t.each(o,function(t,e){var i;i=n.options.optionValueReader?n.options.optionValueReader(e):"object"==typeof e?e.path:e,a.push(i);var s="";n.options.optionTitleReader?s=n.options.optionTitleReader(e):"object"==typeof e&&(s=e.title),l.push(s)}.bind(n)),n.options.options=a,n.options.optionDisplayStrings=l;var r=n._filterOptions(i);e.resolve(r)}else e.reject()},_filterOptions:function(){var e=[];return t.each(this.options.options,function(t){e.push(t)}.bind(this)),e}}),CUI.util.plugClass(CUI.PathBrowser),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~='pathbrowser']",e.target).pathBrowser()})}(window.jQuery),CUI.PathBrowser.defaultOptionRenderer=function(t,e){var i=this.options.options[e];if(0===i.indexOf("/")){var s=i.lastIndexOf("/");i=i.substring(s+1)}var n="pathbrowser-autocomplete-item-value",o="";return this.options.showTitles&&this.options.optionDisplayStrings[e]&&this.options.optionDisplayStrings[e].length>0&&(n+=" pathbrowser-autocomplete-item-value-with-title",o+='<div class="pathbrowser-autocomplete-item-title">'+this.options.optionDisplayStrings[e]+"</div>"),$('<div class="'+n+'">'+i+"</div>"+o)},function(t){CUI.Wizard=new Class({toString:"Wizard",extend:CUI.Widget,construct:function(){this.$nav=this.$element.find("nav").first(),this.$back=this.$nav.find("button").first(),this.$next=this.$nav.find("button").last(),this.$pageOverview=this.$nav.find("ol").last(),this.$element.data("hide-steps")===!0&&this.$pageOverview.addClass("hidden"),void 0===this.$back.attr("type")&&this.$back[0].setAttribute("type","button"),void 0===this.$next.attr("type")&&this.$next[0].setAttribute("type","button"),this.$nav.addClass("toolbar"),this.$back.addClass("left"),this.$next.addClass("right"),this.$pageOverview.addClass("center"),this.$nav.find("li").first().append('<div class="lead-fill"></div>'),this.$next.click(this._onNextClick.bind(this)),this.$back.click(this._onBackClick.bind(this)),this._updateDefault(),setTimeout(function(){this.changePage(1)}.bind(this),1)},defaults:{nextDisabled:!1,backDisabled:!1,nextLabel:"next",backLabel:"back",onPageChanged:null,onFinish:null,onLeaving:null,onNextButtonClick:null,onBackButtonClick:null},changePage:function(t){if(!(1>t||t>this.$nav.find("li").length)){this.pageNumber=t;var e=this.pageNumber-1,i=this.getCurrentPage();this.$nav.find("li").removeClass("stepped"),this.$nav.find("li:lt("+e+")").addClass("stepped"),this.$nav.find("li.active").removeClass("active"),this.$nav.find("li:eq("+e+")").addClass("active"),this.$element.find(">section.active").removeClass("active"),this.$element.find(">section:eq("+e+")").addClass("active"),this._updateButtons(),this._fireCallback("onPageChanged"),"object"==typeof this.options.onPageChanged&&this._dataExists(i,"wizardPageCallback")&&"function"==typeof this.options.onPageChanged[i.data("wizardPageCallback")]&&this.options.onPageChanged[i.data("wizardPageCallback")](i)}},getCurrentPageNumber:function(){return this.pageNumber},getCurrentPage:function(){return this.getPage(this.pageNumber)},getPage:function(t){return this.$element.find(">section:eq("+(parseFloat(t)-1)+")")},getPageNav:function(t){return this.$element.find(">nav li:eq("+(parseFloat(t)-1)+")")},setNextButtonLabel:function(t){this.$next.text(t)},setBackButtonLabel:function(t){this.$back.text(t)},setNextButtonDisabled:function(t){this.$next.attr("disabled",t)},setBackButtonDisabled:function(t){this.$back.attr("disabled",t)},activatePage:function(t){this.getPage(t).removeClass("wizard-hidden-step"),this.getPageNav(t).removeClass("wizard-hidden-step")},deactivatePage:function(t){this.getPage(t).addClass("wizard-hidden-step"),this.getPageNav(t).addClass("wizard-hidden-step")},_onNextClick:function(){var t=this._fireCallback("onNextButtonClick");if(t!==!1){var e=this._getNextPageNumber();null!=e?this.changePage(e):this._fireCallback("onFinish")}},_onBackClick:function(){var t=this._fireCallback("onBackButtonClick");if(t!==!1){var e=this._getPreviousPageNumber();null!=e?this.changePage(e):this._fireCallback("onLeaving")}},_getNextPageNumber:function(){var t=this.getCurrentPageNumber();return this._getRelativeNextPageNumber(t)},_getRelativeNextPageNumber:function(e){if(this.$nav.find("li").length>e){var i=e+1,s=this.getPage(i);return t(s).hasClass("wizard-hidden-step")?this._getRelativeNextPageNumber(i):i}return null},_getPreviousPageNumber:function(){var t=this.getCurrentPageNumber();return this._getRelativePreviousPageNumber(t)},_getRelativePreviousPageNumber:function(e){if(e>1){var i=e-1,s=this.getPage(i);return t(s).hasClass("wizard-hidden-step")?this._getRelativePreviousPageNumber(i):i}return null},_updateButtons:function(){var t=this.getCurrentPage();this.setNextButtonLabel(this._dataExists(t,"nextLabel")?t.data("nextLabel"):this.options.nextLabel),this.setBackButtonLabel(this._dataExists(t,"backLabel")?t.data("backLabel"):this.options.backLabel),this.setNextButtonDisabled(this._dataExists(t,"nextDisabled")?t.data("nextDisabled"):this.options.nextDisabled),this.setBackButtonDisabled(this._dataExists(t,"backDisabled")?t.data("backDisabled"):this.options.backDisabled)},_fireCallback:function(t){return"function"==typeof this.options[t]?this.options[t]():void 0},_dataExists:function(t,e){return void 0!==t.data(e)},_updateDefault:function(){this.options.nextDisabled=this.$next.is("[disabled]"),this.options.backDisabled=this.$back.is("[disabled]"),this.options.nextLabel=this.$next.text(),this.options.backLabel=this.$back.text()}}),CUI.util.plugClass(CUI.Wizard),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=wizard]",e.target).wizard()})}(window.jQuery),function(t){function e(t){return t.filter("[data-action=prev], [data-action=cancel]").first().addClass("hidden").clone().addClass("back left").each(s)}function i(t){return t.filter("[data-action=next]").first().addClass("hidden").clone().addClass("primary right").each(s)}function s(e,i){t(i).removeClass("hidden").not("button").toggleClass("button",!0)}function n(s){s.prepend(function(){var n=s.children(".step"),o=t('<nav class="toolbar"><ol class="center"></ol></nav>'),a=o.children("ol");n.map(function(){return t("<li />").text(this.title)}).appendTo(a),a.children("li").first().addClass("active").append("<div class='lead-fill' />");var l=n.first().find(".flexwizard-control");return o.prepend(function(){return e(l)}).append(function(){return i(l)})})}function o(t){0!==t.length&&(t.addClass("active").removeClass("stepped"),t.prevAll("li").addClass("stepped").removeClass("active"),t.nextAll("li").removeClass("active stepped"))}function a(t,e,i){0!==e.length&&(i&&i.removeClass("active"),e.toggleClass("active",!0),t.trigger("flexwizard-stepchange",[e,i]))}function l(t,s){var n,l,r=t.children("nav"),d=t.children(".step.active"),h=r.children("ol").children("li.active");switch(s){case"prev":n=d.prev(".step"),l=h.prev("li");break;case"next":n=d.next(".step"),l=h.next("li");break;case"cancel":return}if(0!==n.length){var c=n.find(".flexwizard-control");e(c).replaceAll(r.children(".left")),i(c).replaceAll(r.children(".right")),o(l),a(t,n,d)}}CUI.FlexWizard=new Class({toString:"FlexWizard",extend:CUI.Widget,construct:function(){var e=this.$element;n(e),e.on("click",".flexwizard-control",function(){l(e,t(this).data("action"))}),a(e,e.children(".step").first())}}),CUI.util.plugClass(CUI.FlexWizard),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=flexwizard]",e.target).flexWizard()})}(window.jQuery),function(t){CUI.FileUpload=new Class({toString:"FileUpload",extend:CUI.Widget,construct:function(){this._render(),this.inputElement.on("change",function(t){this.options.disabled||this._onFileSelectionChange(t)}.bind(this))},defaults:{name:"file",placeholder:null,uploadUrl:null,uploadUrlBuilder:null,disabled:!1,multiple:!1,mimeTypes:null,sizeLimit:null,autoStart:!1,fileNameParameter:null,useHTML5:!0,dropZone:null,events:{}},inputElement:null,$spanElement:null,fileNameElement:null,uploadQueue:[],_render:function(){var e=this;if("INPUT"===this.$element.get(0).tagName){var i=this.$element.attr("class"),s=t("<span/>",{"class":i});this.$element.removeAttr("class"),this.$element.after(s),this.$element.detach(),s.prepend(this.$element),this.$element=s}if(this.$spanElement=this.$element.is("span")?this.$element:this.$element.find("span"),this.inputElement=this.$element.find("input[type='file']"),this._readDataFromMarkup(),CUI.util.HTTP.html5UploadSupported()||(this.options.useHTML5=!1),this._createMissingElements(),this.$element.addClass("fileupload"),this.$element.removeClass("focus"),this.inputElement.attr("title")&&this.$element.prepend(t("<label/>",{"for":e.options.name}).html(this.inputElement.attr("title"))),this.options.events&&"object"==typeof this.options.events)for(var n in this.options.events)this._registerEventHandler(n,this.options.events[n]);this.options.dropZone=this.options.useHTML5?this._registerDropZone():null,this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.autoStart&&this._registerEventHandler("fileselected",function(t){t.fileUpload.uploadFile(t.item)}),this.options.uploadUrlBuilder&&(this.options.uploadUrl=this.options.uploadUrlBuilder(this)),(!this.options.uploadUrl||/\$\{.+\}/.test(this.options.uploadUrl))&&(this.options.disabled=!0),this._update()},_registerDropZone:function(){var e=this;if(e.options.dropZone){try{e.options.dropZone=t(e.options.dropZone)}catch(i){delete e.options.dropZone}e.options.dropZone&&e.options.dropZone.on("dragover",function(t){return e._isActive()&&(e.isDragOver=!0,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.$element.trigger({type:"dropzonedragover",originalEvent:t,fileUpload:e})),!1}).on("dragleave",function(t){return e._isActive()&&(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.isDragOver=!1,window.setTimeout(function(){e.isDragOver||e.$element.trigger({type:"dropzonedragleave",originalEvent:t,fileUpload:e})},1)),!1}).on("drop",function(t){if(e._isActive()){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var i=t.originalEvent.dataTransfer.files;e.$element.trigger({type:"dropzonedrop",originalEvent:t,files:i,fileUpload:e}),e._onFileSelectionChange(t,i)}return!1})}},_registerEventHandler:function(t,e){this.$element.on(t,e)},_createMissingElements:function(){var e=this,i=e.options.useHTML5&&e.options.multiple;0===e.inputElement.length?(e.inputElement=t("<input/>",{type:"file",name:e.options.name,multiple:i}),e.$element.prepend(e.inputElement)):e.inputElement.attr("multiple",i)},_readDataFromMarkup:function(){var e=this;this.inputElement.attr("name")&&(this.options.name=this.inputElement.attr("name")),this.inputElement.attr("placeholder")&&(this.options.placeholder=this.inputElement.attr("placeholder")),this.inputElement.attr("data-placeholder")&&(this.options.placeholder=this.inputElement.attr("data-placeholder")),(this.inputElement.attr("disabled")||this.inputElement.attr("data-disabled"))&&(this.options.disabled=!0),(this.inputElement.attr("multiple")||this.inputElement.attr("data-multiple"))&&(this.options.multiple=!0),this.inputElement.attr("data-upload-url")&&(this.options.uploadUrl=this.inputElement.attr("data-upload-url")),this.inputElement.attr("data-upload-url-builder")&&(this.options.uploadUrlBuilder=CUI.util.buildFunction(this.inputElement.attr("data-upload-url-builder"),["fileUpload"])),this.inputElement.attr("data-size-limit")&&(this.options.sizeLimit=this.inputElement.attr("data-size-limit")),this.inputElement.attr("data-auto-start")&&(this.options.autoStart=!0),this.inputElement.attr("data-usehtml5")&&(this.options.useHTML5="true"===this.inputElement.attr("data-usehtml5")),this.inputElement.attr("data-dropzone")&&(this.options.dropZone=this.inputElement.attr("data-dropzone")),this.inputElement.attr("data-file-name-parameter")&&(this.options.fileNameParameter=this.inputElement.attr("data-file-name-parameter")),t.each(this.inputElement.get(0).attributes,function(t,i){var s=/^data-event-(.*)$/.exec(i.name);if(s&&s.length>1){var n=CUI.util.buildFunction(i.value,["event"]);n&&(e.options.events[s[1]]=n.bind(e))}})},_update:function(){this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled"))},_onFileSelectionChange:function(t,e){var i=0,s=0;if(this.options.useHTML5){e=e||t.target.files;for(var n=0;e.length>n;n++)this._addFile(e[n])?i++:s++}else this._addFile(t.target)?i++:s++;this.$element.trigger({type:"filelistprocessed",addedCount:i,rejectedCount:s,fileUpload:this})},_addFile:function(e){var i,s=this;if(i=this.options.useHTML5?e.name:t(e).attr("value"),-1!==i.lastIndexOf("\\")&&(i=i.substring(i.lastIndexOf("\\")+1)),!s._getQueueItemByFileName(i)){var n={fileName:i};return this.options.useHTML5&&(n.file=e,n.fileSize=e.size,s.options.sizeLimit&&e.size>s.options.sizeLimit)?(s.$element.trigger({type:"filerejected",item:n,message:"File is too big",fileUpload:s}),!1):(s.uploadQueue.push(n),s.$element.trigger({type:"queuechanged",item:n,operation:"ADD",queueLength:s.uploadQueue.length,fileUpload:s}),s.$element.trigger({type:"fileselected",item:n,fileUpload:s}),!0)}return!1},_getQueueIndex:function(e){var i=-1;return t.each(this.uploadQueue,function(t,s){return s.fileName===e?(i=t,!1):void 0}),i},_getQueueItem:function(t){return t>-1?this.uploadQueue[t]:null},_getQueueItemByFileName:function(t){return this._getQueueItem(this._getQueueIndex(t))},uploadFile:function(e){var i=this;if(i.options.useHTML5){e.xhr=new XMLHttpRequest,e.xhr.addEventListener("loadstart",function(t){i._onUploadStart(t,e)},!1),e.xhr.addEventListener("load",function(t){i._onUploadLoad(t,e)},!1),e.xhr.addEventListener("error",function(t){i._onUploadError(t,e)},!1),e.xhr.addEventListener("abort",function(t){i._onUploadCanceled(t,e)},!1);var s=e.xhr.upload;s.addEventListener("progress",function(t){i._onUploadProgress(t,e)},!1);var n=e.file,o=e.fileName;if(window.FormData){var a=new FormData;i.options.fileNameParameter?(a.append(i.inputElement.attr("name"),n),a.append(i.options.fileNameParameter||"fileName",o)):a.append(o,n),a.append("_charset_","utf-8"),e.xhr.open("POST",i.options.uploadUrl+"?:ck="+(new Date).getTime(),!0),e.xhr.send(a)}else e.xhr.open("PUT",i.options.uploadUrl+"/"+o,!0),e.xhr.send(n)}else{var l=t(document.body),r="upload-"+(new Date).getTime(),d=t("<iframe/>",{name:r});d.addClass("fileupload").appendTo(l);var h=t("<form/>",{method:"post",enctype:"multipart/form-data",action:i.options.uploadUrl,target:r});h.addClass("fileupload").appendTo(l);var c=t("<input/>",{type:"hidden",name:"_charset_",value:"utf-8"});h.prepend(c),this.options.fileNameParameter&&(this.fileNameElement=t("<input/>",{type:"hidden",name:this.options.fileNameParameter,value:e.fileName}),h.prepend(this.fileNameElement)),d.one("load",function(){var t=this.contentWindow.document.body.innerHTML;i.inputElement.prependTo(i.$spanElement),h.remove(),d.remove(),i.$element.trigger({type:"fileuploadload",item:e,content:t,fileUpload:i})}),i.inputElement.prependTo(h),h.submit()}},cancelUpload:function(t){t.xhr.abort()},_onUploadStart:function(t,e){this.$element.trigger({type:"fileuploadstart",item:e,originalEvent:t,fileUpload:this})},_onUploadProgress:function(t,e){this.$element.trigger({type:"fileuploadprogress",item:e,originalEvent:t,fileUpload:this})},_onUploadLoad:function(t,e){var i=t.target;4===i.readyState&&this._internalOnUploadLoad(t,e,i.status,i.responseText)},_internalOnUploadLoad:function(t,e,i,s){CUI.util.HTTP.isOkStatus(i)?this.$element.trigger({type:"fileuploadsuccess",item:e,originalEvent:t,fileUpload:this}):this.$element.trigger({type:"fileuploaderror",item:e,originalEvent:t,message:s,fileUpload:this}),this.fileNameElement&&this.fileNameElement.remove(),this.uploadQueue.splice(this._getQueueIndex(e.fileName),1),this.$element.trigger({type:"queuechanged",item:e,operation:"REMOVE",queueLength:this.uploadQueue.length,fileUpload:this})},_onUploadError:function(t,e){this.$element.trigger({type:"fileuploaderror",item:e,originalEvent:t,fileUpload:this})},_onUploadCanceled:function(t,e){this.$element.trigger({type:"fileuploadcanceled",item:e,originalEvent:t,fileUpload:this})},_isActive:function(){return!this.inputElement.is(":disabled")}}),CUI.util.plugClass(CUI.FileUpload),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~='fileupload']",e.target).fileUpload()})}(window.jQuery),function(t){CUI.Toolbar=new Class({toString:"Toolbar",extend:CUI.Widget,construct:function(){var t=this.$element,e=t.closest(".content-header"),i=t.find(".left"),s=0!==t.find(".center").length,n=i.width();t.reflow({"break-lines":function(t,e){return s&&t.width()-2*n<16*e.rem()},"long-title":function(t,e){return s&&t.width()-2*n>40*e.rem()}},{applyClassToElement:e})}}),CUI.util.plugClass(CUI.Toolbar),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=toolbar]",e.target).toolbar()})}(window.jQuery),function(t){CUI.Tooltip=new Class({toString:"Tooltip",extend:CUI.Widget,construct:function(){if(this.options.target&&(this.options.target=t(this.options.target)),0===this.$element.length&&this.options.target&&(this.$element=t("<div>"),this.$element.insertAfter(this.options.target)),this.$element.addClass("tooltip"),this.$element.data("interactive")&&(this.options.interactive=!0,this.options.target||(this.options.target=this.$element.parent())),this.$element.data("target")&&(this.options.target=t(this.$element.data("target"))),this.options.arrow||(this.options.arrow="left",this.$element.hasClass("arrow-left")&&(this.options.arrow="left"),this.$element.hasClass("arrow-right")&&(this.options.arrow="right"),this.$element.hasClass("arrow-top")&&(this.options.arrow="top"),this.$element.hasClass("arrow-bottom")&&(this.options.arrow="bottom")),this.options.interactive&&(this.options.visible=!1),this.$element.toggleClass("hidden",!this.options.visible),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:arrow",this._setArrow.bind(this)),this.applyOptions(),this.reposition(),this.options.target&&this.options.target.data("tooltip",this),this.options.interactive&&this.options.target){var e=null;t(this.options.target).finger("touchstart.cui-tooltip",function(){e&&clearTimeout(e),this.show(),e=setTimeout(function(){this.hide()}.bind(this),3e3)}.bind(this));var i=!1;t(this.options.target).pointer("mouseover.cui-tooltip",function(){i&&clearTimeout(i),i=setTimeout(function(){this.show()}.bind(this),this.options.delay)}.bind(this)),t(this.options.target).pointer("mouseout.cui-tooltip",function(){i&&clearTimeout(i),this.hide()}.bind(this))}},defaults:{target:null,visible:!0,type:"default",interactive:!1,arrow:null,delay:500,distance:5},_types:["info","error","notice","success"],_arrows:["arrow-left","arrow-right","arrow-top","arrow-bottom"],applyOptions:function(){this._setContent(),this._setType(),this._setArrow()},_setType:function(){"string"==typeof this.options.type&&-1!==this._types.indexOf(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type),this.reposition())},_setArrow:function(){"string"==typeof this.options.arrow&&-1!==this._arrows.indexOf("arrow-"+this.options.arrow)&&(this.$element.removeClass(this._arrows.join(" ")),this.$element.addClass("arrow-"+this.options.arrow),this.reposition())},_setContent:function(){"string"==typeof this.options.content&&(this.$element.html(this.options.content),this.reposition())},_show:function(){this.$element.hasClass("hidden")&&(this.$element.removeClass("hidden"),this.$element.css("display","none")),this.$element.fadeIn()},_hide:function(){return this.$element.fadeOut(400,function(){this.options.autoDestroy&&(this.$element.remove(),t(this.options.target).off(".cui-tooltip"),t(this.options.target).data("tooltip",null))}.bind(this)),this},reposition:function(e){if(this.options.target){e||setTimeout(function(){this.reposition(!0)}.bind(this),50),this.$element.detach().insertAfter(this.options.target),this.$element.css("position","absolute");var i=t(this.options.target),s=i.outerWidth(!0),n=i.outerHeight(!0),o=i.position().left,a=i.position().top,l=this.$element.outerWidth(!0),r=this.$element.outerHeight(!0),d=0,h=0;return"left"===this.options.arrow&&(d=o+s+this.options.distance,h=a+(n-r)/2),"right"===this.options.arrow&&(d=o-l-this.options.distance,h=a+(n-r)/2),"bottom"===this.options.arrow&&(d=o+(s-l)/2,h=a-r-this.options.distance),"top"===this.options.arrow&&(d=o+(s-l)/2,h=a+n+this.options.distance),this.$element.css("left",d),this.$element.css("top",h),this}}}),CUI.util.plugClass(CUI.Tooltip),CUI.options.dataAPI&&(t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=tooltip]",e.target).tooltip()}),t(document).fipo("touchstart","mouseover","[data-init~=quicktip]",function(e){var i=t(e.target),s=i.data("tooltip");s||(new CUI.Tooltip({target:i,content:i.data("quicktip-content")||i.html(),type:i.data("quicktip-type"),arrow:i.data("quicktip-arrow"),interactive:!0,autoDestroy:!0}),i.trigger(e))}.bind(this)))}(window.jQuery),function(t){function e(t){return{l:t.offset().left,t:t.offset().top,w:t.outerWidth(),h:t.outerHeight()}}function i(t,i,s){var n=e(s);return t>=n.l&&i>=n.t&&n.l+n.w>t&&n.t+n.h>i}function s(t){var e={};if(t.originalEvent){var i=t.originalEvent;i.changedTouches&&i.changedTouches.length>0&&(e=t.originalEvent.changedTouches[0]),i.touches&&i.touches.length>0&&(e=t.originalEvent.touches[0])}var s=e.pageX||t.pageX,n=e.pageY||t.pageY;return{x:s,y:n}}var n="cui-draggable-list",o="dropzone";DragAction=new Class({construct:function(t,e,i,s,n){this.sourceElement=e,this.dragElement=i,this.container=this._getViewContainer(i),this.containerHeight=this.container.get(0).scrollHeight,this.dropZones=s,this.axis=n,this.scrollZone=20,this.dragStart(t)},currentDragOver:null,_getViewContainer:function(t){for(;;){var e=t.parent();if(0==e.length)return e;if(e.is("body"))return e;var i=e.css("overflow");if("hidden"==i||"auto"==i||"scroll"==i)return e;t=e}},dragStart:function(e){e.preventDefault();var i=this.dragElement.position();this.dragElement.css({left:i.left,top:i.top,width:this.dragElement.width()+"px"}),this.dragElement.addClass("dragging");var o=s(e),a=o.x,l=o.y;this.dragStart={x:a-i.left,y:l-i.top},t(document).fipo("touchmove."+n,"mousemove."+n,this.drag.bind(this)),t(document).fipo("touchend."+n,"mouseup."+n,this.dragEnd.bind(this)),this.sourceElement.trigger(this._createEvent("dragstart",e)),this.drag(e)
},drag:function(t){t.preventDefault();var e=s(t),i=e.x,n=e.y;if(this.container.is("body"))n-this.container.scrollTop()<this.scrollZone&&this.container.scrollTop(n-this.scrollZone),n-this.container.scrollTop()>this.container.height()-this.scrollZone&&this.container.scrollTop(n-(this.container.height()-this.scrollZone));else{var o=this.container.scrollTop(),a=this.container.offset().top+this.scrollZone;a>n&&this.container.scrollTop(this.container.scrollTop()-(a-n));var l=this.container.offset().top+this.container.height()-this.scrollZone;if(n>l){var r=this.container.scrollTop()+(n-l);r>this.containerHeight-this.container.height()&&(r=Math.max(this.containerHeight-this.container.height(),0)),this.container.scrollTop(r)}var d=this.container.scrollTop();this.dragStart.y+=o-d}var h={};"horizontal"!=this.axis&&(h.top=n-this.dragStart.y),"vertical"!=this.axis&&(h.left=i-this.dragStart.x),this.dragElement.css(h),this.triggerDrag(t)},dragEnd:function(e){e.preventDefault(),this.dragElement.removeClass("dragging"),this.dragElement.css({top:"",left:"",width:""}),t(document).off("."+n),this.triggerDrop(e),null!=this.currentDragOver&&t(this.currentDragOver).trigger(this._createEvent("dragleave",e)),this.sourceElement.trigger(this._createEvent("dragend",e))},triggerDrag:function(e){var i=this._getCurrentDropZone(e);i!=this.currentDragOver?(null!=this.currentDragOver&&t(this.currentDragOver).trigger(this._createEvent("dragleave",e)),this.currentDragOver=i,null!=this.currentDragOver&&t(this.currentDragOver).trigger(this._createEvent("dragenter",e))):null!=this.currentDragOver&&t(this.currentDragOver).trigger(this._createEvent("dragover",e))},triggerDrop:function(t){var e=this._getCurrentDropZone(t);if(null!=e){var i=this._createEvent("drop",t);e.trigger(i)}},_getCurrentDropZone:function(t){var e=s(t),n=null;return jQuery.each(this.dropZones,function(t,s){i(e.x,e.y,s)&&(n=s)}.bind(this)),n},_createEvent:function(t,e){var i=s(e),n=jQuery.Event(t);return n.pageX=i.x,n.pageY=i.y,n.sourceElement=this.sourceElement,n.item=this.dragElement,n}});var a=[];CUI.DraggableList=new Class({toString:"DraggableList",extend:CUI.Widget,construct:function(){if(this.$element.addClass("draggable"),this.$element.data("allow")){var t=this.$element.data("allow").split(" ");jQuery.inArray("reorder",t)>=0&&(this.options.allowReorder=!0),jQuery.inArray("drag",t)>=0&&(this.options.allowDrag=!0),jQuery.inArray("drop",t)>=0&&(this.options.allowDrop=!0)}this.$element.data("closable")&&(this.options.closable=!0),this.$element.on("click",".close",this.close.bind(this)),this.$element.fipo("taphold","mousedown","li",this.dragStart.bind(this)),this.dropZone=this.$element.parent().is("."+o)?this.$element.parent():this.$element,this.$element.on("dragend",this.dragEnd.bind(this)),(this.options.allowDrop||this.options.allowReorder)&&(this.dropZone.on("dragenter",this.dragEnter.bind(this)),this.dropZone.on("dragover",this.dragOver.bind(this)),this.dropZone.on("dragleave",this.dragLeave.bind(this)),this.dropZone.on("drop",this.drop.bind(this))),this.options.allowDrop&&a.push(this.dropZone),this.$element.on("dragstart",function(t){t.preventDefault()})},defaults:{allowReorder:!1,allowDrag:!1,allowDrop:!1,closable:!1},dropZone:null,dragStart:function(e){if(!t(e.target).hasClass("close")){e.preventDefault();var i=t(e.target).closest("li");i.prevAll().addClass("drag-before"),i.nextAll().addClass("drag-after"),this.$element.css({height:this.$element.height()+t(e.item).height()+"px"}),this.options.allowDrag?new DragAction(e,this.$element,i,a):new DragAction(e,this.$element,i,[this.dropZone],"vertical")}},dragEnd:function(){this.$element.css({height:""})},dragEnter:function(t){this.dropZone.addClass("drag-over"),this.options.allowReorder&&this.reorderPreview(t)},dragOver:function(t){this.options.allowReorder&&this.reorderPreview(t)},dragLeave:function(){this.dropZone.removeClass("drag-over"),this.$element.children().removeClass("drag-before drag-after")},drop:function(e){if(this.$element.css({height:""}),this.$element.is(e.sourceElement)&&this.options.allowReorder&&this.reorder(e,!1),!this.$element.is(e.sourceElement)&&this.options.allowDrop){var i=t(e.item);this.options.closable&&0==i.find(".close").length?i.append('<button class="close">&times;</button>'):this.options.closable||i.find(".close").remove(),this.options.allowReorder?this.reorder(e,i):this.$element.append(i)}this.$element.children().removeClass("drag-before drag-after")},reorderPreview:function(i){var n=s(i),o=n.x,a=n.y,l=e(this.$element);l.l>o||l.t>a||o>l.l+l.w||a>l.t+l.h?this.$element.children().removeClass("drag-after drag-before"):this.$element.children().each(function(){if(!t(this).is(".dragging")){var i=e(t(this)),s=i.t+i.h/2>a;t(this).toggleClass("drag-after",s),t(this).toggleClass("drag-before",!s)}})},reorder:function(e,i){var s=i?i:t(e.item),n=this.$element.children(".drag-after:first"),o=this.$element.children(".drag-before:last"),a=s.index();n.length>0&&s.insertBefore(n),o.length>0&&s.insertAfter(o),0==n.length&&0==o.length&&i&&this.$element.append(s);var l=s.index();if(a!=l||i){var r=jQuery.Event(i?"inserted":"reordered");return r.sourceElement=e.sourceElement,r.oldIndex=a,r.newIndex=l,r.item=s.get(0),this.$element.trigger(r),!0}return!1},close:function(e){if(this.options.closable){e.preventDefault();var i=t(e.target).closest("li"),s=i.index();i.remove();var e=jQuery.Event("removed");e.sourceElement=this.$element.get(0),e.index=s,e.item=i.get(0),this.$element.trigger(e)}}}),CUI.util.plugClass(CUI.DraggableList),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(){t("[data-init~=draggable-list]").draggableList()})}(window.jQuery),function(t){CUI.CharacterCount=new Class({toString:"CharacterCount",extend:CUI.Widget,construct:function(){this.$element.attr("maxlength")&&(this.options.maxlength=this.$element.attr("maxlength")),this.$element.removeAttr("maxlength"),this.countElement=t("<span>").addClass("character-count"),this.$element.is("input")||(this.container=t("<div>").addClass("character-count-container"),this.$element.wrapAll(this.container)),this.$element.after(this.countElement),this.$element.on("input",this._render.bind(this)),this.$element.on("change:maxlength",this._render.bind(this)),this._render()},defaults:{maxlength:null},isTooLong:function(){var t=this.$element.is("input,textarea"),e=t?this.$element.val().length:this.$element.text().length,i=this.options.maxlength?e>this.options.maxlength:!1;return i},_render:function(){var t=this.$element.is("input,textarea"),e=t?this.$element.val().length:this.$element.text().length,i=this.isTooLong();this.$element.toggleClass("error",i),this.countElement.toggleClass("negative",i),this.countElement.text(this.options.maxlength?this.options.maxlength-e:e)}}),CUI.util.plugClass(CUI.CharacterCount),t(document).on("cui-contentloaded.data-api",function(e){t("[data-init~=character-count]",e.target).characterCount()})}(window.jQuery),function(t){CUI.Accordion=new Class({toString:"Accordion",extend:CUI.Widget,construct:function(){if(this.isAccordion=!(this.$element.hasClass("collapsible")||"collapsible"==this.$element.data("init")),this.isAccordion&&this.$element.addClass("accordion"),this.isAccordion){var t=this.$element.children(".active").index();this.options.active!==!1&&(t=this.options.active),this.$element.children().each(function(e,i){this._initElement(i,e!=t)}.bind(this))}else this._initElement(this.$element,!(this.options.active||this.$element.hasClass("active")));this.$element.on("click","h3",this._toggle.bind(this)),this.$element.on("change:active",this._changeActive.bind(this)),this.$element.on("selectstart","h3",function(t){t.preventDefault()})},defaults:{active:!1},isAccordion:!1,_toggle:function(e){var i=t(e.target).closest(".collapsible"),s=i.hasClass("active"),n=s?!1:this.isAccordion?i.index():!0;this.setActive(n)},_changeActive:function(){if(this.isAccordion){if(this._collapse(this.$element.children(".active")),this.options.active!==!1){var t=this.$element.children().eq(this.options.active);this._expand(t)}}else this.options.active?this._expand(this.$element):this._collapse(this.$element)},setActive:function(t){this.options.active=t,this._changeActive()},_initElement:function(e,i){0==t(e).find("h3").length&&t(e).prepend("<h3>&nbsp;</h3>"),0==t(e).find("h3 i").length&&t(e).find("h3").prepend("<i></i>&nbsp;"),t(e).addClass("collapsible"),i?(t(e).removeClass("active"),t(e).height(t(e).find("h3").height()),t(e).find("h3 i").removeClass("icon-accordiondown").addClass("icon-accordionup")):(t(e).addClass("active"),t(e).css("height","auto"),t(e).find("h3 i").removeClass("icon-accordionup").addClass("icon-accordiondown"))},_collapse:function(t){t.removeClass("active"),t.find("h3 i").removeClass("icon-accordiondown").addClass("icon-accordionup"),t.animate({height:t.find("h3").height()},"fast")},_expand:function(t){t.addClass("active"),t.find("h3 i").removeClass("icon-accordionup").addClass("icon-accordiondown");var e=this._calcHeight(t);t.animate({height:e},"fast",function(){t.css("height","auto")})},_calcHeight:function(e){var i=t(e).clone();i.css({display:"block",position:"absolute",top:"-10000px",width:e.width(),height:"auto"}),t("body").append(i);var s=i.height();return i.remove(),s}}),CUI.util.plugClass(CUI.Accordion),t(document).on("cui-contentloaded.data-api",function(){t("[data-init~=accordion],[data-init~=collapsible]").accordion()})}(window.jQuery),function(t){CUI.Tour=new Class({toString:"Tour",extend:CUI.Widget,construct:function(){this.$slides=this.$element.find(".tour-slide"),this.$navigation=this.$element.find("nav"),this.$skip=this.$navigation.find("button.skip"),this.$done=this.$navigation.find("button.done"),this.$prev=this.$navigation.find("a.prev"),this.$next=this.$navigation.find("a.next"),this.$control=this.$navigation.find(".control"),this.$current=this.$element.find(".tour-slide.active"),this.$current=this.$current.length>0?this.$current:this.$element.find(".tour-slide:eq(0)").addClass("active"),this._setCircleNav(this.$current),this._toggleButtons(this.$current),this._bindControls(),this.$element.hasClass("show")&&(this.options.autoshow=!0),this.options.autoshow&&this.show()},defaults:{autoshow:!1,backdrop:"static"},_toggleButtons:function(t){this.$skip.removeClass("show"),this.$done.removeClass("show"),this.$prev.removeClass("hide"),this.$next.removeClass("hide"),t.hasClass("first")?(this.$skip.addClass("show"),this.$prev.addClass("hide")):(t.hasClass("last")||t.hasClass("skipper"))&&(this.$done.addClass("show"),this.$next.addClass("hide"))},_setCircleNav:function(t){var e=t.index();t.hasClass("skipper")?this.$control.removeClass("show").addClass("hide"):this.$control.removeClass("hide").addClass("show").find("a").removeClass("active").filter(":eq("+e+")").addClass("active")},_slideTo:function(e){var i=t(e);i.length>0&&(this.$current.find(".fadable").addClass("faded"),this.$current.removeClass("active"),this.$current=i.addClass("active"),this._setCircleNav(i),this._toggleButtons(i),this._stopLastAnimation(),this._startNewAnimation())},slideToNext:function(){var t=this.$current.next(".tour-slide");return this.$current.hasClass("last")||this._slideTo(t),this},slideToPrev:function(){var t=this.$current.hasClass("skipper")?this.$element.find(".first"):this.$current.prev(".tour-slide");return this._slideTo(t),this},slideToSkipper:function(){var t=this.$element.find(".skipper");return this._slideTo(t),this},slideToFirst:function(){var t=this.$element.find(".first");return this._slideTo(t),this},slideTo:function(t){return this._slideTo(this.$slides[t]),this},_bindControls:function(){this.$navigation.on("click","a",function(t){t.preventDefault()}),this.$skip.fipo("tap","click",this.slideToSkipper.bind(this)),this.$done.fipo("tap","click",this.hide.bind(this)),this.$prev.fipo("tap","click",this.slideToPrev.bind(this)),this.$next.fipo("tap","click",this.slideToNext.bind(this)),this.$control.fipo("tap","click","a",function(e){this.slideTo(t(e.currentTarget).index())}.bind(this)),this.$element.finger("swipe",".tour-slide",function(t){1===t.finger&&("left"===t.direction?this.slideToNext():"right"===t.direction&&this.slideToPrev())}.bind(this))},_startNewAnimation:function(){var t=this.$current.find(".fadable");t&&(this._animationTimer=setInterval(function(){t.toggleClass("faded")},5e3))},_stopLastAnimation:function(){clearInterval(this._animationTimer)},_show:function(){this.$element.addClass("show"),this.slideToFirst(),this._toggleBackdrop(!0),this._startNewAnimation()},_hide:function(){this.$element.removeClass("show"),this._toggleBackdrop(),this._stopLastAnimation()},_removeBackdrop:function(){this.$backdrop&&!this.get("visible")&&(this.$backdrop.remove(),this.$backdrop=null)},_toggleBackdrop:function(e){e&&this.options.backdrop?this.$backdrop?this.$backdrop.fadeIn():(this.$backdrop=t("<div/>",{"class":"tour-backdrop",css:{display:"none"}}).appendTo(document.body),setTimeout(function(){this.$backdrop.fadeIn()}.bind(this),50),"static"!==this.options.backdrop&&this.$backdrop.click(this.hide)):!e&&this.$backdrop&&this.$backdrop.fadeOut(function(){this._removeBackdrop()}.bind(this))}}),CUI.util.plugClass(CUI.Tour),CUI.options.dataAPI&&t(document).on("cui-contentloaded.data-api",function(e){t("[data-init=tour]",e.target).tour()})}(window.jQuery),function(t,e){"use strict";function i(e,i){var s=e.next(".form-error");e.attr("aria-invalid","true").toggleClass("error",!0),0===s.length?e.after(t("<span class='form-error' data-init='quicktip' data-quicktip-arrow='top' data-quicktip-type='error' />").html(i)):s.html(i)}function s(t){t.removeAttr("aria-invalid").removeClass("error"),t.next(".form-error").remove()}return t.message&&t.validator?(t.message.register({selector:"*",message:{"validation.required":"Please fill out this field."}}),t.message.register({selector:":lang(de)",message:{}}),t.validator.register({selector:"form *",show:i,clear:s}),t.validator.register({selector:"form input, form textarea",validate:function(t){var e=t.prop("required")===!0||void 0===t.prop("required")&&void 0!==t.attr("required")||"true"===t.attr("aria-required");return e&&0===t.val().length?t.message("validation.required")||"required":void 0}}),t(document).on("input","form input, form textarea",function(){var e=t(this);e.checkValidity(),e.updateErrorUI()}),t.validator.register({selector:"[role=listbox]",validate:function(e){if("true"===e.attr("aria-required")){var i=!1;return e.find("[role=option]").each(function(){return"true"===t(this).attr("aria-selected")?(i=!0,!1):void 0}),i?void 0:e.message("validation.required")||"required"}}}),void 0):(e&&e.warn("$.message and/or $.validator are not available, thus nothing is registered."),void 0)}(jQuery,window.console);