(function(){CUI.rte.Theme=function(){return{DEFAULT_HEIGHT:210,DEFAULT_REQCSS_PATH:"/libs/cq/ui/rte/themes/default/internal",ANCHOR_CLASS:"cui-rte-anchor",TABLE_NOBORDER_CLASS:"cui-rte-forcedborder",TABLESELECTION_CLASS:"cui-rte-tableselection",TOOLBAR_ACTIVE:"active",TOOLBARITEM_DISABLED_CLASS:"disabled",TOOLBARITEM_SELECTED_CLASS:"selected",TOOLBARITEM_ICON_PREFIX:"icon-",BLANK_IMAGE:"../images/components/rte/blank.png"}}()})(window.jQuery),function(t){CUI.rte.UIUtils=function(){return{addStyleSheet:function(t,e){e=e||document,CUI.rte.Utils.isArray(t)||(t=[t]);var i=e.getElementsByTagName("head")[0],n=e.createElement("style");n.type="text/css",i.appendChild(n);for(var s="",o=t.length,a=0;o>a;a++){var r=t[a];s+=r[".name"]+" {\n";for(var l in r)r.hasOwnProperty(l)&&".name"!==l&&(s+="    "+l+": "+r[l]+";\n");s+="}\n\n"}return n.innerHTML=s,n},removeStyleSheet:function(t){t.parentNode.removeChild(t)},getUIContainer:function(e){var i=e.data("rte-ui");if(i)return i;for(var n=e[0].previousSibling;n&&1!==n.nodeType;)n=n.previousSibling;return n&&CUI.rte.Common.hasCSS(n,"rte-ui")?t(n):null},createOrGetUIContainer:function(e){var i=CUI.rte.UIUtils.getUIContainer(e);return i||(i=t("<div class='rte-ui'></div>"),e.before(i)),i},getToolbar:function(t,e){e=e||"inline";var i=t.hasClass("rte-ui")?t:CUI.rte.UIUtils.getUIContainer(t);if(!i||!i.length)return null;var n=i.find('div[data-type="'+e+'"] > div.rte-toolbar');return n&&n.length?n:null},getPopover:function(t,e,i){return e=e||"inline",i.find('div[data-type="'+e+'"] > '+'div[data-id="'+t+'"]')},getPopoverTrigger:function(t,e,i){e=e||"inline";var n=i.hasClass("rte-toolbar")?i:CUI.rte.UIUtils.getToolbar(i,e);return n.find('button[data-action="'+t+'"]')},getElement:function(t,e,i){return e=e||"inline",i.find('div[data-type="'+e+'"] '+'button[data-action="'+t+'"]')},getDialog:function(t,e,i){e=e||"inline";var n=i.find('div[data-type="'+e+'"] > '+'div[data-rte-dialog="'+t+'"]');return 0===n.length&&"global"!==e&&(n=i.find('div[data-type="global"] > div[data-rte-dialog="'+t+'"]')),n},getSpace:function(e,i){var n=i.find('> div[data-type="'+e+'"]');return n.length||(n=t(CUI.rte.Templates["ui-space"]({mode:e})),i.append(n)),n},determineIconClass:function(t){for(var e=CUI.rte.Common,i=e.parseCSS(t.jquery?t[0]:t),n=0;i.length>n;n++)if(e.strStartsWith(i[n],CUI.rte.Theme.TOOLBARITEM_ICON_PREFIX))return i[n];return void 0},killEvent:function(t){t.stopPropagation(),t.preventDefault()},getClippingParent:function(e){for(var i=void 0,n=t(document.body);e[0]!==n[0];){var s=e.css("overflow"),o=e.css("overflowX"),a=e.css("overflowY");if("visible"!==o||"visible"!==a||"visible"!==s){i=e;break}e=e.parent()}return i},getEditorOffsets:function(e){for(var i=0,n=0,s=e.doc;s!==document;){var o=CUI.rte.Common.getWindowForDocument(s);if(!o.frameElement)break;var a=t(o.frameElement).offset();i+=a.top,n+=a.left,s=o.frameElement.ownerDocument}return{top:i,left:n}},isUnder:function(t,e){if(!t||0===t.length)return!1;if(!e||0===e.length)return!1;for(var i=t[0],n=e[0];"BODY"!==n.tagName;){if(n===i)return!0;n=n.parentNode}return!1}}}()}(window.jQuery),function(t){CUI.rte.ConfigUtils=function(){function e(t){if(t){var e=t.indexOf("#");if(e>0){var i=t.substring(0,e),n=t.substring(e+1);return{plugin:i,feature:n}}}return null}return{createFeaturesFromToolbar:function(i,n){var s=[],o=n.find("button.item");o.each(function(){var i=e(t(this).data("action"));i&&s.push(i)});var a=i.find("div.rte-popover button.item");return a.each(function(){var i=e(t(this).data("action"));i&&s.push(i)}),s},mergeConfigAndFeatures:function(t,e){if(!e||0===e.length)return t;var i;t.hasOwnProperty("rtePlugins")?i=t.rtePlugins:(i={},t.rtePlugins=i);for(var n=e.length,s=0;n>s;s++){var o,a,r=e[s],l=r.plugin,d=r.feature;i.hasOwnProperty(l)?o=i[l]:(o={},i[l]=o),o.hasOwnProperty("features")?(a=o.features,CUI.rte.Utils.isArray(a)?a.push(d):"*"!==a&&(a=[d],o.features=a)):(a=[d],o.features=a)}return t},loadConfigAndStartEditing:function(e,i){function n(t){t=CUI.rte.ConfigUtils.mergeConfigAndFeatures(t,s),e.start(t)}var s,o=CUI.rte.UIUtils.getUIContainer(i),a=CUI.rte.UIUtils.getToolbar(i);a&&a.length>0&&(s=CUI.rte.ConfigUtils.createFeaturesFromToolbar(o,a));var r={},l=i.data("config");if(l){try{r=t.parseJSON(l)}catch(d){}n(r)}else{var h=i.data("config-path");h?t.ajax({url:h,success:function(t){n(t)},error:function(){n({})}}):n(r)}}}}()}(window.jQuery),CUI.rte.plugins.ControlPlugin=new Class({toString:"ControlPlugin",extend:CUI.rte.plugins.Plugin,getFeatures:function(){return["close"]},initializeUI:function(t){var e=CUI.rte.plugins;CUI.rte.ui,this.isFeatureEnabled("close")&&(this.closeUI=t.createElement("close",this,!1,this.getTooltip("close")),t.addElement("control",e.Plugin.SORT_MAX-1,this.closeUI,10))},notifyPluginConfig:function(t){t=t||{},CUI.rte.Utils.applyDefaults(t,{features:"*",tooltips:{close:{title:CUI.rte.Utils.i18n("Close"),text:CUI.rte.Utils.i18n("Finish editing the text.")}}}),this.config=t},execute:function(t){"close"==t&&this.editorKernel.fireUIEvent("requestClose")},updateState:function(){}}),CUI.rte.plugins.PluginRegistry.register("control",CUI.rte.plugins.ControlPlugin),function(){CUI.rte.ui.cui.ToolkitImpl=new Class({toString:"ToolkitImpl",extend:CUI.rte.ui.Toolkit,dropDownCls:null,menuCls:null,initialize:function(){},requiresInit:function(){return!1},createToolbarBuilder:function(){return new CUI.rte.ui.cui.CuiToolbarBuilder},createContextMenuBuilder:function(t){return new CUI.rte.ui.cui.CuiContextMenuBuilder(t)},createDialogManager:function(t){return new CUI.rte.ui.cui.CuiDialogManager(t)}}),CUI.rte.ui.ToolkitRegistry.register("cui",CUI.rte.ui.cui.ToolkitImpl)}(window.jQuery),function(t){CUI.rte.ui.cui.ToolbarImpl=new Class({toString:"ToolbarImpl",editorKernel:null,extend:CUI.rte.ui.Toolbar,elementMap:null,$container:null,$editable:null,$toolbar:null,$clipParent:null,popover:null,preferredToolbarPos:null,_popoverStyleSheet:null,_tbHideTimeout:null,_recordedScrollTop:null,_offsets:null,_isClipped:!1,NO_OFFSETS:{top:0,left:0},construct:function(t,e,i){this.elementMap=t,this.$editable=e,this.tbType=i||"inline",this.$container=CUI.rte.UIUtils.getUIContainer(this.$editable),this.$toolbar=CUI.rte.UIUtils.getToolbar(this.$editable,i),this.popover=new CUI.rte.ui.cui.PopoverManager(this.$container,i)},_getClipOffsets:function(){var t=this.editorKernel.getEditContext();return t.doc!==document?this._isClipped?{top:this.$clipParent.scrollTop(),left:this.$clipParent.scrollLeft()}:this.NO_OFFSETS:this._isClipped?this.$clipParent.offset():this.NO_OFFSETS},_calcInternalOffsets:function(){return this._isClipped=CUI.rte.UIUtils.isUnder(this.$clipParent,this.$container),this._isClipped?this.$clipParent.offset():this.NO_OFFSETS},_calcOptimum:function(){var t=this.$editable.offset(),e=0,i=0;if(this._isClipped){var n=this._getClipOffsets();e=n.top,i=n.left}var s=this.$toolbar.outerHeight();return{left:t.left-i,top:t.top-s-e}},_calcForbidden:function(t){var e=CUI.rte.DomProcessor,i=CUI.rte.Selection,n=CUI.rte.Common,s=void 0,o=this.editorKernel.getEditContext();if(t=t||this.editorKernel.createQualifiedSelection(o),t&&t.startNode&&this.editorKernel.hasFocus){var a=t.startNode,r=t.startOffset,l=t.endNode,d=t.endOffset,h=i.isSelection(t),c=e.calcScreenEstate(o,a,r,l,d),u=c.startY-(h?n.ua.calloutHeight:0),p=c.endY;if(this._isClipped){var f=this._getClipOffsets();u-=f.top,p-=f.top}s={start:u-(h?n.ua.selectionHandlesHeight:0),end:p+(h?n.ua.selectionHandlesHeight:0)}}return s},_calcAvail:function(t){var e=CUI.rte.Common,i=e.isPortrait()?e.ua.screenKeyHeightPortrait:e.ua.screenKeyHeightLandscape,n=t.height()-i;if(this._isClipped){var s=this.editorKernel.getEditContext();if(s.doc!==document){var o=this.$clipParent.offset();n-=o.top}}var a=0;return e.ua.isTouch&&(a=t.scrollTop()),{min:a,max:a+n}},_calcUITotal:function(t,e,i,n){var s=t,o=t+e;return"top"===n?s-=i:o+=i,{y1:s,y2:o}},_calcUIPosition:function(e,i){var n=this.popover.calc(),s=this._calcOptimum(n);this.preferredToolbarPos||(this.preferredToolbarPos=s);var o=this.$toolbar.outerHeight(),a=o+n.height,r=this.preferredToolbarPos.left,l=this.preferredToolbarPos.top,d="top",h=this._calcAvail(e||t(window));h.min>l?l=h.min:l+o>h.max?(l=h.max-a,d="bottom"):l-n.height<h.min&&(d="bottom");var c=this._calcForbidden(i);if(c){var u=this._calcUITotal(l,o,n.height,d);u.y2>c.start&&u.y1<c.end&&(s.top-n.height>h.min&&s.top+o<c.start?(d="top",l=s.top):c.start-a>h.min?(d="top",l=c.start-o):c.end+a<=h.max?(d="bottom",l=c.end):(d="bottom",l=h.max-a))}var p="top"===d?l-n.height:l+o+n.arrowHeight;return this.preferredToolbarPos={left:r,top:l},{toolbar:{left:r+this._offsets.left,top:l+this._offsets.top},popover:{left:r+this._offsets.left,top:p+this._offsets.top,align:d,arrow:"top"===d?"bottom":"top"}}},_updateUI:function(){var t=this._calcUIPosition();t&&(this.$toolbar.offset(t.toolbar),this.popover.setPosition(t.popover))},_handleScrolling:function(){var e=this.editorKernel.getEditContext(),i=(this.$clipParent||t(e.win)).scrollTop();this._recordedScrollTop!==i&&(CUI.rte.Common.ua.isTouch&&!this.editorKernel.isLocked()?this.hideTemporarily():this._updateUI(),this._recordedScrollTop=i)},_handleUpdateState:function(t){if(!this.editorKernel.isLocked()){switch(t.origin){case"event":break;case"command":this.popover.hide()}this._updateUI()}},_initializePopovers:function(){var e=this;this.$container.on("click.rte-toolbar",'button[data-action^="#"]',function(i){var n=t(this);if(!n.hasClass(CUI.rte.Theme.TOOLBARITEM_DISABLED_CLASS)){var s=!e.popover.isShown()||!e.popover.isTriggeredBy(n);e.popover.hide(),s&&e.popover.use(t(i.target).data("action").substring(1),n,e.$toolbar),e._updateUI(),e.editorKernel.focus(),i.stopPropagation()}}),this.$container.find(".rte-popover").each(function(){t(this).pointer("click.rte-toolbar",function(e){"disabled"===t(e.target).attr("disabled")&&e.stopPropagation()})});var i=this.$toolbar.find(".trigger.single-select");i.each(function(){var e=CUI.rte.UIUtils.determineIconClass(this),i=t(this);i.data("base-icon",e),i.data("current-icon",e)})},hide:function(){this.popover.hide(),this.$toolbar.css("visibility","hidden")},isHidden:function(){return"hidden"===this.$toolbar.css("visibility")},hideTemporarily:function(t){this._tbHideTimeout&&(window.clearTimeout(this._tbHideTimeout),this._tbHideTimeout=void 0),this.isHidden()||this.hide();var e=this;this._tbHideTimeout=window.setTimeout(function(){e.show(),e._tbHideTimeout=void 0,t&&t()},1e3)},show:function(){this.$toolbar.css("visibility","visible"),this._updateUI()},getToolbarContainer:function(){return this.$container},getItem:function(t){return this.elementMap[t]},getHeight:function(){return 0},getPopoverManager:function(){return this.popover},createPopoverTriggerToElementMapping:function(){for(var t in this.elementMap)if(this.elementMap.hasOwnProperty(t)){var e=this.elementMap[t].element,i=e.plugin.pluginId+"#"+e.id,n=CUI.rte.UIUtils.getElement(i,this.tbType,this.$container),s=n.parent(".rte-popover");if(s.length){var o="#"+s.data("id"),a=CUI.rte.UIUtils.getPopoverTrigger(o,this.tbType,this.$toolbar);this.popover.addTriggerToElement(a,n)}}},triggerUIUpdate:function(){this._updateUI()},startEditing:function(e){this.editorKernel=e,this.editorKernel.getEditContext(),this.editorKernel.addUIListener("updatestate",this._handleUpdateState,this),this.$toolbar.addClass(CUI.rte.Theme.TOOLBAR_ACTIVE),this.$clipParent=CUI.rte.UIUtils.getClippingParent(this.$container),this._offsets=this._calcInternalOffsets(),this._initializePopovers(),this._updateUI();var i=this;this.$toolbar.pointer("click.rte-toolbar",function(e){"disabled"===t(e.target).attr("disabled")&&e.stopPropagation()}),this.$container.on("mousedown.rte-toolbar",".item",function(){i.editorKernel.disableFocusHandling()}),t(document).on("mouseup.rte-toolbar",function(){i.editorKernel.enableFocusHandling()}),t(window).on("scroll.rte-toolbar",function(t){i._handleScrolling(t)}),this.$clipParent&&(this.$clipParent.on("click.rte-toolbar",function(){}),this.$clipParent.on("scroll.rte-toolbar",function(t){i._handleScrolling(t)}))},finishEditing:function(){this.popover.hide(),this.$toolbar.removeClass(CUI.rte.Theme.TOOLBAR_ACTIVE),t(window).off("scroll.rte-toolbar"),this.$container.off("mousedown.rte-toolbar click.rte-toolbar"),t(document).off("mouseup.rte-toolbar"),this.$clipParent&&(this.$clipParent.off("scroll.rte-toolbar"),this.$clipParent.off("click.rte-toolbar"),this.$clipParent=void 0),this._isClipped=!1,this.editorKernel.removeUIListener("updatestate",this._handleUpdateState,this),this.$container.find(".rte-popover").each(function(){t(this).off("click.rte-toolbar")})},enable:function(){for(var t in this.elementMap)if(this.elementMap.hasOwnProperty(t)){var e=this.elementMap[t].element;e.setDisabled(!1)}},disable:function(t){if(!this.editorKernel.isLocked())for(var e in this.elementMap)if(this.elementMap.hasOwnProperty(e)&&(!t||0>t.indexOf(e))){var i=this.elementMap[e].element;i.setDisabled(!0)}},destroy:function(){this.disable();for(var t in this.elementMap)if(this.elementMap.hasOwnProperty(t)){var e=this.elementMap[t].element;e.destroy&&e.destroy()}this.elementMap={}}})}(window.jQuery),function(t){CUI.rte.ui.cui.PopoverManager=new Class({toString:"ToolbarImpl",$container:null,$popover:null,$popoverTrigger:null,triggerToElements:null,tbType:null,construct:function(t,e){this.$popover=null,this.$popoverTrigger=null,this.$container=t,this.triggerToElements=[],this.tbType=e},getArrowHeight:function(){var t=this.$popover;return t?Math.round((t.outerWidth()-t.width())/1.5):0},setPosition:function(t){this.$popover&&(this.$popover.removeClass("arrow-bottom  arrow-top"),this.$popover.addClass("arrow-"+t.arrow),this.$popover.offset(t))},calc:function(){var t=this.$popover;if(!t)return{height:0,arrowHeight:0};var e=this.getArrowHeight();return{height:t.outerHeight()+e,arrowHeight:e}},addTriggerToElement:function(t,e){var i=t[0],n=e[0],s=this.getElementsForTrigger(t);s||(s={trigger:i,elements:[]},this.triggerToElements.push(s));var o=s.elements;CUI.rte.Common.arrayContains(o,n)||o.push(n)},getElementsForTrigger:function(t){for(var e=t[0],i=this.triggerToElements.length,n=0;i>n;n++)if(this.triggerToElements[n].trigger===e)return this.triggerToElements[n];return void 0},getTriggerForElement:function(e){for(var i=e[0],n=this.triggerToElements.length,s=0;n>s;s++)for(var o=this.triggerToElements[s],a=o.elements,r=a.length,l=0;r>l;l++)if(a[l]===i)return t(o.trigger);return void 0},isShown:function(){return!!this.$popover},isTriggeredBy:function(t){return this.$popoverTrigger&&t[0]===this.$popoverTrigger[0]},use:function(e,i,n){if(this.$popoverTrigger=i,this.$popoverTrigger.addClass("triggered"),this.$popover=e.jquery?e:CUI.rte.UIUtils.getPopover(e,this.tbType,this.$container),this.$popover.length){var s=i.offset(),o=n.offset(),a=s.left-o.left,r=this.getArrowHeight(),l=Math.round(i.width()/2+a-r)+2;this._popoverStyleSheet=CUI.rte.UIUtils.addStyleSheet({".name":".temp-arrow-position:before",left:l+"px !important"}),this.$popover.addClass("temp-arrow-position"),this.$popover.popover({pointAt:t([]),preventAutoHide:!0}).popover("show")}else this.$popover=null},hide:function(){this.$popoverTrigger&&(this.$popoverTrigger.removeClass("triggered"),this.$popoverTrigger=null);var t=!!this.$popover;return t&&(this.$popover.removeClass("temp-arrow-position"),CUI.rte.UIUtils.removeStyleSheet(this._popoverStyleSheet),this._popoverStyleSheet=null,this.$popover.popover("hide"),this.$popover=null),t}})}(window.jQuery),function(t){CUI.rte.ui.cui.ElementImpl=new Class({toString:"ElementImpl",extend:CUI.rte.ui.TbElement,dom:null,$ui:null,notifyGroupBorder:function(){},addToToolbar:function(t){var e=this.plugin.pluginId+"#"+this.id;t.push({ref:e,plugin:this.plugin.pluginId,command:this.id})},notifyToolbar:function(e){this.toolbar=e;var i=this.plugin.pluginId,n=t(e.getToolbarContainer()),s=this;this.$ui=n.find('button[data-action="'+i+"#"+this.id+'"]'),this.$ui.on("click.rte-handler",function(t){if(!s.$ui.hasClass(CUI.rte.Theme.TOOLBARITEM_DISABLED_CLASS)){var e=s.plugin.editorKernel.getEditContext();e.setState("CUI.SelectionLock",1);var i=s.cmdDef?s.cmdDef.cmd:s.id,n=s.cmdDef?s.cmdDef.cmdValue:void 0,o={editContext:e};s.plugin.execute(i,n,o),s.plugin.editorKernel.enableFocusHandling(),s.plugin.editorKernel.focus(e)}t.stopPropagation()})},createToolbarDef:function(){return{id:this.id,element:this}},setDisabled:function(t){var e=CUI.rte.Common;if(e.ua.isTouch&&this.$ui.css("display","none"),t?(this.$ui.addClass(CUI.rte.Theme.TOOLBARITEM_DISABLED_CLASS),this.$ui.attr("disabled","disabled")):(this.$ui.removeClass(CUI.rte.Theme.TOOLBARITEM_DISABLED_CLASS),this.$ui.removeAttr("disabled")),e.ua.isTouch){var i=this;window.setTimeout(function(){i.$ui.css("display","inline-block")},1)}},setSelected:function(e){this._isSelected=e,e?this.$ui.addClass(CUI.rte.Theme.TOOLBARITEM_SELECTED_CLASS):this.$ui.removeClass(CUI.rte.Theme.TOOLBARITEM_SELECTED_CLASS);var i=this.toolbar.getPopoverManager(),n=i.getTriggerForElement(this.$ui);if(n&&n.length){var s=i.getElementsForTrigger(n);s=s?s.elements:[];for(var o=[],a=s.length,r=0;a>r;r++){var l=t(s[r]);l.hasClass(CUI.rte.Theme.TOOLBARITEM_SELECTED_CLASS)&&o.push(l)}o.length>0?n.addClass("items-selected"):n.removeClass("items-selected");var d=n.data("base-icon");if(d){var h=d;if(1===o.length){var c=CUI.rte.UIUtils.determineIconClass(o[0]);h=c?c:h}var u=n.data("current-icon");u!==h&&(u&&n.removeClass(u),n.addClass(h),n.data("current-icon",h))}}},isSelected:function(){return this._isSelected},destroy:function(){this.$ui.off("click.rte-handler")}})}(window.jQuery),function(){CUI.rte.ui.cui.ParaFormatterImpl=new Class({toString:"ParaFormatterImpl",extend:CUI.rte.ui.TbParaFormatter,notifyGroupBorder:function(){},addToToolbar:function(t){this.toolbar=t},createToolbarDef:function(){return{id:this.id,element:this}},initializeSelector:function(){},selectFormat:function(){},getSelectorDom:function(){return null},getSelectedFormat:function(){return null},setDisabled:function(){},setSelected:function(t){this._isSelected=t},isSelected:function(){return this._isSelected}})}(window.jQuery),function(){CUI.rte.ui.cui.StyleSelectorImpl=new Class({toString:"StyleSelectorImpl",extend:CUI.rte.ui.TbStyleSelector,notifyGroupBorder:function(){},addToToolbar:function(){},createToolbarDef:function(){return{id:this.id,element:this}},initializeSelector:function(){},getSelectorDom:function(){return{}},getSelectedStyle:function(){return null},setRemoveDisabled:function(){},setDisabled:function(){},setSelected:function(t){this._isSelected=t},isSelected:function(){return this._isSelected}})}(window.jQuery),function(t){var e={"#format":"icon-text","#justify":"icon-textleft","#lists":"icon-textbulleted","format#bold":"icon-textbold","format#italic":"icon-textitalic","format#underline":"icon-textunderline","justify#justifyleft":"icon-textleft","justify#justifycenter":"icon-textcenter","justify#justifyright":"icon-textright","lists#insertunorderedlist":"icon-textbulleted","lists#insertorderedlist":"icon-textnumbered","lists#outdent":"icon-textindentdecrease","lists#indent":"icon-textindentincrease","links#modifylink":"icon-link","links#unlink":"icon-linkoff","control#close":"icon-close"},i={"#format":"multi-select","#justify":"single-select","control#close":"modechanger"};CUI.rte.ui.cui.CuiToolbarBuilder=new Class({toString:"CuiToolbarBuilder",extend:CUI.rte.ui.ToolbarBuilder,_getUISettings:function(t){var e=void 0;return e=t&&t.uiSettings&&t.uiSettings.cui?t.uiSettings.cui:CUI.rte.ui.cui.DEFAULT_UI_SETTINGS},_registerIcons:function(t){if(t){CUI.rte.Common.removeJcrData(t);for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];i.command&&i.icon&&this.registerIcon(i.command,i.icon)}}},registerIcon:function(t,i){e[t]=i},_getIconForCommand:function(t){return e.hasOwnProperty(t)?e[t]:void 0},_registerAllAdditionalClasses:function(t){var e=CUI.rte.Common;if(t){e.removeJcrData(t);for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];n.command&&!e.isNull(n.classes)&&this.registerAdditionalClasses(n.command,n.classes)}}},registerAdditionalClasses:function(t,e){i[t]=e},_getClassesForCommand:function(t){if(i.hasOwnProperty(t)){var e=i[t];return e}return void 0},_buildToolbar:function(e,i,n){function s(t){for(var e=l.length,i=0;e>i;i++)if(l[i].ref===t)return l[i];return null}for(var o,a=CUI.rte.Common,r=this._getUISettings(n),l=[],d=0;i.length>d;d++)i[d].addToToolbar(l);a.removeJcrData(r);var h=[],c=CUI.rte.Templates.toolbar,u=CUI.rte.Templates["toolbar-item"],p=CUI.rte.Templates["popover-trigger"],f=CUI.rte.Templates.popover,m=CUI.rte.Templates["popover-item"],g=CUI.rte.Templates.separator;for(var v in r)if(r.hasOwnProperty(v)){var b=r[v],C=[],$=[],y=b.toolbar;if(!y)continue;for(var w=y.length,I=0;w>I;I++){var _=y[I];if(_&&_.length)if("#"===_.charAt(0))o=this._getClassesForCommand(_),o=o?" "+o:"",C.push(p({ref:_,icon:this._getIconForCommand(_),addClasses:o}));else if("-"===_)C.push(g());else{var E=s(_);E&&(o=this._getClassesForCommand(_),o=o?" "+o:"",E.icon=E.icon||this._getIconForCommand(E.ref),E.addClasses=o,C.push(u(E)))}}var x=b.popovers;if(!x)continue;a.removeJcrData(x);for(var S in x)if(x.hasOwnProperty(S)){for(var T=[],U=x[S],k=U.items,D=k.length,P=0;D>P;P++)if("-"!==k[P]){var M=s(k[P]);if(M){var A=M.ref;o=this._getClassesForCommand(A),o=o?" "+o:"",M.icon=M.icon||this._getIconForCommand(A),M.addClasses=o,T.push(m(M))}}else T.push(g());$.push(f({ref:U.ref,popoverItems:T}))}h.push({id:v,toolbar:c({toolbarItems:C}),popovers:$})}var F=t(CUI.rte.Templates["tb-container"]({toolbars:h})),L=CUI.rte.UIUtils.createOrGetUIContainer(e);L.append(F)},createToolbar:function(t){for(var e=[],i=[],n={},s=this.groups.length,o=!1,a=0;s>a;a++)for(var r=this.groups[a].elements,l=r.length,d=0;l>d;d++){var h=r[d].def;0==d&&o&&(e.push("-"),o=!1);var c=h.createToolbarDef();if(null!=c){CUI.rte.Utils.isArray(c)||(c=[c]);for(var u=c.length,p=0;u>p;p++){var f=c[p];e.push(f),n[f.id]=f}i.push(h),o=!0}}var m=this._getUISettings(t);m&&m.hasOwnProperty("icons")&&(this._registerIcons(m.icons),delete m.icons),m&&m.hasOwnProperty("additionalClasses")&&(this._registerAllAdditionalClasses(m.additionalClasses),delete m.additionalClasses);var g=t.$editable,v=CUI.rte.UIUtils.getToolbar(g),b=i.length;v||this._buildToolbar(g,i,t);for(var C=new CUI.rte.ui.cui.ToolbarImpl(n,g),$=0;b>$;$++)i[$].notifyToolbar(C);return C.createPopoverTriggerToElementMapping(),C},createElement:function(t,e,i,n,s,o){return new CUI.rte.ui.cui.ElementImpl(t,e,i,n,s,o)},createParaFormatter:function(t,e,i,n){return new CUI.rte.ui.cui.ParaFormatterImpl(t,e,!1,i,!1,void 0,n)},createStyleSelector:function(t,e,i,n){return new CUI.rte.ui.cui.StyleSelectorImpl(t,e,!1,i,!1,void 0,n)}}),CUI.rte.ui.cui.DEFAULT_UI_SETTINGS={inline:{toolbar:["#format","-","#justify","-","#lists","-","links#modifylink","links#unlink","-","control#close"],popovers:{format:{ref:"format",items:["format#bold","format#italic","format#underline"]},justify:{ref:"justify",items:["justify#justifyleft","justify#justifycenter","justify#justifyright"]},lists:{ref:"lists",items:["lists#insertunorderedlist","lists#insertorderedlist","lists#outdent","lists#indent"]}}}}}(window.jQuery),function(){CUI.rte.ui.cui.CmItemImpl=new Class({toString:"CmItemImpl",extend:CUI.rte.ui.CmItem,text:null,selectionContext:null,editContext:null,construct:function(t){CUI.rte.Utils.apply(this,t)},build:function(t,e,i,n){this.editorKernel=e,this.selectionContext=n,this.editContext=i}})}(window.jQuery),function(){CUI.rte.ui.cui.CmSeparatorImpl=new Class({toString:"CmSeparatorImpl",extend:CUI.rte.ui.CmSeparator,build:function(){}})}(window.jQuery),function(){CUI.rte.ui.cui.CuiContextMenuBuilder=new Class({toString:"CuiContextMenuBuilder",extend:CUI.rte.ui.ContextMenuBuilder,construct:function(){},build:function(){return{}},createItem:function(t){return new CUI.rte.ui.stub.CmItemImpl(t)},createSeparator:function(){return new CUI.rte.ui.stub.CmSeparatorImpl},showAt:function(){},hideAll:function(){},isVisible:function(){return!1}})}(window.jQuery),function(t){CUI.rte.ui.cui.Mask=new Class({$mask:null,show:function(){if(!CUI.rte.Common.ua.isTouch){var e=t("body");this.$mask=t("<div></div>"),this.$mask.addClass("rte-dialog-mask");var i=document.body.scrollHeight;this.$mask.height(i),e.append(this.$mask)}},hide:function(){CUI.rte.Common.ua.isTouch||(this.$mask.off("click.rte-dialog-mask"),this.$mask.remove())}})}(window.jQuery),function(t){function e(e){var i=t(e);return i.is("input:text")}CUI.rte.ui.cui.AbstractDialog=new Class({config:null,dialogHelper:null,range:null,$editable:null,$container:null,$toolbar:null,$trigger:null,$dialog:null,mask:null,editorKernel:null,popoverManager:null,construct:function(i){CUI.rte.Utils.apply(this,i);var n=this,s=this.getDataType(),o=i.mode;if(this.$dialog=CUI.rte.UIUtils.getDialog(s,o,this.$container),!this.$dialog.length){this.$dialog=t(CUI.rte.Templates["dlg-"+s](i));var a=CUI.rte.UIUtils.getUIContainer(this.$editable),r=o||"global",l=CUI.rte.UIUtils.getSpace(r,a);l.append(this.$dialog)}this.$dialog.finger("tap.rte-dialog click.rte-dialog",function(t){e(t.target)?CUI.rte.UIUtils.killEvent(t):(n.editorKernel.focus(),n.range&&CUI.rte.Selection.selectRangeBookmark(n.editorKernel.getEditContext(),n.range))}),this.$dialog.on("click.rte-dialog",'button[data-type="apply"]',function(t){n.apply(),t.stopPropagation()}),this.$dialog.on("click.rte-dialog",'button[data-type="cancel"]',function(t){n.cancel(),t.stopPropagation()}),this.mask=new CUI.rte.ui.cui.Mask},destroy:function(){this.$dialog.off("tap.rte-dialog click.rte-dialog")},initializeEdit:function(t,e,i){this.editorKernel=t,this.popoverManager=this.editorKernel.toolbar.popover,this.objToEdit=e,this.applyFn=i,this.fromModel()},show:function(){this.range=CUI.rte.Selection.createRangeBookmark(this.editorKernel.getEditContext()),this.popoverManager.hide(),this.$dialog&&(this.popoverManager.use(this.$dialog,this.$trigger,this.$toolbar),this.editorKernel.lock(),this.editorKernel.fireUIEvent("dialogshow"),this.editorKernel.toolbar.triggerUIUpdate())},hide:function(){this.popoverManager.hide(),this.editorKernel.focus(),this.editorKernel.unlock(),CUI.rte.Selection.selectRangeBookmark(this.editorKernel.getEditContext(),this.range),this.editorKernel.fireUIEvent("dialoghide"),CUI.rte.Common.ua.isTouch&&this.editorKernel.toolbar.hideTemporarily()},apply:function(){this.validate()&&(this.toModel(),this.hide(),this.applyFn&&this.applyFn(this.editContext,this.objToEdit))},cancel:function(){this.hide()},getFieldByType:function(t){var e=this.$dialog.find('*[data-type="'+t+'"]');return e.length>0?e:void 0},getParameter:function(t){var e=this.config.parameters;return e&&e[t]?e[t]:void 0},getDataType:function(){throw Error("DialogImpl#getDataType must be overridden.")},preprocessModel:function(){},dlgFromModel:function(){},fromModel:function(){this.preprocessModel(),this.dlgFromModel()},validate:function(){return!0},dlgToModel:function(){},postprocessModel:function(){},toModel:function(){this.dlgToModel(),this.postprocessModel()}})}(window.jQuery),function(){CUI.rte.ui.cui.LinkBaseDialog=new Class({extend:CUI.rte.ui.cui.AbstractDialog,toString:"LinkBaseDialog",getDataType:function(){return"link"},preprocessModel:function(){if(this.objToEdit&&this.objToEdit.dom){this.objToEdit.href=CUI.rte.HtmlRules.Links.getLinkHref(this.objToEdit.dom);for(var t=CUI.rte.Common,e=t.getAttributeNames(this.objToEdit.dom,!1,function(e,i,n){return n==t.HREF_ATTRIB||"href"==n||"target"==n}),i=0;e.length>i;i++){var n=e[i],s=t.getAttribute(this.objToEdit.dom,n);s!==void 0&&(this.objToEdit.attributes[n]=s)}}},dlgFromModel:function(){var t=this.getFieldByType("href");if(t){var e="";if(this.objToEdit){var i=this.objToEdit.href;i&&(e=i)}t.val(e)}var n=this.getFieldByType("targetBlank");if(n){var s=this.objToEdit&&this.objToEdit.target?this.objToEdit.target.toLowerCase():null;n.val(["_blank"==s?"true":"false"])}},validate:function(){var t=this.getFieldByType("href");if(t){var e=t.val();if(e&&e.length>0)return!0}return!1},dlgToModel:function(){if(this.objToEdit){var t=this.getFieldByType("href");if(t){var e=t.val();e&&(this.objToEdit.href=e)}var i=this.getFieldByType("targetBlank");if(i){var n;n=i.is("input:radio")?i.filter(":checked").val():i.val(),this.objToEdit.target="true"===n?"_blank":null}}},postprocessModel:function(){var t=this.getParameter("linkRules");t&&t.applyToObject(this.objToEdit)}})}(window.jQuery),function(){CUI.rte.ui.cui.CuiDialogManager=new Class({toString:"CuiDialogManager",extend:CUI.rte.ui.DialogManager,editorKernel:null,construct:function(t){this.editorKernel=t},create:function(){return{}},mustRecreate:function(){return!1},show:function(t){t.show()},hide:function(t){t.hide()},alert:function(){},createDialogHelper:function(){return new CUI.rte.ui.cui.CuiDialogHelper(this.editorKernel)}})}(window.jQuery),function(t){var e={rtelinkdialog:CUI.rte.ui.cui.LinkBaseDialog};CUI.rte.ui.cui.CuiDialogHelper=new Class({toString:"CuiDialogHelper",extend:CUI.rte.ui.DialogHelper,instantiateDialog:function(i){var n=i.type;if(!e.hasOwnProperty(n))throw Error("Unknown dialog type: "+n);var s=e[n],o=this.editorKernel.getEditContext(),a=t(o.root),r=CUI.rte.UIUtils.getUIContainer(a),l=this.editorKernel.toolbar.$toolbar,d=l.parent().find('button[data-action="'+i.parameters.command+'"]');return new s({config:i,$editable:a,$container:r,$toolbar:l,$trigger:d})},createItem:function(){return{}},getItemType:function(){return"unknown"},getItemName:function(t){return t.id||(t.id="id-"+(new Date).getTime()),t.id},getItemValue:function(t){return t.value},setItemValue:function(t,e){t.value=e},calculateInitialPosition:function(){}})}(window.jQuery),function(t){CUI.RichText=new Class({toString:"RichText",extend:CUI.Widget,editorKernel:null,savedSpellcheckAttrib:null,savedOutlineStyle:null,isActive:!1,ignoreNextClick:!1,construct:function(t){this.options=t||{},this.options.hasOwnProperty("$ui")&&this.$element.data("rte-ui",this.options.$ui)},_hidePopover:function(){if(this.editorKernel.toolbar){var t=this.editorKernel.toolbar;if(t.popover)return t.popover.hide()}return!1},_finishRequested:function(){this.finish(!1)},_handleToolbarOnSelectionChange:function(){var e=CUI.rte.Common,i=this.editorKernel.getEditContext(),n=t(i.doc),s=this;if(e.ua.isTouch){var o;n.on("selectionchange.rte-toolbarhide",function(){if(s.editorKernel.isLocked()||!s.isActive)return o=void 0,void 0;var t=s.editorKernel.getEditContext(),i=t.win.getSelection();if(!e.isAncestor(t,t.root,i.focusNode)||!e.isAncestor(t,t.root,i.anchorNode)){i.removeAllRanges();var n=t.doc.createRange();o?(n.setStart(o.ande,o.aoffs),n.setEnd(o.fnde,o.foffs)):(n.selectNodeContents(t.root),n.collapse(!0)),i.addRange(n)}if(!i.isCollapsed){var a=t.getState("CUI.SelectionLock");if(void 0===a){var r=!1;o&&(r=o.ande===i.anchorNode&&o.aoffs===i.anchorOffset&&o.fnde===i.focusNode&&o.foffs===i.focusOffset),r||s.editorKernel.toolbar.hideTemporarily()}else a--,a>0?t.setState("CUI.SelectionLock",a):t.setState("CUI.SelectionLock")}o={ande:i.anchorNode,aoffs:i.anchorOffset,fnde:i.focusNode,foffs:i.focusOffset}})}else{var a=!1,r=!1;this.$textContainer.pointer("mousedown.rte-toolbarhide",function(){a=!0}),this.$textContainer.pointer("mousemove.rte-toolbarhide",function(){!a||r||s.editorKernel.isLocked()||(s.editorKernel.toolbar.hide(),r=!0)}),this.$textContainer.pointer("mouseup.rte-toolbarhide",function(){r&&(s.editorKernel.toolbar.show(),r=!1),a=!1})}},getTextDiv:function(t){return t},isEmptyText:function(){return!1},prepareForNewText:function(){},handleKeyUp:function(t){this.editorKernel.isLocked()||this._hidePopover(),27===t.getCharCode()&&this.finish(!0)},initializeEditorKernel:function(t){var e=CUI.rte.Common;this.editorKernel.addUIListener("updatestate",this.updateState,this);var i=this.textContainer.ownerDocument,n=e.getWindowForDocument(i);this.editorKernel.initializeEditContext(n,i,this.textContainer),this.editorKernel.initializeEventHandling(),this.editorKernel.setUnprocessedHtml(t||""),this.editorKernel.initializeCaret(!0),this.editorKernel.execCmd("initializeundo"),this.editorKernel.addUIListener("requestClose",this._finishRequested,this),CUI.rte.Common.ua.isTouch&&this.editorKernel.toolbar.hideTemporarily()
},initializeEventHandling:function(){CUI.rte.Common;var e=CUI.rte.Selection,i=this,n=this.editorKernel.getEditContext(),s=n.doc.body,o=t(s),a=t(document.body);o.on("focus.rte",".rte-toolbar-item",function(t){i.$textContainer.focus(),t.stopPropagation(),t.preventDefault()}),this.$textContainer.finger("blur.rte",function(){i.editorKernel.isLocked()?i.isTemporaryFocusChange=!1:CUI.rte.Utils.defer(function(){i.isTemporaryFocusChange||!i.isActive||i.editorKernel.isLocked()||i.finish(!1),i.isTemporaryFocusChange=!1},10)}),this.$textContainer.finger("touchstart.rte",function(t){i.editorKernel.isLocked()&&CUI.rte.UIUtils.killEvent(t)}),CUI.rte.Eventing.on(n,s,"keyup",this.handleKeyUp,this),this.$textContainer.fipo("tap.rte","click.rte",function(t){i.editorKernel.isLocked()||i._hidePopover(),t.stopPropagation()});var r;o.fipo("touchstart.rte-ooa","mousedown.rte-ooa",function(){var t=i.editorKernel.getEditContext();r=e.createRangeBookmark(t)}),o.fipo("tap.rte-ooa","click.rte-ooa",function(t){if(i.ignoreNextClick)return i.ignoreNextClick=!1,void 0;if(!i.editorKernel.isLocked())if(i._hidePopover()){var n=i.editorKernel.getEditContext();i.editorKernel.focus(n),r&&(e.selectRangeBookmark(n,r),r=void 0),i.isTemporaryFocusChange=!0,CUI.rte.UIUtils.killEvent(t)}else i.isActive&&(i.finish(!1),i.$textContainer.blur())}),o.finger("tap.rte-ooa",CUI.rte.UIUtils.killEvent),a.fipo("tap.rte-item","click.rte-item",".rte-toolbar .item",function(t){i.isTemporaryFocusChange=!0,CUI.rte.UIUtils.killEvent(t)}),a.fipo("tap.rte-item","click.rte-item",".rte-popover .item",function(t){i.isTemporaryFocusChange=!0,CUI.rte.UIUtils.killEvent(t)}),this._handleToolbarOnSelectionChange()},deactivateEditorKernel:function(){null!=this.editorKernel&&(this.editorKernel.removeUIListener("requestClose"),this.editorKernel.removeUIListener("updatestate"),this.editorKernel.suspendEventHandling(),this.editorKernel.destroyToolbar())},finalizeEventHandling:function(){if(null!=this.editorKernel){var e=this.editorKernel.getEditContext(),i=e.doc.body,n=t(i),s=t(document.body),o=t(e.doc);CUI.rte.Eventing.un(i,"keyup",this.handleKeyUp,this),this.$textContainer.off("blur.rte touchstart.rte tap.rte click.rte"),n.off("focus.rte tap.rte-ooa click.rte-ooa"),n.off("touchstart.rte-ooa mousedown.rte-ooa"),s.off("tap.rte-item click.rte-item"),this.$textContainer.off("mousemove.rte-toolbarhide"),this.$textContainer.off("mouseup.rte-toolbarhide mousedown.rte-toolbarhide"),o.off("selectionchange.rte-toolbarhide")}},updateState:function(){this.editorKernel.updateToolbar()},getContent:function(){return this.isActive?this.editorKernel.getProcessedHtml():void 0},start:function(t){null===this.editorKernel&&(this.editorKernel=new CUI.rte.DivKernel(t,function(t,e){return"control"===t?"close"===e:void 0}));var e=CUI.rte.Common.ua;this.ignoreNextClick=e.isTouch,this.$textContainer=this.getTextDiv(this.$element),this.$textContainer.addClass("edited"),this.textContainer=this.$textContainer[0],this.editorKernel.createToolbar({$editable:this.$element,uiSettings:t?t.uiSettings:void 0}),this.isEmptyContent=this.isEmptyText(),this.isEmptyContent&&this.prepareForNewText();var i=this.options.initialContent;void 0===i&&(i=this.$textContainer.html()),this.$textContainer[0].contentEditable="true",(e.isGecko||e.isWebKit)&&(this.savedOutlineStyle=this.textContainer.style.outlineStyle,this.textContainer.style.outlineStyle="none"),this.initializeEditorKernel(i);var n=this.editorKernel.getEditContext(),s=n.doc.body;this.savedSpellcheckAttrib=s.spellcheck,s.spellcheck=!1,this.initializeEventHandling(),this.isActive=!0,this.$element.trigger("editing-start")},finish:function(t){var e=this.editorKernel.getEditContext(),i=e.doc.body,n=this.editorKernel.getProcessedHtml();CUI.rte.Selection.resetSelection(e,"start"),this.finalizeEventHandling(),this.deactivateEditorKernel(),this.$textContainer.removeClass("edited"),this.textContainer.blur(),this.textContainer.contentEditable="inherit",i.spellcheck=this.savedSpellcheckAttrib;var s=CUI.rte.Common.ua;return(s.isGecko||s.isWebKit)&&this.savedOutlineStyle&&(this.textContainer.style.outlineStyle=this.savedOutlineStyle),this.isActive=!1,this.$element.trigger(t?"editing-cancelled":"editing-finished",[n]),n}}),CUI.util.plugClass(CUI.RichText,"richEdit",function(e){CUI.rte.ConfigUtils.loadConfigAndStartEditing(e,t(this))}),CUI.options.dataAPI&&t(function(){t("body").fipo("tap.rte.data-api","click.rte.data-api",".editable",function(e){var i=t(this);i.hasClass("edited")||(i.richEdit(),e.preventDefault())})})}(window.jQuery),function(){CUI.rte.ui.ToolkitRegistry.initialize("cui")}();